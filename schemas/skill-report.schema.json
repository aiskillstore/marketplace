{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://skillstore.io/schemas/skill-report.schema.json",
  "title": "Skill Report v2.0",
  "description": "Single source of truth for skill data - security audit + AI content + metadata",
  "type": "object",
  "required": ["schema_version", "meta", "skill", "security_audit", "content"],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "2.0",
      "description": "Schema version for backward compatibility"
    },
    "meta": {
      "type": "object",
      "required": ["generated_at", "slug", "source_url", "source_ref", "model", "analysis_version", "source_type"],
      "additionalProperties": false,
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of generation"
        },
        "slug": {
          "type": "string",
          "pattern": "^[a-z0-9]([a-z0-9-]*[a-z0-9])?$",
          "description": "Hyphen-separated identifier: owner-skill-slug (e.g., payloadcms-payload)"
        },
        "source_url": {
          "type": "string",
          "format": "uri",
          "description": "GitHub URL of the skill"
        },
        "source_ref": {
          "type": "string",
          "description": "Git branch or tag"
        },
        "model": {
          "type": "string",
          "description": "AI model used for analysis"
        },
        "analysis_version": {
          "type": "string",
          "description": "CLI/processor version"
        },
        "source_type": {
          "type": "string",
          "enum": ["official", "community"],
          "description": "Origin: official (anthropics/skills), community (github repo)"
        }
      }
    },
    "skill": {
      "type": "object",
      "required": ["name", "description", "supported_tools"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Display name from SKILL.md"
        },
        "description": {
          "type": "string",
          "description": "Short description"
        },
        "summary": {
          "type": "string",
          "description": "One-liner summary"
        },
        "icon": {
          "type": "string",
          "description": "Emoji icon (default: ðŸ“¦)"
        },
        "version": {
          "type": "string",
          "description": "Semver version"
        },
        "author": {
          "type": "string",
          "description": "Creator name"
        },
        "license": {
          "type": "string",
          "description": "SPDX license identifier"
        },
        "category": {
          "type": "string",
          "description": "Primary category slug"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Search tags"
        },
        "supported_tools": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["claude", "codex", "claude-code"]
          },
          "minItems": 1,
          "description": "Compatible AI tools"
        },
        "risk_factors": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["scripts", "network", "filesystem", "env_access", "external_commands"]
          },
          "description": "Risk indicator flags"
        }
      }
    },
    "security_audit": {
      "type": "object",
      "required": ["risk_level", "is_blocked", "safe_to_publish", "summary", "files_scanned", "total_lines", "audit_model", "audited_at"],
      "additionalProperties": false,
      "properties": {
        "risk_level": {
          "type": "string",
          "enum": ["safe", "low", "medium", "high", "critical"],
          "description": "Overall risk assessment"
        },
        "is_blocked": {
          "type": "boolean",
          "description": "Hard block - cannot be published"
        },
        "safe_to_publish": {
          "type": "boolean",
          "description": "Recommended for publication"
        },
        "summary": {
          "type": "string",
          "description": "Human-readable audit summary"
        },
        "critical_findings": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecurityFinding" }
        },
        "high_findings": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecurityFinding" }
        },
        "medium_findings": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecurityFinding" }
        },
        "low_findings": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecurityFinding" }
        },
        "dangerous_patterns": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecurityFinding" },
          "description": "Detected dangerous code patterns with title, description, and locations"
        },
        "files_scanned": {
          "type": "integer",
          "minimum": 0
        },
        "total_lines": {
          "type": "integer",
          "minimum": 0
        },
        "audit_model": {
          "type": "string",
          "description": "AI model that performed the audit"
        },
        "audited_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of audit"
        },
        "risk_factors": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["scripts", "network", "filesystem", "env_access", "external_commands"]
          },
          "description": "Risk indicator flags detected during audit"
        }
      }
    },
    "content": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "user_title": {
          "type": "string",
          "description": "Human-friendly marketing title"
        },
        "value_statement": {
          "type": "string",
          "description": "What problem this skill solves"
        },
        "seo_keywords": {
          "type": "array",
          "items": { "type": "string" }
        },
        "actual_capabilities": {
          "type": "array",
          "items": { "type": "string" },
          "description": "What the skill can actually do"
        },
        "limitations": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Known limitations"
        },
        "use_cases": {
          "type": "array",
          "items": { "$ref": "#/$defs/UseCase" }
        },
        "prompt_templates": {
          "type": "array",
          "items": { "$ref": "#/$defs/PromptTemplate" }
        },
        "output_examples": {
          "type": "array",
          "items": { "$ref": "#/$defs/OutputExample" }
        },
        "best_practices": {
          "type": "array",
          "items": { "type": "string" }
        },
        "anti_patterns": {
          "type": "array",
          "items": { "type": "string" }
        },
        "faq": {
          "type": "array",
          "items": { "$ref": "#/$defs/FAQ" }
        },
        "technical_requirements": {
          "$ref": "#/$defs/TechnicalRequirements"
        }
      }
    },
    "file_structure": {
      "type": "array",
      "items": { "$ref": "#/$defs/FileNode" },
      "description": "Optional file tree structure"
    }
  },
  "$defs": {
    "SecurityFinding": {
      "type": "object",
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "locations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file": { "type": "string" },
              "line_start": { "type": "integer" },
              "line_end": { "type": "integer" }
            },
            "required": ["file", "line_start", "line_end"]
          }
        }
      }
    },
    "UseCase": {
      "type": "object",
      "required": ["title", "description"],
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "target_user": { "type": "string" }
      }
    },
    "PromptTemplate": {
      "type": "object",
      "required": ["title", "prompt"],
      "properties": {
        "title": { "type": "string" },
        "prompt": { "type": "string" },
        "scenario": { "type": "string" }
      }
    },
    "OutputExample": {
      "type": "object",
      "required": ["input", "output"],
      "properties": {
        "input": { "type": "string" },
        "output": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ]
        }
      }
    },
    "FAQ": {
      "type": "object",
      "required": ["question", "answer"],
      "properties": {
        "question": { "type": "string" },
        "answer": { "type": "string" }
      }
    },
    "TechnicalRequirements": {
      "type": "object",
      "properties": {
        "dependencies": {
          "type": "array",
          "items": { "type": "string" }
        },
        "permissions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "complexity": {
          "type": "string",
          "enum": ["beginner", "intermediate", "advanced"]
        }
      }
    },
    "FileNode": {
      "type": "object",
      "required": ["name", "type", "path"],
      "properties": {
        "name": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["file", "dir"]
        },
        "path": { "type": "string" },
        "children": {
          "type": "array",
          "items": { "$ref": "#/$defs/FileNode" }
        }
      }
    }
  }
}
