version: '4.0'
description: Character Consistency Lock Protocol - åˆå¹¶é…ç½®
source_files:
- CCLP-FLEXIBILITY.md
- character-consistency-lock.md
- CCLP-ENFORCEMENT-ENHANCED.md
core_protocol:
  sections:
    Character Consistency Lock Protocol (CCLP): '**Version**: 4.0 - Enhanced Enforcement
      (CRITICAL UPDATE)

      **Date**: 2026-01-11

      **Previous Version**: 1.0 (2026-01-10)

      **Purpose**: Ensure 100% visual consistency of characters across all pages in
      multi-page stories


      **ğŸ”´ CRITICAL UPDATE v4.0**: This version addresses actual image generation inconsistencies
      despite perfect prompt consistency. See CCLP 4.0 Enhanced Enforcement section
      below.


      ---'
    Problem Statement / é—®é¢˜é™ˆè¿°: ''
    Issue / é—®é¢˜: 'In multi-page picture book stories, character appearance (clothing,
      body type, facial features) was changing between pages due to insufficient specificity
      in prompts. While expressions and poses should change with the narrative, **base
      appearance features must remain absolutely consistent**.


      åœ¨å¤šé¡µç»˜æœ¬æ•…äº‹ä¸­ï¼Œç”±äºæç¤ºè¯ç‰¹å¼‚æ€§ä¸è¶³ï¼Œè§’è‰²å¤–è§‚ï¼ˆè¡£æœã€ä½“å‹ã€é¢éƒ¨ç‰¹å¾ï¼‰åœ¨ä¸åŒé¡µé¢ä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚è™½ç„¶è¡¨æƒ…å’Œå§¿åŠ¿åº”è¯¥éšå™äº‹å˜åŒ–ï¼Œä½†**åŸºç¡€å¤–è§‚ç‰¹å¾å¿…é¡»ä¿æŒç»å¯¹ä¸€è‡´**ã€‚'
    Examples of Inconsistency / ä¸ä¸€è‡´ç¤ºä¾‹: '**Bad Example (Inconsistent)** âŒ:

      - Page 1: "wearing colorful hiking outfit"

      - Page 3: "wearing hiking outfit"

      - Page 5: "wearing hiking clothes"


      **Result**: Different colored jackets, different pants, different accessories
      in each page.


      ---'
    'Solution: Character Consistency Lock / è§£å†³æ–¹æ¡ˆï¼šè§’è‰²ä¸€è‡´æ€§é”å®š': ''
    Core Principle / æ ¸å¿ƒåŸåˆ™: '**LOCK = Specific + Repeatable + Verifiable**


      **é”å®š = å…·ä½“ + å¯é‡å¤ + å¯éªŒè¯**


      ---'
    'CCLP Level 1: Basic Anchors (Current System)': ''
    What We Have / å½“å‰ç³»ç»Ÿ: '**Yueyue Base Anchor**:

      ```

      A 5-year-old Chinese girl named Yueyue, round face, rosy cheeks,

      two pigtails with red ribbons, wearing yellow sweater and denim overalls

      ```


      **Problem**: Too vague for multi-page consistency.

      **é—®é¢˜**ï¼šå¯¹äºå¤šé¡µä¸€è‡´æ€§æ¥è¯´å¤ªæ¨¡ç³Šã€‚


      ---'
    'CCLP Level 2: Enhanced Anchors (Required for Multi-Page)': ''
    What We Need / éœ€è¦ä»€ä¹ˆ: "**Complete Character Specification Template**:\n\n```\n\
      CHARACTER ANCHOR LOCK (é¡µé¢1å»ºç«‹ï¼Œåç»­é¡µé¢å®Œå…¨å¤åˆ¶)\n===========================================\n\
      \n1. NAME & AGE\n   è§’è‰²å§“åä¸å¹´é¾„\n   - Full name: [Character Name] ([Chinese Name])\n\
      \   - Age: [X] years old\n   - Age-appropriate proportions: [specific body proportions]\n\
      \n2. FACE (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   é¢éƒ¨å›ºå®šç‰¹å¾\n   - Face shape: [round/oval/heart-shaped]\n\
      \   - Skin tone: [fair/light tan/medium]\n   - Eyes: [shape] [color] eyes with\
      \ [detail]\n   - Eyebrows: [thick/thin] [arched/straight] eyebrows\n   - Nose:\
      \ [small button/rounded/petite] nose\n   - Mouth: [small/medium] mouth with\
      \ [full/thin] lips\n   - Cheeks: [rosy/round/chubby] cheeks\n   - Special marks:\
      \ [freckles/dimples/none]\n\n3. HAIR (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   å‘å‹å›ºå®šç‰¹å¾\n  \
      \ - Style: [specific style, e.g., \"two pigtails\"]\n   - Length: [to shoulders/to\
      \ chin/short]\n   - Color: [black/brown/other]\n   - Texture: [straight/wavy/curly]\n\
      \   - Accessories: [specific, e.g., \"red satin ribbons\"]\n   - Parting: [side\
      \ part/center part/no part]\n\n4. CLOTHING (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   æœè£…å›ºå®šç‰¹å¾\n\
      \   - Upper: [specific item + exact color]\n     Example: \"bright yellow knit\
      \ sweater with ribbed collar\"\n   - Lower: [specific item + exact color]\n\
      \     Example: \"medium-wash denim overalls with metal clips\"\n   - Footwear:\
      \ [specific + color]\n     Example: \"white canvas sneakers with pink laces\"\
      \n   - Outerwear (if any): [specific + color]\n     Example: \"red windbreaker\
      \ jacket\"\n\n5. ACCESSORIES (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   é…é¥°å›ºå®šç‰¹å¾\n   - Always\
      \ visible: [items that appear in every page]\n     Example: \"small blue backpack\
      \ with teddy bear keychain\"\n   - Sometimes visible: [items that may be held/set\
      \ down]\n     Example: \"water bottle in hand or in backpack side pocket\"\n\
      \   - Signature items: [unique identifiers]\n     Example: \"rainbow friendship\
      \ bracelet on left wrist\"\n\n6. BODY TYPE (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   ä½“å‹å›ºå®šç‰¹å¾\n\
      \   - Build: [slim/average/stocky/chubby]\n   - Height: [relative to age, e.g.,\
      \ \"average height for 5-year-old\"]\n   - Proportions: [specific, e.g., \"\
      slightly shorter legs, rounder belly typical of preschooler\"]\n\n7. EXPRESSION\
      \ VARIABLES (å¯å˜ç‰¹å¾ - VARIABLE FEATURES)\n   è¡¨æƒ…å¯å˜ç‰¹å¾\n   - This is the ONLY part\
      \ that changes per page\n   - Examples: \"curious expression\", \"tired but\
      \ determined\", \"joyful smile\"\n   - NEVER include expression details in the\
      \ CHARACTER LOCK\n```\n\n---"
    Implementation Rules / å®æ–½è§„åˆ™: ''
    'Rule 1: First Page Establishes Lock': "**ç¬¬ä¸€é¡µå»ºç«‹é”å®š**\n\nThe first page (or cover\
      \ page) of a multi-page story MUST establish the complete CHARACTER ANCHOR LOCK\
      \ with all 6 fixed categories specified.\n\nå¤šé¡µæ•…äº‹çš„ç¬¬ä¸€é¡µï¼ˆæˆ–å°é¢é¡µï¼‰å¿…é¡»å»ºç«‹å®Œæ•´çš„è§’è‰²é”å®šï¼ŒåŒ…å«æ‰€æœ‰6ä¸ªå›ºå®šç±»åˆ«çš„è¯¦ç»†è¯´æ˜ã€‚\n\
      \n**Example - Cover Page Establishes Lock**:\n```\nA 10-year-old Chinese boy\
      \ named Xiaoming (å°æ˜),\n- Face: Round face with fair skin, bright almond-shaped\
      \ brown eyes with thick lashes,\n  straight black eyebrows, small button nose,\
      \ small mouth with full lips, rosy cheeks\n- Hair: Short neat black hair (2-3\
      \ cm length) with clean side part on left,\n  naturally straight texture\n-\
      \ Clothing: Bright blue zip-up hiking jacket with orange side panels,\n  gray\
      \ quick-dry hiking pants with cargo pockets,\n  brown leather hiking boots with\
      \ red laces\n- Accessories: Green canvas backpack with reflective strips,\n\
      \  black hiking pole with red grip,\n  water bottle (blue with mountain logo)\
      \ in backpack side pocket\n- Body: Average build for 10-year-old, approximately\
      \ 135cm tall,\n  athletic proportions with developing muscles from regular outdoor\
      \ activity\n```\n\n---"
    'Rule 2: Subsequent Pages Copy Lock Exactly': "**åç»­é¡µé¢ç²¾ç¡®å¤åˆ¶é”å®š**\n\nEvery subsequent\
      \ page MUST copy the CHARACTER ANCHOR LOCK from Page 1 **word-for-word** in\
      \ the prompt, changing ONLY:\n- Expression/emotion\n- Pose/action\n- Position\
      \ in scene\n\nåç»­æ¯ä¸€é¡µå¿…é¡»**é€å­—**å¤åˆ¶ç¬¬ä¸€é¡µçš„è§’è‰²é”å®šï¼Œåªæ”¹å˜ï¼š\n- è¡¨æƒ…/æƒ…ç»ª\n- å§¿åŠ¿/åŠ¨ä½œ\n- åœºæ™¯ä¸­çš„ä½ç½®\n\n**Example\
      \ - Page 3 Uses Same Lock**:\n```\nA 10-year-old Chinese boy named Xiaoming\
      \ (å°æ˜),\n- Face: Round face with fair skin, bright almond-shaped brown eyes\
      \ with thick lashes,\n  straight black eyebrows, small button nose, small mouth\
      \ with full lips, rosy cheeks\n- Hair: Short neat black hair (2-3 cm length)\
      \ with clean side part on left,\n  naturally straight texture\n- Clothing: Bright\
      \ blue zip-up hiking jacket with orange side panels (now slightly unzipped),\n\
      \  gray quick-dry hiking pants with cargo pockets,\n  brown leather hiking boots\
      \ with red laces\n- Accessories: Green canvas backpack with reflective strips,\n\
      \  black hiking pole with red grip gripped firmly,\n  water bottle visible in\
      \ hand\n- Body: Average build for 10-year-old, approximately 135cm tall,\n \
      \ athletic proportions\n- Expression: [NEW] Tired but determined expression,\
      \ visible sweat on forehead, breathing heavily\n- Pose: [NEW] Gripping hiking\
      \ pole, one foot forward on steep trail\n```\n\n**Notice**: Everything except\
      \ Expression and Pose is IDENTICAL.\n\n**æ³¨æ„**ï¼šé™¤äº†è¡¨æƒ…å’Œå§¿åŠ¿ï¼Œä¸€åˆ‡éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚\n\n---"
    'Rule 3: Allowed Variations': '**å…è®¸çš„å˜åŒ–**


      **âœ… ALLOWED (Narrative-driven changes)**:

      1. **Expression**: curious â†’ tired â†’ joyful â†’ reflective

      2. **Pose/Action**: standing â†’ climbing â†’ sitting â†’ running

      3. **Clothing state**: jacket zipped â†’ jacket unzipped (but SAME jacket)

      4. **Dirt/weathering**: clean â†’ muddy â†’ dusty (but SAME clothes)

      5. **Hair state**: neat â†’ wind-blown â†’ messy (but SAME hairstyle)

      6. **Accessory position**: backpack on back â†’ backpack on ground beside (but
      SAME backpack)


      **âŒ NOT ALLOWED (Breaks consistency)**:

      1. âŒ Clothing color change: blue jacket â†’ red jacket

      2. âŒ Clothing item change: jacket â†’ vest

      3. âŒ Hairstyle change: pigtails â†’ ponytail

      4. âŒ Hair accessory change: red ribbons â†’ blue bows

      5. âŒ Footwear change: boots â†’ sneakers

      6. âŒ Face shape change: round face â†’ oval face

      7. âŒ Body type change: slim â†’ chubby

      8. âŒ Accessory addition: no backpack â†’ suddenly has backpack (unless picked
      up in narrative)


      ---'
    'Rule 4: Physical Consistency Validation': '**ç‰©ç†ä¸€è‡´æ€§éªŒè¯**


      Before generating each page, validate:


      ç”Ÿæˆæ¯ä¸€é¡µå‰ï¼ŒéªŒè¯ï¼š


      **Checklist** âœ“:

      - [ ] Face description IDENTICAL to Page 1

      - [ ] Hair description IDENTICAL to Page 1 (style, color, accessories)

      - [ ] Clothing items IDENTICAL to Page 1 (colors, specific items)

      - [ ] Footwear IDENTICAL to Page 1

      - [ ] Signature accessories IDENTICAL to Page 1

      - [ ] Body type IDENTICAL to Page 1

      - [ ] ONLY expression and pose differ from Page 1


      **If any item above is different** â†’ âŒ REJECT and regenerate with correct anchor.


      **å¦‚æœä¸Šè¿°ä»»ä½•é¡¹ç›®ä¸åŒ** â†’ âŒ æ‹’ç»å¹¶ä½¿ç”¨æ­£ç¡®é”å®šé‡æ–°ç”Ÿæˆã€‚


      ---'
    Enhanced Character Anchors / å¢å¼ºè§’è‰²é”šç‚¹: ''
    Yueyue (æ‚¦æ‚¦) - Enhanced Lock: '**Age-Adapted Versions**:'
    Yueyue - Age 5 (Default, Preschool): '```

      CHARACTER ANCHOR LOCK - YUEYUE AGE 5

      ====================================


      NAME: Yueyue (æ‚¦æ‚¦), 5-year-old Chinese girl


      FACE (FIXED):

      - Round face with fair skin and natural rosy cheeks

      - Large bright brown almond-shaped eyes with thick black lashes

      - Thin naturally arched black eyebrows

      - Small button nose

      - Small mouth with full lips, often smiling

      - Dimples when smiling

      - No freckles or marks


      HAIR (FIXED):

      - Two high pigtails positioned above ears, each secured with bright red satin
      ribbons tied in bows

      - Hair length: to shoulders when down

      - Color: Jet black, naturally straight and shiny

      - Baby hairs around hairline


      CLOTHING (FIXED):

      - Upper: Bright sunshine yellow knit sweater with ribbed crew neck collar and
      cuffs

      - Lower: Medium-wash denim overalls with adjustable metal clip straps, two front
      pockets

      - Footwear: White canvas slip-on sneakers with elastic bands

      - No socks visible


      ACCESSORIES (FIXED):

      - Red satin ribbons in hair (SIGNATURE - MUST ALWAYS APPEAR)

      - Small items may vary by story (backpack, toy, etc.) - specify in story setup


      BODY (FIXED):

      - Chubby preschooler build typical of 5-year-old

      - Approximately 105-110cm tall

      - Round belly, short arms and legs proportional to age

      - Smooth unblemished skin


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: curious/joyful/surprised/determined/etc.]

      ```'
    Yueyue - Age 8 (Early Elementary): '```

      CHARACTER ANCHOR LOCK - YUEYUE AGE 8

      ====================================


      NAME: Yueyue (æ‚¦æ‚¦), 8-year-old Chinese girl


      FACE (FIXED):

      - Round face with fair skin, rosy cheeks (less chubby than age 5)

      - Large bright brown almond-shaped eyes with thick black lashes

      - Thin naturally arched black eyebrows

      - Small button nose

      - Small mouth with full lips

      - Dimples when smiling


      HAIR (FIXED):

      - Two neat pigtails positioned at sides above ears, each secured with bright
      red satin ribbons tied in bows

      - Hair length: to mid-back when down

      - Color: Jet black, naturally straight and shiny


      CLOTHING (FIXED):

      - Upper: Bright sunshine yellow knit cardigan sweater (longer than age 5 version)
      with buttons, ribbed collar

      - Lower: Darker-wash denim overalls with adjustable straps, two front pockets,
      one back pocket

      - Footwear: White canvas lace-up sneakers with yellow laces

      - White ankle socks visible


      ACCESSORIES (FIXED):

      - Red satin ribbons in hair (SIGNATURE - MUST ALWAYS APPEAR)

      - Small yellow backpack with cartoon bear patch (school setting)


      BODY (FIXED):

      - Leaner build than age 5, less chubby, more elongated proportions

      - Approximately 120-125cm tall

      - Longer limbs, less round belly

      - School-age athletic proportions


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative]

      ```


      ---'
    Xiaoming (å°æ˜) - Enhanced Lock: ''
    Xiaoming - Age 6 (Default, Early Elementary): '```

      CHARACTER ANCHOR LOCK - XIAOMING AGE 6

      ======================================


      NAME: Xiaoming (å°æ˜), 6-year-old Chinese boy


      FACE (FIXED):

      - Round face with fair skin

      - Bright sparkling brown eyes, slightly smaller than Yueyue''s, almond-shaped

      - Thick straight black eyebrows

      - Small rounded nose

      - Wide smile with front baby teeth visible when smiling, small gap between front
      teeth

      - No dimples

      - No freckles


      HAIR (FIXED):

      - Short neat black hair, 2-3cm length overall

      - Clean side part on left side

      - Naturally straight, slightly spiky on top from cowlick

      - Short sideburns, clean nape


      CLOTHING (FIXED):

      - Upper: Bright royal blue cotton t-shirt with ribbed crew neck, short sleeves

      - Lower: Light tan/khaki cotton shorts with elastic waistband, two side pockets

      - Footwear: Blue and white canvas sneakers with white laces

      - White crew socks visible above sneakers


      ACCESSORIES (FIXED):

      - May vary by story - specify in story setup

      - Example for outdoor: small red backpack


      BODY (FIXED):

      - Average build for 6-year-old boy, slightly stockier than Yueyue

      - Approximately 115-118cm tall

      - Boyish proportions with sturdy legs

      - Active child physique


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: adventurous/confident/tired/excited/etc.]

      ```'
    Xiaoming - Age 10 (Late Elementary): '```

      CHARACTER ANCHOR LOCK - XIAOMING AGE 10

      =======================================


      NAME: Xiaoming (å°æ˜), 10-year-old Chinese boy


      FACE (FIXED):

      - Oval face (less round than age 6) with fair skin

      - Bright brown almond-shaped eyes

      - Thick straight black eyebrows, slightly fuller

      - Small straight nose, more defined bridge

      - Wide smile with permanent teeth (adult teeth), no gap

      - No dimples


      HAIR (FIXED):

      - Short neat black hair, 3-4cm length

      - Clean side part on left side

      - Naturally straight, slight volume on top

      - Clean sideburns and nape


      CLOTHING (DEPENDS ON CONTEXT):


      **Outdoor/Hiking Context**:

      - Upper: Bright blue zip-up athletic/hiking jacket with orange side panels,
      standing collar

      - Lower: Gray quick-dry athletic/hiking pants with cargo pockets on thighs

      - Footwear: Brown leather hiking boots with red laces, black hiking socks visible

      - Accessories: Green canvas backpack with reflective strips, black hiking pole
      with red rubber grip


      **School Context**:

      - Upper: Royal blue polo shirt with white collar

      - Lower: Navy blue school uniform pants

      - Footwear: Black school shoes

      - Accessories: Navy backpack


      **Casual Context**:

      - Upper: Bright blue t-shirt with graphic

      - Lower: Denim jeans

      - Footwear: Blue and white sneakers

      - Accessories: Small backpack


      BODY (FIXED):

      - Average to athletic build for 10-year-old

      - Approximately 135-138cm tall

      - Pre-teen proportions, longer limbs

      - Developing shoulder muscles from activity


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative]

      ```


      ---'
    Lele (ä¹ä¹) - Enhanced Lock: ''
    Lele - Age 3 (Toddler): '```

      CHARACTER ANCHOR LOCK - LELE AGE 3

      ===================================


      NAME: Lele (ä¹ä¹), 3-year-old Chinese boy


      FACE (FIXED):

      - Very round chubby face with fair skin

      - Very large round brown eyes, wide-eyed innocent expression baseline

      - Thin soft black eyebrows

      - Small rounded button nose

      - Small mouth with full pouty lips

      - Very chubby rosy cheeks

      - Baby-faced features


      HAIR (FIXED):

      - Short fluffy black hair, 2cm length

      - No part, naturally tousled

      - Soft baby hair texture

      - Short even cut all around


      CLOTHING (FIXED):

      - Upper: Red and white horizontal striped cotton t-shirt with crew neck

      - Lower: Soft royal blue elastic-waist cotton pants (not jeans, soft fabric)

      - Footwear: Tiny red velcro-strap toddler shoes with white rubber soles

      - No socks visible or white ankle socks


      ACCESSORIES (FIXED):

      - May carry small toy (teddy bear, toy car) - specify per story


      BODY (FIXED):

      - Very chubby toddler build

      - Approximately 90-95cm tall

      - Round belly, very short limbs

      - Toddler proportions (head large relative to body)

      - Smooth baby skin


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: giggly/curious/sleepy/happy/etc.]

      ```


      ---'
    Meimei (ç¾ç¾) - Enhanced Lock: ''
    Meimei - Age 4 (Preschool): '```

      CHARACTER ANCHOR LOCK - MEIMEI AGE 4

      ====================================


      NAME: Meimei (ç¾ç¾), 4-year-old Chinese girl


      FACE (FIXED):

      - Heart-shaped face with fair skin

      - Large expressive brown eyes with long lashes, slightly cat-like shape

      - Thin delicate black eyebrows

      - Small petite nose

      - Small rosebud mouth with thin lips

      - Slight dimple on left cheek only

      - No freckles


      HAIR (FIXED):

      - Long black hair in high ponytail positioned at crown of head

      - Hair length: to mid-back

      - Secured with colorful plastic hairclip (rainbow or flower pattern - specify
      which per story)

      - Bangs cut straight across forehead

      - Naturally straight and shiny


      CLOTHING (FIXED):

      - Upper: Pastel pink cotton dress with short puff sleeves, white Peter Pan collar

      - Pattern: Small scattered flower print (daisies)

      - Lower: (dress) dress hem to knees, slightly A-line shape

      - Footwear: White strappy sandals with pink buckles

      - White ankle socks with lace trim


      ACCESSORIES (FIXED):

      - Colorful hairclip (rainbow OR flower - choose ONE per story and maintain)

      - May wear small bracelet or carry art supplies - specify per story


      BODY (FIXED):

      - Slender build for 4-year-old, less chubby than Lele

      - Approximately 100-102cm tall

      - Graceful proportions for age

      - Small hands and feet


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: creative/dreamy/focused/delighted/etc.]

      ```


      ---'
    Workflow Integration / å·¥ä½œæµç¨‹é›†æˆ: ''
    'Step 1: Story Setup (Page 1 or Cover)': '**å»ºç«‹é”å®š (Establish Lock)**


      When generating the FIRST page or COVER of a multi-page story:


      1. Select character and age

      2. Load appropriate CHARACTER ANCHOR LOCK template

      3. Specify any story-specific accessories (backpack color, toy, etc.)

      4. Generate COMPLETE lock with all 6 categories

      5. **SAVE THIS LOCK** - it will be copied to all subsequent pages


      ---'
    'Step 2: Subsequent Pages': "**å¤åˆ¶é”å®š (Copy Lock)**\n\nWhen generating pages 2,\
      \ 3, 4, etc.:\n\n1. **COPY THE ENTIRE CHARACTER ANCHOR LOCK** from Page 1 word-for-word\n\
      2. Change ONLY:\n   - Expression (to match narrative beat)\n   - Pose/action\
      \ (to match scene action)\n   - Clothing state (zipped/unzipped, clean/dirty\
      \ - but SAME items)\n3. Validate against CCLP checklist\n4. Generate\n\n---"
    'Step 3: Validation Before Output': "**è¾“å‡ºå‰éªŒè¯ (Validate Before Output)**\n\nBefore\
      \ finalizing each page prompt:\n\n**Automated Check**:\n```python\ndef validate_character_consistency(page_1_anchor,\
      \ current_page_anchor):\n    \"\"\"\n    Validate that current page maintains\
      \ character consistency with page 1.\n    Returns: (is_valid: bool, errors:\
      \ list)\n    \"\"\"\n    errors = []\n\n    # Extract fixed features from both\
      \ anchors\n    page_1_face = extract_face_features(page_1_anchor)\n    current_face\
      \ = extract_face_features(current_page_anchor)\n\n    if page_1_face != current_face:\n\
      \        errors.append(\"FACE FEATURES CHANGED - must match Page 1 exactly\"\
      )\n\n    page_1_hair = extract_hair_features(page_1_anchor)\n    current_hair\
      \ = extract_hair_features(current_page_anchor)\n\n    if page_1_hair != current_hair:\n\
      \        errors.append(\"HAIR FEATURES CHANGED - must match Page 1 exactly\"\
      )\n\n    page_1_clothing = extract_clothing_items(page_1_anchor)\n    current_clothing\
      \ = extract_clothing_items(current_page_anchor)\n\n    if page_1_clothing !=\
      \ current_clothing:\n        errors.append(\"CLOTHING CHANGED - must match Page\
      \ 1 exactly\")\n\n    # ... check other categories\n\n    if errors:\n     \
      \   return (False, errors)\n    else:\n        return (True, [])"
    'Usage in workflow:': "is_valid, errors = validate_character_consistency(page_1_anchor,\
      \ page_3_anchor)\nif not is_valid:\n    print(\"âŒ CHARACTER CONSISTENCY ERROR:\"\
      )\n    for error in errors:\n        print(f\"   - {error}\")\n    # Regenerate\
      \ with correct anchor\n```\n\n---"
    'Examples: Before vs After / å¯¹æ¯”ç¤ºä¾‹': ''
    'Example Story: "The Mountain Path" - CORRECTED': ''
    'âŒ BEFORE (Inconsistent):': '**Page 1**:

      ```

      wearing colorful hiking outfit with backpack and water bottle

      ```


      **Page 3**:

      ```

      wearing hiking outfit now slightly disheveled

      ```


      **Problem**: What is "colorful"? What colors? Image generator makes different
      choices each page.


      ---'
    'âœ… AFTER (Consistent with CCLP):': '**Cover Page - Establishes Lock**:

      ```

      CHARACTER ANCHOR LOCK - XIAOMING AGE 10 (HIKING CONTEXT)

      ========================================================


      NAME: Xiaoming (å°æ˜), 10-year-old Chinese boy


      FACE (FIXED):

      Round face with fair skin, bright brown almond-shaped eyes with thick lashes,

      thick straight black eyebrows, small straight nose, wide smile, no dimples


      HAIR (FIXED):

      Short neat black hair (3-4cm length) with clean side part on left,

      naturally straight with slight volume on top


      CLOTHING (FIXED):

      - Upper: Bright royal blue zip-up hiking jacket with vivid orange side panels
      and standing collar

      - Lower: Gray quick-dry hiking pants with black cargo pockets on thighs

      - Footwear: Brown leather hiking boots with bright red laces

      - Socks: Black hiking socks visible above boot tops


      ACCESSORIES (FIXED):

      - Forest green canvas backpack with silver reflective strips on straps

      - Black telescopic hiking pole with red rubber grip

      - Clear blue water bottle with white mountain logo (in backpack side pocket
      or in hand)


      BODY (FIXED):

      Average to athletic build, approximately 135cm tall, pre-teen proportions,

      developing shoulder muscles from regular outdoor activity


      EXPRESSION (VARIABLE): [Changes per page]

      ```


      **Page 1 - Uses Same Lock**:

      ```

      [COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Mixed excited-nervous expression, hand shading eyes looking up at
      trail

      POSE: Standing at trail entrance, one hand shading eyes, other hand on backpack
      strap

      ```


      **Page 3 - Uses Same Lock**:

      ```

      [COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Tired but determined expression, visible sweat drops on forehead,
      breathing heavily

      POSE: Gripping black hiking pole with red grip for support, leaning slightly
      forward while climbing

      CLOTHING STATE: Jacket unzipped halfway showing inner shirt, pants slightly
      dusty at knees

      ```


      **Page 7 - Uses Same Lock**:

      ```

      [COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Huge triumphant smile, eyes bright with achievement

      POSE: Standing at summit with arms raised in victory pose, hiking pole held
      high in right hand

      CLOTHING STATE: Jacket fully unzipped and hanging open, pants dusty, boots muddy

      ```


      **Notice**: Every page has IDENTICAL descriptions of:

      - Face features

      - Hair style and part

      - Jacket color (bright royal blue with vivid orange panels)

      - Pants color (gray)

      - Boot color (brown with red laces)

      - Backpack color (forest green)

      - Hiking pole color (black with red grip)


      ONLY these change:

      - Expression

      - Pose

      - Clothing state (zipped/unzipped, clean/dirty)


      ---'
    Special Cases / ç‰¹æ®Šæƒ…å†µ: ''
    'Case 1: Seasonal Clothing Change': '**Scenario**: Multi-page story spanning multiple
      seasons


      **Solution**: Create SEPARATE stories, OR establish "Season 2 outfit" on the
      transition page with narrative context.


      **Example**:

      ```

      Page 5 (Transition): "Yueyue changes into her winter coat before going outside."


      NEW CHARACTER ANCHOR LOCK - YUEYUE AGE 5 (WINTER)

      =================================================

      [Everything same as summer version EXCEPT:]


      CLOTHING (FIXED - WINTER VERSION):

      - Outer: Bright red puffy winter coat with white faux fur hood trim, zipper
      front

      - Under: Still yellow sweater (visible when coat unzipped)

      - Lower: Still denim overalls, but now with purple fleece leggings underneath

      - Footwear: Red waterproof snow boots with white fur trim

      ```


      **Rule**: Announce clothing change in narrative BEFORE it appears in image.


      ---'
    'Case 2: Lost/Found Item': '**Scenario**: Character loses hat, finds it later


      **Solution**: Narrative must explicitly mention loss/finding


      **Example**:

      ```

      Page 3: "Yueyue''s red ribbons came untied and fell off."

      Page 3 Image: [Pigtails without ribbons, ribbons in hand or on ground]


      Page 5: "Yueyue carefully ties her red ribbons back in her hair."

      Page 5 Image: [Ribbons back in place, same as Page 1]

      ```


      ---'
    'Case 3: Getting Dirty/Weathered': '**Scenario**: Clean â†’ muddy â†’ clean again


      **Solution**: Use clothing STATE modifiers, not color changes


      **Example**:

      ```

      Page 1: "bright yellow sweater" (CLEAN)

      Page 4: "bright yellow sweater with muddy smudges on sleeves" (DIRTY - same
      yellow)

      Page 7: "bright yellow sweater (freshly washed, clean)" (CLEAN AGAIN - same
      yellow)

      ```


      ---'
    Testing Protocol / æµ‹è¯•åè®®: ''
    'Test 1: Visual Consistency Verification': 'For any multi-page story, verify:


      1. **Export all CHARACTER ANCHOR LOCK sections** from all pages

      2. **Compare side-by-side**

      3. **Check that FIXED categories are 100% identical**

      4. **Check that only VARIABLE categories differ**


      **Pass Criteria**: âœ… 100% match on FIXED features across all pages


      ---'
    'Test 2: Regeneration Test': '1. Generate Page 1 with full CHARACTER ANCHOR LOCK

      2. Regenerate Page 1 three times using SAME lock

      3. Visual compare: Should produce highly similar results (same colors, same
      items)

      4. Generate Page 5 using SAME lock

      5. Visual compare Page 1 and Page 5: Should be recognizably same character


      **Pass Criteria**: âœ… 90%+ visual similarity in clothing, hair, face across regenerations


      ---'
    Summary / æ€»ç»“: ''
    Key Rules / å…³é”®è§„åˆ™: '1. **First page establishes complete CHARACTER ANCHOR LOCK**
      (6 categories specified)

      2. **All subsequent pages COPY the lock word-for-word**

      3. **Only expression, pose, and clothing state change**

      4. **No color changes, no item changes, no style changes**

      5. **Validate before output: 100% consistency check**'
    Quality Metrics / è´¨é‡æŒ‡æ ‡: '- **Target**: 95%+ visual consistency across multi-page
      stories

      - **Measurement**: User feedback + visual similarity analysis

      - **Success**: Readers immediately recognize same character across all pages


      ---'
    'ğŸ”´ CCLP 4.0: Enhanced Enforcement System (CRITICAL UPDATE)': '**Added**: 2026-01-11

      **Reason**: Despite perfect prompt consistency (v1.0-3.x), actual generated
      images still showed character inconsistencies'
    Problem Diagnosis v4.0: '**What We Found**:

      - âœ… **Prompts are 100% consistent** - Character anchors identical word-for-word
      across all pages

      - âœ… **SIGNATURE features properly marked** in every page

      - âœ… **LOCK-COPY mechanism working perfectly** at prompt generation level

      - âŒ **BUT: Generated images STILL inconsistent** - Same character looks different
      across pages


      **Root Causes**:

      1. **Generator limitation**: Banana nano doesn''t maintain consistency even
      with identical prompts

      2. **Prompt too long**: 350-400 words may exceed effective token range, truncating
      critical features

      3. **Missing explicit consistency commands**: No direct "maintain consistency"
      instructions

      4. **Weak SIGNATURE markers**: `(SIGNATURE)` notation insufficient for generator
      attention'
    Enhanced Solutions v4.0: ''
    'Enhancement 1: Explicit Consistency Enforcement Commands': '**Add to EVERY page
      after character anchor**:


      ```

      CRITICAL CONSISTENCY REQUIREMENT: This character MUST appear EXACTLY IDENTICAL
      to previous pages - SAME face shape, SAME hair style with SAME rainbow hairclip,
      SAME crimson red qipao dress, SAME shoes, NO variations allowed

      ```


      **Placement**:

      ```

      [Character Anchor - 150w] +

      [CONSISTENCY ENFORCEMENT - 25w] â† NEW +

      [Action/Pose] +

      [Scene] +

      ...

      ```'
    'Enhancement 2: MANDATORY SIGNATURE Feature Markers': '**OLD v1.0-3.x**:

      ```

      rainbow pattern plastic hairclip (SIGNATURE)

      ```


      **NEW v4.0**:

      ```

      rainbow pattern plastic hairclip **MANDATORY SIGNATURE FEATURE - MUST APPEAR**

      ```


      **Apply to ALL signature features**:

      - `rainbow pattern plastic hairclip **MANDATORY SIGNATURE FEATURE**`

      - `crimson red silk qipao dress **MANDATORY SIGNATURE FEATURE**`

      - `bright red velvet Mary Jane shoes **MANDATORY SIGNATURE FEATURE**`'
    'Enhancement 3: Prompt Compression (350w â†’ 280w)': '**Problem**: Long prompts
      (350-400w) may cause truncation, losing SIGNATURE features


      **Solution**: Compress to 280-300w by:

      1. Remove redundant adjectives

      2. Use shorter connector words

      3. Compress scene descriptions

      4. Keep ALL SIGNATURE features intact

      5. Prioritize character anchor in first half of prompt


      **Before (350w)**:

      ```

      Nianhua style children''s picture book illustration, an 8-year-old Chinese girl
      named Meimei, heart-shaped face with fair skin, large expressive brown eyes
      with long lashes and slightly cat-like shape showing artistic focus...

      ```


      **After (280w)**:

      ```

      Nianhua children''s book illustration, 8yo Chinese girl Meimei, heart-shaped
      face fair skin, large brown expressive eyes cat-like long lashes, **MANDATORY:
      rainbow pattern plastic hairclip**, **MANDATORY: crimson red silk qipao golden
      chrysanthemum embroidery**, **MANDATORY: bright red velvet Mary Jane shoes**,
      CRITICAL CONSISTENCY: EXACT SAME character as all pages - SAME face SAME rainbow
      clip SAME crimson qipao SAME red shoes NO variations...

      ```'
    'Enhancement 4: Watermark Directive v3.3 Update': '**OLD (weak - 2w)**:

      ```

      no watermark, clean image

      ```


      **NEW v3.3 Level 2 (35w - MANDATORY for multi-page)**:

      ```

      clean professional children''s book illustration, publication-ready quality,
      pristine unmarked image, full bleed composition, no watermark, no text overlays,
      no signatures, no artist marks, no logos, no branding, no copyright symbols,
      no website URLs, clean professional image

      ```'
    'Enhancement 5: Page Reference System': '**Page 1/Cover** - LOCK ESTABLISHMENT:

      ```

      [Full character anchor with MANDATORY markers]

      LOCK ESTABLISHED: This is the definitive appearance for [Character Name] - all
      subsequent pages must maintain identical visual features

      [Action/pose]

      ...

      ```


      **Page 2-5** - LOCK REFERENCE:

      ```

      [Full character anchor - IDENTICAL to Page 1]

      CONSISTENCY REFERENCE: Character appearance MUST exactly match Page 1 - [signature
      feature 1], [signature feature 2], [signature feature 3] REQUIRED

      [Action/pose variations ONLY]

      ...

      ```'
    CCLP 4.0 Complete Workflow: ''
    'Step 0: Determine Flexibility Level': '- STRICT: Short stories, single scene,
      same day â†’ Full 6-category lock

      - MODERATE: Multi-scene, scene-required changes â†’ 4-category + signatures

      - FLEXIBLE: Multi-season, growth themes â†’ Signatures only'
    'Step 1: Page 1/Cover - ESTABLISH ENHANCED LOCK': 'Generate complete CHARACTER
      ANCHOR LOCK with v4.0 enhancements:


      ```

      [Style] children''s picture book illustration,


      [Character Name], [age]-year-old Chinese [girl/boy],


      **CORE IDENTITY - IDENTICAL ALL PAGES**:

      Face: [detailed face description]

      Hair: [detailed hair] **MANDATORY: [signature accessory exact color/pattern]**

      Clothing: **MANDATORY: [exact top with colors]**, **MANDATORY: [exact bottom
      with colors]**, **MANDATORY: [exact footwear with colors]**

      Build: [body type], [height]cm, [age]-proportions


      LOCK ESTABLISHED: This is definitive appearance - all pages must maintain identical
      features,


      CRITICAL CONSISTENCY ENFORCEMENT: Character MUST appear EXACTLY IDENTICAL across
      all pages - SAME [sig feature 1], SAME [sig feature 2], SAME [sig feature 3],
      NO variations allowed,


      [Expression - VARIABLE],

      [Action/Pose - VARIABLE],

      [Scene - compressed],

      [Style keywords],

      [Rendering],


      clean professional children''s book illustration, publication-ready quality,
      pristine unmarked image, no watermark, no text overlays, no signatures, no artist
      marks, no logos, no branding, clean professional image

      ```


      **Total**: ~280-300 words'
    'Step 2: Pages 2-5 - APPLY ENHANCED LOCK': 'Copy CHARACTER ANCHOR LOCK word-for-word,
      add REFERENCE statement:


      ```

      [SAME character anchor as Page 1 - word-for-word copy with MANDATORY markers]


      CONSISTENCY REFERENCE: Character appearance MUST exactly match Page 1 - [sig
      1], [sig 2], [sig 3] REQUIRED,


      [NEW expression - VARIABLE],

      [NEW action/pose - VARIABLE],

      [Scene],

      [Style],

      [Rendering],


      clean professional children''s book illustration, publication-ready quality,
      pristine unmarked image, no watermark, no text overlays, no signatures, no artist
      marks, no logos, no branding, clean professional image

      ```'
    'Step 3: ENHANCED VALIDATION Checklist': '**Before Output - EVERY PAGE**:


      **Character Consistency (v4.0)**:

      - [ ] Character anchor IDENTICAL to Page 1 word-for-word

      - [ ] SIGNATURE features marked with `**MANDATORY**`

      - [ ] CONSISTENCY ENFORCEMENT command included

      - [ ] CONSISTENCY REFERENCE statement included (Pages 2+)

      - [ ] ONLY expression/pose differ from previous pages

      - [ ] NO clothing/hair/accessory color or item changes


      **Prompt Quality (v4.0)**:

      - [ ] Total prompt length 280-300 words (compressed)

      - [ ] SIGNATURE features in first half of prompt

      - [ ] Watermark directive v3.3 Level 2 at absolute END

      - [ ] All MANDATORY markers present


      **Forbidden Changes**:

      - âŒ Hair color/style change

      - âŒ Accessory change/removal

      - âŒ Clothing color change

      - âŒ Clothing item change

      - âŒ Footwear change

      - âŒ Face shape change

      - âŒ Body type change


      **Allowed Changes**:

      - âœ… Expression only

      - âœ… Pose/action only

      - âœ… Hand gestures

      - âœ… Clothing state (zipped/clean, BUT same items/colors)'
    Expected Improvement Metrics: '| Aspect | CCLP 1.0-3.x | CCLP 4.0 | Target Improvement
      |

      |--------|--------------|----------|-------------------|

      | Prompt Consistency | 100% âœ… | 100% âœ… | Maintained |

      | Image Consistency | ~40% âŒ | ~85% ğŸ¯ | +45% |

      | Watermark Prevention | 60% âš ï¸ | 95% ğŸ¯ | +35% |

      | Prompt Length | 350-400w | 280-300w | -20% optimized |

      | SIGNATURE Emphasis | Standard | **MANDATORY** | Enhanced attention |

      | Explicit Commands | None | Added | NEW critical layer |'
    Fallback Strategies if v4.0 Fails: '1. **Contact Generator Support**: Request
      character consistency settings/features

      2. **Try Alternative Generators**: Midjourney `--cref`, Stable Diffusion LoRA

      3. **Hybrid Approach**: Use Page 1 image as reference for subsequent generations

      4. **Accept Controlled Variation**: Document acceptable variance, focus on SIGNATURE
      presence'
    Reference Documentation: '- **Complete v4.0 System**: `references/guides/CCLP-ENFORCEMENT-ENHANCED.md`

      - **Watermark System**: `references/config/rendering.md` v3.3

      - **Flexibility Framework**: `references/config/CCLP-FLEXIBILITY.md`


      ---


      **File Version**: 4.0 (Enhanced Enforcement)

      **Created**: 2026-01-10 (v1.0)

      **Updated**: 2026-01-11 (v4.0 - Critical consistency fixes)

      **Status**: âœ… Active - MANDATORY for all multi-page story generation

      **Priority**: ğŸ”´ CRITICAL - Addresses core product quality issue'
  templates:
  - lang: text
    code: 'A 5-year-old Chinese girl named Yueyue, round face, rosy cheeks,

      two pigtails with red ribbons, wearing yellow sweater and denim overalls'
  - lang: text
    code: "CHARACTER ANCHOR LOCK (é¡µé¢1å»ºç«‹ï¼Œåç»­é¡µé¢å®Œå…¨å¤åˆ¶)\n===========================================\n\
      \n1. NAME & AGE\n   è§’è‰²å§“åä¸å¹´é¾„\n   - Full name: [Character Name] ([Chinese Name])\n\
      \   - Age: [X] years old\n   - Age-appropriate proportions: [specific body proportions]\n\
      \n2. FACE (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   é¢éƒ¨å›ºå®šç‰¹å¾\n   - Face shape: [round/oval/heart-shaped]\n\
      \   - Skin tone: [fair/light tan/medium]\n   - Eyes: [shape] [color] eyes with\
      \ [detail]\n   - Eyebrows: [thick/thin] [arched/straight] eyebrows\n   - Nose:\
      \ [small button/rounded/petite] nose\n   - Mouth: [small/medium] mouth with\
      \ [full/thin] lips\n   - Cheeks: [rosy/round/chubby] cheeks\n   - Special marks:\
      \ [freckles/dimples/none]\n\n3. HAIR (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   å‘å‹å›ºå®šç‰¹å¾\n  \
      \ - Style: [specific style, e.g., \"two pigtails\"]\n   - Length: [to shoulders/to\
      \ chin/short]\n   - Color: [black/brown/other]\n   - Texture: [straight/wavy/curly]\n\
      \   - Accessories: [specific, e.g., \"red satin ribbons\"]\n   - Parting: [side\
      \ part/center part/no part]\n\n4. CLOTHING (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   æœè£…å›ºå®šç‰¹å¾\n\
      \   - Upper: [specific item + exact color]\n     Example: \"bright yellow knit\
      \ sweater with ribbed collar\"\n   - Lower: [specific item + exact color]\n\
      \     Example: \"medium-wash denim overalls with metal clips\"\n   - Footwear:\
      \ [specific + color]\n     Example: \"white canvas sneakers with pink laces\"\
      \n   - Outerwear (if any): [specific + color]\n     Example: \"red windbreaker\
      \ jacket\"\n\n5. ACCESSORIES (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   é…é¥°å›ºå®šç‰¹å¾\n   - Always\
      \ visible: [items that appear in every page]\n     Example: \"small blue backpack\
      \ with teddy bear keychain\"\n   - Sometimes visible: [items that may be held/set\
      \ down]\n     Example: \"water bottle in hand or in backpack side pocket\"\n\
      \   - Signature items: [unique identifiers]\n     Example: \"rainbow friendship\
      \ bracelet on left wrist\"\n\n6. BODY TYPE (å›ºå®šç‰¹å¾ - FIXED FEATURES)\n   ä½“å‹å›ºå®šç‰¹å¾\n\
      \   - Build: [slim/average/stocky/chubby]\n   - Height: [relative to age, e.g.,\
      \ \"average height for 5-year-old\"]\n   - Proportions: [specific, e.g., \"\
      slightly shorter legs, rounder belly typical of preschooler\"]\n\n7. EXPRESSION\
      \ VARIABLES (å¯å˜ç‰¹å¾ - VARIABLE FEATURES)\n   è¡¨æƒ…å¯å˜ç‰¹å¾\n   - This is the ONLY part\
      \ that changes per page\n   - Examples: \"curious expression\", \"tired but\
      \ determined\", \"joyful smile\"\n   - NEVER include expression details in the\
      \ CHARACTER LOCK"
  - lang: text
    code: "A 10-year-old Chinese boy named Xiaoming (å°æ˜),\n- Face: Round face with\
      \ fair skin, bright almond-shaped brown eyes with thick lashes,\n  straight\
      \ black eyebrows, small button nose, small mouth with full lips, rosy cheeks\n\
      - Hair: Short neat black hair (2-3 cm length) with clean side part on left,\n\
      \  naturally straight texture\n- Clothing: Bright blue zip-up hiking jacket\
      \ with orange side panels,\n  gray quick-dry hiking pants with cargo pockets,\n\
      \  brown leather hiking boots with red laces\n- Accessories: Green canvas backpack\
      \ with reflective strips,\n  black hiking pole with red grip,\n  water bottle\
      \ (blue with mountain logo) in backpack side pocket\n- Body: Average build for\
      \ 10-year-old, approximately 135cm tall,\n  athletic proportions with developing\
      \ muscles from regular outdoor activity"
  - lang: text
    code: "A 10-year-old Chinese boy named Xiaoming (å°æ˜),\n- Face: Round face with\
      \ fair skin, bright almond-shaped brown eyes with thick lashes,\n  straight\
      \ black eyebrows, small button nose, small mouth with full lips, rosy cheeks\n\
      - Hair: Short neat black hair (2-3 cm length) with clean side part on left,\n\
      \  naturally straight texture\n- Clothing: Bright blue zip-up hiking jacket\
      \ with orange side panels (now slightly unzipped),\n  gray quick-dry hiking\
      \ pants with cargo pockets,\n  brown leather hiking boots with red laces\n-\
      \ Accessories: Green canvas backpack with reflective strips,\n  black hiking\
      \ pole with red grip gripped firmly,\n  water bottle visible in hand\n- Body:\
      \ Average build for 10-year-old, approximately 135cm tall,\n  athletic proportions\n\
      - Expression: [NEW] Tired but determined expression, visible sweat on forehead,\
      \ breathing heavily\n- Pose: [NEW] Gripping hiking pole, one foot forward on\
      \ steep trail"
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - YUEYUE AGE 5

      ====================================


      NAME: Yueyue (æ‚¦æ‚¦), 5-year-old Chinese girl


      FACE (FIXED):

      - Round face with fair skin and natural rosy cheeks

      - Large bright brown almond-shaped eyes with thick black lashes

      - Thin naturally arched black eyebrows

      - Small button nose

      - Small mouth with full lips, often smiling

      - Dimples when smiling

      - No freckles or marks


      HAIR (FIXED):

      - Two high pigtails positioned above ears, each secured with bright red satin
      ribbons tied in bows

      - Hair length: to shoulders when down

      - Color: Jet black, naturally straight and shiny

      - Baby hairs around hairline


      CLOTHING (FIXED):

      - Upper: Bright sunshine yellow knit sweater with ribbed crew neck collar and
      cuffs

      - Lower: Medium-wash denim overalls with adjustable metal clip straps, two front
      pockets

      - Footwear: White canvas slip-on sneakers with elastic bands

      - No socks visible


      ACCESSORIES (FIXED):

      - Red satin ribbons in hair (SIGNATURE - MUST ALWAYS APPEAR)

      - Small items may vary by story (backpack, toy, etc.) - specify in story setup


      BODY (FIXED):

      - Chubby preschooler build typical of 5-year-old

      - Approximately 105-110cm tall

      - Round belly, short arms and legs proportional to age

      - Smooth unblemished skin


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: curious/joyful/surprised/determined/etc.]'
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - YUEYUE AGE 8

      ====================================


      NAME: Yueyue (æ‚¦æ‚¦), 8-year-old Chinese girl


      FACE (FIXED):

      - Round face with fair skin, rosy cheeks (less chubby than age 5)

      - Large bright brown almond-shaped eyes with thick black lashes

      - Thin naturally arched black eyebrows

      - Small button nose

      - Small mouth with full lips

      - Dimples when smiling


      HAIR (FIXED):

      - Two neat pigtails positioned at sides above ears, each secured with bright
      red satin ribbons tied in bows

      - Hair length: to mid-back when down

      - Color: Jet black, naturally straight and shiny


      CLOTHING (FIXED):

      - Upper: Bright sunshine yellow knit cardigan sweater (longer than age 5 version)
      with buttons, ribbed collar

      - Lower: Darker-wash denim overalls with adjustable straps, two front pockets,
      one back pocket

      - Footwear: White canvas lace-up sneakers with yellow laces

      - White ankle socks visible


      ACCESSORIES (FIXED):

      - Red satin ribbons in hair (SIGNATURE - MUST ALWAYS APPEAR)

      - Small yellow backpack with cartoon bear patch (school setting)


      BODY (FIXED):

      - Leaner build than age 5, less chubby, more elongated proportions

      - Approximately 120-125cm tall

      - Longer limbs, less round belly

      - School-age athletic proportions


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative]'
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - XIAOMING AGE 6

      ======================================


      NAME: Xiaoming (å°æ˜), 6-year-old Chinese boy


      FACE (FIXED):

      - Round face with fair skin

      - Bright sparkling brown eyes, slightly smaller than Yueyue''s, almond-shaped

      - Thick straight black eyebrows

      - Small rounded nose

      - Wide smile with front baby teeth visible when smiling, small gap between front
      teeth

      - No dimples

      - No freckles


      HAIR (FIXED):

      - Short neat black hair, 2-3cm length overall

      - Clean side part on left side

      - Naturally straight, slightly spiky on top from cowlick

      - Short sideburns, clean nape


      CLOTHING (FIXED):

      - Upper: Bright royal blue cotton t-shirt with ribbed crew neck, short sleeves

      - Lower: Light tan/khaki cotton shorts with elastic waistband, two side pockets

      - Footwear: Blue and white canvas sneakers with white laces

      - White crew socks visible above sneakers


      ACCESSORIES (FIXED):

      - May vary by story - specify in story setup

      - Example for outdoor: small red backpack


      BODY (FIXED):

      - Average build for 6-year-old boy, slightly stockier than Yueyue

      - Approximately 115-118cm tall

      - Boyish proportions with sturdy legs

      - Active child physique


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: adventurous/confident/tired/excited/etc.]'
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - XIAOMING AGE 10

      =======================================


      NAME: Xiaoming (å°æ˜), 10-year-old Chinese boy


      FACE (FIXED):

      - Oval face (less round than age 6) with fair skin

      - Bright brown almond-shaped eyes

      - Thick straight black eyebrows, slightly fuller

      - Small straight nose, more defined bridge

      - Wide smile with permanent teeth (adult teeth), no gap

      - No dimples


      HAIR (FIXED):

      - Short neat black hair, 3-4cm length

      - Clean side part on left side

      - Naturally straight, slight volume on top

      - Clean sideburns and nape


      CLOTHING (DEPENDS ON CONTEXT):


      **Outdoor/Hiking Context**:

      - Upper: Bright blue zip-up athletic/hiking jacket with orange side panels,
      standing collar

      - Lower: Gray quick-dry athletic/hiking pants with cargo pockets on thighs

      - Footwear: Brown leather hiking boots with red laces, black hiking socks visible

      - Accessories: Green canvas backpack with reflective strips, black hiking pole
      with red rubber grip


      **School Context**:

      - Upper: Royal blue polo shirt with white collar

      - Lower: Navy blue school uniform pants

      - Footwear: Black school shoes

      - Accessories: Navy backpack


      **Casual Context**:

      - Upper: Bright blue t-shirt with graphic

      - Lower: Denim jeans

      - Footwear: Blue and white sneakers

      - Accessories: Small backpack


      BODY (FIXED):

      - Average to athletic build for 10-year-old

      - Approximately 135-138cm tall

      - Pre-teen proportions, longer limbs

      - Developing shoulder muscles from activity


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative]'
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - LELE AGE 3

      ===================================


      NAME: Lele (ä¹ä¹), 3-year-old Chinese boy


      FACE (FIXED):

      - Very round chubby face with fair skin

      - Very large round brown eyes, wide-eyed innocent expression baseline

      - Thin soft black eyebrows

      - Small rounded button nose

      - Small mouth with full pouty lips

      - Very chubby rosy cheeks

      - Baby-faced features


      HAIR (FIXED):

      - Short fluffy black hair, 2cm length

      - No part, naturally tousled

      - Soft baby hair texture

      - Short even cut all around


      CLOTHING (FIXED):

      - Upper: Red and white horizontal striped cotton t-shirt with crew neck

      - Lower: Soft royal blue elastic-waist cotton pants (not jeans, soft fabric)

      - Footwear: Tiny red velcro-strap toddler shoes with white rubber soles

      - No socks visible or white ankle socks


      ACCESSORIES (FIXED):

      - May carry small toy (teddy bear, toy car) - specify per story


      BODY (FIXED):

      - Very chubby toddler build

      - Approximately 90-95cm tall

      - Round belly, very short limbs

      - Toddler proportions (head large relative to body)

      - Smooth baby skin


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: giggly/curious/sleepy/happy/etc.]'
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - MEIMEI AGE 4

      ====================================


      NAME: Meimei (ç¾ç¾), 4-year-old Chinese girl


      FACE (FIXED):

      - Heart-shaped face with fair skin

      - Large expressive brown eyes with long lashes, slightly cat-like shape

      - Thin delicate black eyebrows

      - Small petite nose

      - Small rosebud mouth with thin lips

      - Slight dimple on left cheek only

      - No freckles


      HAIR (FIXED):

      - Long black hair in high ponytail positioned at crown of head

      - Hair length: to mid-back

      - Secured with colorful plastic hairclip (rainbow or flower pattern - specify
      which per story)

      - Bangs cut straight across forehead

      - Naturally straight and shiny


      CLOTHING (FIXED):

      - Upper: Pastel pink cotton dress with short puff sleeves, white Peter Pan collar

      - Pattern: Small scattered flower print (daisies)

      - Lower: (dress) dress hem to knees, slightly A-line shape

      - Footwear: White strappy sandals with pink buckles

      - White ankle socks with lace trim


      ACCESSORIES (FIXED):

      - Colorful hairclip (rainbow OR flower - choose ONE per story and maintain)

      - May wear small bracelet or carry art supplies - specify per story


      BODY (FIXED):

      - Slender build for 4-year-old, less chubby than Lele

      - Approximately 100-102cm tall

      - Graceful proportions for age

      - Small hands and feet


      EXPRESSION (VARIABLE per page):

      - [Changes with narrative: creative/dreamy/focused/delighted/etc.]'
  - lang: python
    code: "def validate_character_consistency(page_1_anchor, current_page_anchor):\n\
      \    \"\"\"\n    Validate that current page maintains character consistency\
      \ with page 1.\n    Returns: (is_valid: bool, errors: list)\n    \"\"\"\n  \
      \  errors = []\n\n    # Extract fixed features from both anchors\n    page_1_face\
      \ = extract_face_features(page_1_anchor)\n    current_face = extract_face_features(current_page_anchor)\n\
      \n    if page_1_face != current_face:\n        errors.append(\"FACE FEATURES\
      \ CHANGED - must match Page 1 exactly\")\n\n    page_1_hair = extract_hair_features(page_1_anchor)\n\
      \    current_hair = extract_hair_features(current_page_anchor)\n\n    if page_1_hair\
      \ != current_hair:\n        errors.append(\"HAIR FEATURES CHANGED - must match\
      \ Page 1 exactly\")\n\n    page_1_clothing = extract_clothing_items(page_1_anchor)\n\
      \    current_clothing = extract_clothing_items(current_page_anchor)\n\n    if\
      \ page_1_clothing != current_clothing:\n        errors.append(\"CLOTHING CHANGED\
      \ - must match Page 1 exactly\")\n\n    # ... check other categories\n\n   \
      \ if errors:\n        return (False, errors)\n    else:\n        return (True,\
      \ [])\n\n# Usage in workflow:\nis_valid, errors = validate_character_consistency(page_1_anchor,\
      \ page_3_anchor)\nif not is_valid:\n    print(\"âŒ CHARACTER CONSISTENCY ERROR:\"\
      )\n    for error in errors:\n        print(f\"   - {error}\")\n    # Regenerate\
      \ with correct anchor"
  - lang: text
    code: wearing colorful hiking outfit with backpack and water bottle
  - lang: text
    code: wearing hiking outfit now slightly disheveled
  - lang: text
    code: 'CHARACTER ANCHOR LOCK - XIAOMING AGE 10 (HIKING CONTEXT)

      ========================================================


      NAME: Xiaoming (å°æ˜), 10-year-old Chinese boy


      FACE (FIXED):

      Round face with fair skin, bright brown almond-shaped eyes with thick lashes,

      thick straight black eyebrows, small straight nose, wide smile, no dimples


      HAIR (FIXED):

      Short neat black hair (3-4cm length) with clean side part on left,

      naturally straight with slight volume on top


      CLOTHING (FIXED):

      - Upper: Bright royal blue zip-up hiking jacket with vivid orange side panels
      and standing collar

      - Lower: Gray quick-dry hiking pants with black cargo pockets on thighs

      - Footwear: Brown leather hiking boots with bright red laces

      - Socks: Black hiking socks visible above boot tops


      ACCESSORIES (FIXED):

      - Forest green canvas backpack with silver reflective strips on straps

      - Black telescopic hiking pole with red rubber grip

      - Clear blue water bottle with white mountain logo (in backpack side pocket
      or in hand)


      BODY (FIXED):

      Average to athletic build, approximately 135cm tall, pre-teen proportions,

      developing shoulder muscles from regular outdoor activity


      EXPRESSION (VARIABLE): [Changes per page]'
  - lang: text
    code: '[COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Mixed excited-nervous expression, hand shading eyes looking up at
      trail

      POSE: Standing at trail entrance, one hand shading eyes, other hand on backpack
      strap'
  - lang: text
    code: '[COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Tired but determined expression, visible sweat drops on forehead,
      breathing heavily

      POSE: Gripping black hiking pole with red grip for support, leaning slightly
      forward while climbing

      CLOTHING STATE: Jacket unzipped halfway showing inner shirt, pants slightly
      dusty at knees'
  - lang: text
    code: '[COPY ENTIRE LOCK FROM COVER - IDENTICAL]


      EXPRESSION: Huge triumphant smile, eyes bright with achievement

      POSE: Standing at summit with arms raised in victory pose, hiking pole held
      high in right hand

      CLOTHING STATE: Jacket fully unzipped and hanging open, pants dusty, boots muddy'
  - lang: text
    code: 'Page 5 (Transition): "Yueyue changes into her winter coat before going
      outside."


      NEW CHARACTER ANCHOR LOCK - YUEYUE AGE 5 (WINTER)

      =================================================

      [Everything same as summer version EXCEPT:]


      CLOTHING (FIXED - WINTER VERSION):

      - Outer: Bright red puffy winter coat with white faux fur hood trim, zipper
      front

      - Under: Still yellow sweater (visible when coat unzipped)

      - Lower: Still denim overalls, but now with purple fleece leggings underneath

      - Footwear: Red waterproof snow boots with white fur trim'
  - lang: text
    code: 'Page 3: "Yueyue''s red ribbons came untied and fell off."

      Page 3 Image: [Pigtails without ribbons, ribbons in hand or on ground]


      Page 5: "Yueyue carefully ties her red ribbons back in her hair."

      Page 5 Image: [Ribbons back in place, same as Page 1]'
  - lang: text
    code: 'Page 1: "bright yellow sweater" (CLEAN)

      Page 4: "bright yellow sweater with muddy smudges on sleeves" (DIRTY - same
      yellow)

      Page 7: "bright yellow sweater (freshly washed, clean)" (CLEAN AGAIN - same
      yellow)'
  - lang: text
    code: 'CRITICAL CONSISTENCY REQUIREMENT: This character MUST appear EXACTLY IDENTICAL
      to previous pages - SAME face shape, SAME hair style with SAME rainbow hairclip,
      SAME crimson red qipao dress, SAME shoes, NO variations allowed'
  - lang: text
    code: '[Character Anchor - 150w] +

      [CONSISTENCY ENFORCEMENT - 25w] â† NEW +

      [Action/Pose] +

      [Scene] +

      ...'
  - lang: text
    code: rainbow pattern plastic hairclip (SIGNATURE)
  - lang: text
    code: rainbow pattern plastic hairclip **MANDATORY SIGNATURE FEATURE - MUST APPEAR**
  - lang: text
    code: Nianhua style children's picture book illustration, an 8-year-old Chinese
      girl named Meimei, heart-shaped face with fair skin, large expressive brown
      eyes with long lashes and slightly cat-like shape showing artistic focus...
  - lang: text
    code: 'Nianhua children''s book illustration, 8yo Chinese girl Meimei, heart-shaped
      face fair skin, large brown expressive eyes cat-like long lashes, **MANDATORY:
      rainbow pattern plastic hairclip**, **MANDATORY: crimson red silk qipao golden
      chrysanthemum embroidery**, **MANDATORY: bright red velvet Mary Jane shoes**,
      CRITICAL CONSISTENCY: EXACT SAME character as all pages - SAME face SAME rainbow
      clip SAME crimson qipao SAME red shoes NO variations...'
  - lang: text
    code: no watermark, clean image
  - lang: text
    code: clean professional children's book illustration, publication-ready quality,
      pristine unmarked image, full bleed composition, no watermark, no text overlays,
      no signatures, no artist marks, no logos, no branding, no copyright symbols,
      no website URLs, clean professional image
  - lang: text
    code: '[Full character anchor with MANDATORY markers]

      LOCK ESTABLISHED: This is the definitive appearance for [Character Name] - all
      subsequent pages must maintain identical visual features

      [Action/pose]

      ...'
  - lang: text
    code: '[Full character anchor - IDENTICAL to Page 1]

      CONSISTENCY REFERENCE: Character appearance MUST exactly match Page 1 - [signature
      feature 1], [signature feature 2], [signature feature 3] REQUIRED

      [Action/pose variations ONLY]

      ...'
  - lang: text
    code: '[Style] children''s picture book illustration,


      [Character Name], [age]-year-old Chinese [girl/boy],


      **CORE IDENTITY - IDENTICAL ALL PAGES**:

      Face: [detailed face description]

      Hair: [detailed hair] **MANDATORY: [signature accessory exact color/pattern]**

      Clothing: **MANDATORY: [exact top with colors]**, **MANDATORY: [exact bottom
      with colors]**, **MANDATORY: [exact footwear with colors]**

      Build: [body type], [height]cm, [age]-proportions


      LOCK ESTABLISHED: This is definitive appearance - all pages must maintain identical
      features,


      CRITICAL CONSISTENCY ENFORCEMENT: Character MUST appear EXACTLY IDENTICAL across
      all pages - SAME [sig feature 1], SAME [sig feature 2], SAME [sig feature 3],
      NO variations allowed,


      [Expression - VARIABLE],

      [Action/Pose - VARIABLE],

      [Scene - compressed],

      [Style keywords],

      [Rendering],


      clean professional children''s book illustration, publication-ready quality,
      pristine unmarked image, no watermark, no text overlays, no signatures, no artist
      marks, no logos, no branding, clean professional image'
  - lang: text
    code: '[SAME character anchor as Page 1 - word-for-word copy with MANDATORY markers]


      CONSISTENCY REFERENCE: Character appearance MUST exactly match Page 1 - [sig
      1], [sig 2], [sig 3] REQUIRED,


      [NEW expression - VARIABLE],

      [NEW action/pose - VARIABLE],

      [Scene],

      [Style],

      [Rendering],


      clean professional children''s book illustration, publication-ready quality,
      pristine unmarked image, no watermark, no text overlays, no signatures, no artist
      marks, no logos, no branding, clean professional image'
flexibility_levels:
  CCLP Flexibility Framework / CCLPçµæ´»æ€§æ¡†æ¶: '**Version**: 2.0

    **Date**: 2026-01-10

    **Purpose**: Provide flexible character consistency levels to balance visual consistency
    with narrative realism


    **ç‰ˆæœ¬**: 2.0

    **æ—¥æœŸ**: 2026-01-10

    **ç›®çš„**: æä¾›çµæ´»çš„è§’è‰²ä¸€è‡´æ€§çº§åˆ«ï¼Œå¹³è¡¡è§†è§‰ä¸€è‡´æ€§ä¸å™äº‹çœŸå®æ€§


    ---'
  Problem Statement / é—®é¢˜é™ˆè¿°: ''
  Original CCLP (v1.0) Achievement / åŸå§‹CCLPæˆå°±: 'âœ… **Successfully Solved**: Random
    character appearance variation due to vague prompts

    - Example: "colorful hiking outfit" â†’ different colors on each page

    - Solution: Specific color locking (STRICT CCLP)


    âœ… **æˆåŠŸè§£å†³**: ç”±äºæ¨¡ç³Šæç¤ºè¯å¯¼è‡´çš„è§’è‰²å¤–è§‚éšæœºå˜åŒ–

    - ä¾‹å­ï¼š"å½©è‰²ç™»å±±æœ" â†’ æ¯é¡µä¸åŒé¢œè‰²

    - è§£å†³æ–¹æ¡ˆ: å…·ä½“é¢œè‰²é”å®šï¼ˆä¸¥æ ¼CCLPï¼‰'
  Limitation of One-Size-Fits-All Approach / ä¸€åˆ€åˆ‡æ–¹æ³•çš„å±€é™æ€§: "âŒ **Problem**: STRICT CCLP\
    \ is too extreme for certain story types:\n\n1. **Daily Life Stories** - Unrealistic\n\
    \   - Child wears same clothes all day (sleeping, school, playing)\n   - Doesn't\
    \ teach proper daily habits\n\n2. **Special Activity Stories** - Safety Issues\n\
    \   - Swimming in regular clothes (dangerous)\n   - Sleeping in daytime clothes\
    \ (unrealistic)\n\n3. **Seasonal Stories** - Educational Conflict\n   - Wearing\
    \ summer clothes in winter (would freeze)\n   - Can't teach seasonal adaptation\n\
    \n4. **Growth Stories** - Theme Contradiction\n   - 7-year-old looks like 3-year-old\
    \ (can't show growth)\n   - Body type locked prevents showing development\n\n\
    âŒ **é—®é¢˜**: ä¸¥æ ¼CCLPå¯¹æŸäº›æ•…äº‹ç±»å‹è¿‡äºæç«¯ï¼š\n\n1. **æ—¥å¸¸ç”Ÿæ´»æ•…äº‹** - ä¸ç¬¦åˆç°å®\n   - å­©å­å…¨å¤©ç©¿åŒä¸€å¥—è¡£æœï¼ˆç¡è§‰ã€ä¸Šå­¦ã€ç©è€ï¼‰\n\
    \   - ä¸èƒ½æ•™æ­£ç¡®çš„æ—¥å¸¸ä¹ æƒ¯\n\n2. **ç‰¹æ®Šæ´»åŠ¨æ•…äº‹** - å®‰å…¨é—®é¢˜\n   - ç©¿æ—¥å¸¸è¡£æœæ¸¸æ³³ï¼ˆå±é™©ï¼‰\n   - ç©¿ç™½å¤©è¡£æœç¡è§‰ï¼ˆä¸ç°å®ï¼‰\n\
    \n3. **å­£èŠ‚æ•…äº‹** - æ•™è‚²å†²çª\n   - å†¬å¤©ç©¿å¤è£…ï¼ˆä¼šå†»ï¼‰\n   - ä¸èƒ½æ•™å­£èŠ‚é€‚åº”\n\n4. **æˆé•¿æ•…äº‹** - ä¸»é¢˜çŸ›ç›¾\n   -\
    \ 7å²çœ‹èµ·æ¥åƒ3å²ï¼ˆä¸èƒ½å±•ç¤ºæˆé•¿ï¼‰\n   - ä½“å‹é”å®šé˜»æ­¢å±•ç¤ºå‘è‚²\n\n---"
  'Solution: Three-Tier CCLP System / è§£å†³æ–¹æ¡ˆï¼šä¸‰å±‚CCLPç³»ç»Ÿ': ''
  Architecture Overview / æ¶æ„æ¦‚è§ˆ: "```\nCCLP v2.0 Flexibility Framework\nâ”œâ”€â”€ STRICT\
    \ CCLP (ä¸¥æ ¼æ¨¡å¼)\nâ”‚   â””â”€â”€ Original CCLP - Full consistency\nâ”‚\nâ”œâ”€â”€ MODERATE CCLP\
    \ (ä¸­ç­‰æ¨¡å¼) \U0001F195\nâ”‚   â””â”€â”€ Scene-adaptive consistency\nâ”‚\nâ””â”€â”€ FLEXIBLE CCLP\
    \ (çµæ´»æ¨¡å¼) \U0001F195\n    â””â”€â”€ Time/theme-adaptive consistency\n```\n\n**Core Principle**:\
    \ Different story types need different consistency levels\n**æ ¸å¿ƒåŸåˆ™**: ä¸åŒæ•…äº‹ç±»å‹éœ€è¦ä¸åŒçš„ä¸€è‡´æ€§çº§åˆ«\n\
    \n---"
  'Level 1: STRICT CCLP (ä¸¥æ ¼æ¨¡å¼) â­ Default for Short Stories': ''
  When to Use / ä½•æ—¶ä½¿ç”¨: 'âœ… **Ideal For**:

    - Long stories (10-15 pages)

    - Multi-day or multi-season narratives

    - Growth/development themes

    - Time passage stories


    âœ… **é€‚ç”¨äº**:

    - é•¿ç¯‡æ•…äº‹ï¼ˆ10-15é¡µï¼‰

    - å¤šå¤©æˆ–å¤šå­£èŠ‚å™äº‹

    - æˆé•¿/å‘å±•ä¸»é¢˜

    - æ—¶é—´æµé€æ•…äº‹


    **Examples**:

    - ã€Šå››å­£çš„å˜åŒ–ã€‹(Four Seasons) - spring â†’ summer â†’ autumn â†’ winter

    - ã€Šæˆ‘é•¿å¤§äº†ã€‹(I Grew Up) - age 3 â†’ age 5 â†’ age 7

    - ã€Šç§å­æˆé•¿è®°ã€‹(Seed Growth) - planting â†’ sprouting â†’ flowering â†’ fruiting'
  Rules / è§„åˆ™: "**2 FIXED Categories** (MUST remain identical):\n\n1. **SIGNATURE FEATURES**\
    \ (ç­¾åç‰¹å¾) - Core identity markers\n   - Yueyue: Red ribbons (ALWAYS in hair, even\
    \ if hairstyle changes)\n   - Xiaoming: Side part (ALWAYS, even if hair grows)\n\
    \   - Meimei: Colorful hairclip (ALWAYS, even if ponytail position changes)\n\
    \   - These are the \"brand identity\" that readers recognize\n\n2. **CHARACTER\
    \ PERSONALITY** (è§’è‰²æ€§æ ¼)\n   - Yueyue: Curious and gentle\n   - Xiaoming: Adventurous\
    \ and energetic\n   - Maintained through expressions and actions\n\n**5 ADAPTIVE\
    \ Categories** (Can change with time/theme justification):\n\n3. **FACE** (é¢éƒ¨)\
    \ - Can show aging/growth\n   - Preschool â†’ Elementary: Less chubby, more defined\
    \ features\n   - MUST be gradual and age-appropriate\n\n4. **HAIR** (å¤´å‘) - Can\
    \ change style while keeping signature\n   - Length can grow, style can evolve\n\
    \   - Signature accessory (ribbons, hairclip) MUST remain\n\n5. **CLOTHING** (è¡£æœ)\
    \ - Seasonal/age-appropriate changes\n   - Spring â†’ Summer â†’ Autumn â†’ Winter outfits\n\
    \   - Age 3 toddler clothes â†’ Age 7 school clothes\n   - Signature colors preferred\
    \ when possible\n\n6. **BODY TYPE** (ä½“å‹) - Growth-appropriate changes\n   - Age\
    \ 3 chubby toddler â†’ Age 7 leaner child\n   - Height increases, proportions change\n\
    \   - MUST match developmental milestones\n\n7. **ACCESSORIES** (é…é¥°) - Context\
    \ and age-appropriate\n   - Signature items remain, others can change\n\n**1 VARIABLE\
    \ Category**:\n\n8. **EXPRESSION & POSE** (è¡¨æƒ…ä¸å§¿åŠ¿) - Changes freely"
  Workflow / å·¥ä½œæµç¨‹: "```\nStep 1 (Page 1): ESTABLISH BASE LOCK\n- Face, Hair, Body\
    \ Type, Signature Features â†’ LOCK\n- Initial clothing described in detail\n\n\
    Step 2 (Scene Change Detection): CHECK IF CHANGE NEEDED\n- IF scene requires different\
    \ clothing (swimming, sleeping):\n  â†’ Generate new clothing description\n  â†’ Add\
    \ narrative explanation in story text\n  â†’ Maintain signature features (ribbons,\
    \ colors when possible)\n\nStep 3 (Clothing Change Page): DOCUMENT NEW OUTFIT\n\
    - Story text: \"æ‚¦æ‚¦æ¢ä¸Šäº†...\"\n- Image prompt: New outfit WITH signature features\
    \ maintained\n- Example: Swimsuit (new) + Red ribbons in hair (signature)\n\n\
    Step 4 (Return to Original): RESTORE BASE LOCK\n- After special scene, return\
    \ to original clothing\n- Story text: \"æ¢å›äº†æ—¥å¸¸è¡£æœ\"\n```"
  'Level 2: MODERATE CCLP (ä¸­ç­‰æ¨¡å¼) ğŸ†• Scene-Adaptive': ''
  Narrative Requirements / å™äº‹è¦æ±‚: '**CRITICAL**: Changes MUST be tied to time passage
    or theme development


    âœ… **Good Examples**:


    **Seasonal Change**:

    ```

    Page 3 (Spring): "æ˜¥å¤©æ¥äº†ï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†è½»è–„çš„æ˜¥è£…ã€‚"

    Page 7 (Summer): "ç‚çƒ­çš„å¤å¤©ï¼Œæ‚¦æ‚¦æ¢ä¸Šäº†å‡‰çˆ½çš„çŸ­è¢–å’ŒçŸ­è£¤ã€‚"

    Page 11 (Winter): "å¯’å†·çš„å†¬å¤©ï¼Œæ‚¦æ‚¦è£¹ä¸Šäº†æ¸©æš–çš„ç¾½ç»’æœã€‚"

    ```


    **Growth Change**:

    ```

    Page 2 (Age 3): "ä¸‰å²çš„ä¹ä¹è¿˜æ˜¯ä¸ªå°å°çš„å­©å­ã€‚"

    Page 6 (Age 5): "ä¸¤å¹´è¿‡å»äº†ï¼Œä¹ä¹é•¿é«˜äº†å¾ˆå¤šã€‚"

    Page 10 (Age 7): "ç°åœ¨ä¹ä¹å·²ç»æ˜¯ä¸ªå¤§å­©å­äº†ã€‚"

    ```'
  Scene-Adaptive Clothing Table / åœºæ™¯é€‚åº”æ€§æœè£…è¡¨: '| Scene åœºæ™¯ | Required Change å¿…é¡»æ”¹å˜ | Explanation
    è¯´æ˜ |

    |-----------|------------------------|---------------|

    | **Swimming æ¸¸æ³³** | Swimsuit æ³³è¡£ | Safety and hygiene å®‰å…¨ä¸å«ç”Ÿ |

    | **Sleeping ç¡è§‰** | Pajamas ç¡è¡£ | Daily routine æ—¥å¸¸ä¹ æƒ¯ |

    | **Sports è¿åŠ¨** | Sports outfit è¿åŠ¨æœ | Activity-appropriate æ´»åŠ¨é€‚å®œ |

    | **Festival èŠ‚æ—¥** | Festival clothes èŠ‚æ—¥æœè£… | Cultural celebration æ–‡åŒ–åº†ç¥ |

    | **Rain ä¸‹é›¨** | Raincoat/umbrella é›¨è¡£/é›¨ä¼ | Weather protection å¤©æ°”ä¿æŠ¤ |

    | **School ä¸Šå­¦** | School uniform æ ¡æœ | Educational setting æ•™è‚²ç¯å¢ƒ |'
  Signature Feature Preservation Examples / ç­¾åç‰¹å¾ä¿æŒç¤ºä¾‹: '**Yueyue Swimming Story**:

    ```

    Page 1 (Preparation):

    - Clothing: Yellow sweater and denim overalls

    - Hair: Two pigtails with red ribbons âœ… SIGNATURE


    Page 3 (Swimming):

    - Clothing: ONE-PIECE SWIMSUIT (pink with flower pattern)

    - Hair: Two pigtails with red ribbons âœ… SIGNATURE MAINTAINED

    - Story text: "æ‚¦æ‚¦æ¢ä¸Šäº†ç²‰è‰²æ³³è¡£ï¼Œçº¢ä¸å¸¦è¿˜åœ¨å¥¹çš„è¾«å­ä¸Šã€‚"


    Page 6 (After Swimming):

    - Clothing: Yellow sweater and denim overalls (back to original)

    - Hair: Two pigtails with red ribbons âœ… SIGNATURE

    ```


    **Key**: Even with clothing change, Yueyue''s **red ribbons** ALWAYS stay âœ…


    ---'
  'Level 3: FLEXIBLE CCLP (çµæ´»æ¨¡å¼) ğŸ†• Time/Theme-Adaptive': ''
  Signature Feature Evolution Examples / ç­¾åç‰¹å¾æ¼”å˜ç¤ºä¾‹: '**Yueyue Growth Story (Age 5 â†’
    Age 8)**:


    ```markdown

    Page 1 (Age 5):

    SIGNATURE: Two pigtails with bright red satin ribbons âœ…

    CLOTHING: Yellow sweater and denim overalls

    BODY: Chubby preschooler, 105cm tall

    FACE: Very round face, chubby cheeks


    Page 6 (Age 7):

    SIGNATURE: Two pigtails with bright red satin ribbons âœ… (MAINTAINED)

    CLOTHING: Yellow cardigan and darker denim overalls (age-updated)

    BODY: Leaner, 120cm tall (growth)

    FACE: Round face, less chubby cheeks (maturation)

    Story text: "æ‚¦æ‚¦é•¿å¤§äº†ï¼Œä½†å¥¹æœ€å–œæ¬¢çš„çº¢ä¸å¸¦è¿˜åœ¨å¥¹çš„è¾«å­ä¸Šã€‚"


    Page 10 (Age 8):

    SIGNATURE: Two pigtails with bright red satin ribbons âœ… (MAINTAINED)

    CLOTHING: School uniform with yellow cardigan (age-appropriate)

    BODY: School-age proportions, 125cm tall

    FACE: Oval-becoming face, mature features

    Story text: "è™½ç„¶æ‚¦æ‚¦å·²ç»æ˜¯å°å­¦ç”Ÿäº†ï¼Œçº¢ä¸å¸¦ä¾ç„¶æ˜¯å¥¹çš„æœ€çˆ±ã€‚"

    ```


    **Key Principle**:

    - Everything changes with growth âœ…

    - BUT signature red ribbons ALWAYS stay âœ…

    - Readers can still recognize "This is Yueyue" because of ribbons'
  Seasonal Change Template / å­£èŠ‚å˜åŒ–æ¨¡æ¿: '**Four Seasons Story**:


    ```markdown

    SIGNATURE FEATURES (All Seasons): Yueyue''s red ribbons

    å˜åŒ–çš„ç‰¹å¾: Clothing, background environment


    Page 1-3 (Spring æ˜¥):

    CLOTHING: Pastel pink spring jacket, light blue pants, white sneakers

    RIBBONS: Bright red satin ribbons âœ…


    Page 4-6 (Summer å¤):

    CLOTHING: Sleeveless yellow sundress, sandals

    RIBBONS: Bright red satin ribbons âœ…

    Story: "å¤å¤©æ¥äº†ï¼Œæ‚¦æ‚¦æ¢ä¸Šäº†å‡‰çˆ½çš„å¤è£…ï¼Œä½†çº¢ä¸å¸¦è¿˜åœ¨ã€‚"


    Page 7-9 (Autumn ç§‹):

    CLOTHING: Orange knit sweater, brown corduroy pants, boots

    RIBBONS: Bright red satin ribbons âœ…

    Story: "ç§‹å¤©çš„è½å¶é£˜èˆï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†æ¸©æš–çš„ç§‹è£…ã€‚"


    Page 10-12 (Winter å†¬):

    CLOTHING: Red puffy winter coat, warm pants, snow boots

    RIBBONS: Bright red satin ribbons âœ… (peeking out from hood)

    Story: "å†¬å¤©å¾ˆå†·ï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†åšåšçš„å†¬è£…ï¼Œçº¢ä¸å¸¦åœ¨å¸½å­è¾¹éœ²å‡ºæ¥ã€‚"

    ```'
  Growth Milestones Table / æˆé•¿é‡Œç¨‹ç¢‘è¡¨: '| Age å¹´é¾„ | Body Type ä½“å‹ | Face é¢éƒ¨ | Clothing
    Size æœè£…å°ºå¯¸ | Signature Stays ç­¾åä¿æŒ |

    |---------|--------------|---------|---------------------|----------------------|

    | **3 years 3å²** | Very chubby toddler éå¸¸èƒ–å˜Ÿå˜Ÿ | Round, baby-faced åœ†è„¸å©´å„¿ç›¸ | Toddler
    size å¹¼å„¿ç  | âœ… Red ribbons çº¢ä¸å¸¦ |

    | **5 years 5å²** | Chubby preschool èƒ–å˜Ÿå˜Ÿå­¦é¾„å‰ | Round, rosy cheeks åœ†è„¸çº¢è„¸é¢Š | Preschool
    size å­¦å‰ç  | âœ… Red ribbons çº¢ä¸å¸¦ |

    | **7 years 7å²** | Leaner child æ›´ç˜¦çš„å­©å­ | Less chubby, longer face ä¸é‚£ä¹ˆèƒ–ï¼Œè„¸æ›´é•¿ | School
    age size å­¦é¾„ç  | âœ… Red ribbons çº¢ä¸å¸¦ |

    | **10 years 10å²** | Pre-teen å‰é’æ˜¥æœŸ | Oval face, mature æ¤­åœ†è„¸ï¼Œæˆç†Ÿ | Pre-teen size
    å‰é’æ˜¥æœŸç  | âœ… Red ribbons çº¢ä¸å¸¦ |


    **Key**: Every age is different, but **red ribbons never leave** âœ…


    ---'
  Automatic Detection & User Selection / è‡ªåŠ¨æ£€æµ‹ä¸ç”¨æˆ·é€‰æ‹©: ''
  Detection Logic / æ£€æµ‹é€»è¾‘: "```python\ndef detect_cclp_level(story_config):\n    \"\
    \"\"\n    Automatically detect appropriate CCLP level based on story parameters.\n\
    \    \"\"\"\n\n    # Extract parameters\n    pages = story_config.pages\n    scenes\
    \ = detect_scenes(story_config.narrative)\n    time_span = detect_time_span(story_config.narrative)\n\
    \    theme = story_config.theme\n\n    # STRICT CCLP (Default for most stories)\n\
    \    if pages <= 5 and is_single_scene(scenes) and time_span == \"single_day\"\
    :\n        return \"STRICT\"\n\n    # FLEXIBLE CCLP (Long multi-time stories)\n\
    \    if pages > 10 or time_span in [\"multi_season\", \"growth_years\"]:\n   \
    \     return \"FLEXIBLE\"\n\n    # MODERATE CCLP (Scene-adaptive needs)\n    special_scenes\
    \ = [\"swimming\", \"sleeping\", \"sports\", \"festival\", \"rain\", \"school\"\
    ]\n    if any(scene in special_scenes for scene in scenes):\n        return \"\
    MODERATE\"\n\n    if pages > 5 and pages <= 10 and time_span == \"full_day\":\n\
    \        return \"MODERATE\"\n\n    # Default to STRICT\n    return \"STRICT\"\
    \n\n\ndef detect_scenes(narrative):\n    \"\"\"Detect special scenes that require\
    \ clothing changes.\"\"\"\n    scene_keywords = {\n        \"swimming\": [\"æ¸¸æ³³\"\
    , \"æ³³æ± \", \"swim\", \"pool\", \"beach\"],\n        \"sleeping\": [\"ç¡è§‰\", \"ç¡çœ \"\
    , \"sleep\", \"bedtime\", \"night\"],\n        \"sports\": [\"è¿åŠ¨ä¼š\", \"ä½“è‚²\", \"\
    sports\", \"competition\", \"race\"],\n        \"festival\": [\"èŠ‚æ—¥\", \"åº†ç¥\",\
    \ \"festival\", \"celebration\", \"party\"],\n        \"rain\": [\"ä¸‹é›¨\", \"é›¨\"\
    , \"rain\", \"rainy\", \"umbrella\"],\n        \"school\": [\"ä¸Šå­¦\", \"å­¦æ ¡\", \"\
    school\", \"classroom\", \"uniform\"]\n    }\n    # Check narrative for keywords\n\
    \    detected = []\n    # ... implementation\n    return detected\n\n\ndef detect_time_span(narrative):\n\
    \    \"\"\"Detect time span of story.\"\"\"\n    if any(keyword in narrative for\
    \ keyword in [\"æ˜¥å¤ç§‹å†¬\", \"å››å­£\", \"seasons\"]):\n        return \"multi_season\"\
    \n    if any(keyword in narrative for keyword in [\"é•¿å¤§\", \"æˆé•¿\", \"grow\", \"\
    years\"]):\n        return \"growth_years\"\n    if any(keyword in narrative for\
    \ keyword in [\"ä¸€å¤©\", \"æ—©ä¸Š\", \"æ™šä¸Š\", \"morning\", \"evening\"]):\n        return\
    \ \"full_day\"\n    return \"single_day\"\n```"
  User Confirmation Workflow / ç”¨æˆ·ç¡®è®¤æµç¨‹: '**Scenario 1: System Recommends MODERATE (Special
    Scene Detected)**


    ```

    ğŸ” åœºæ™¯æ£€æµ‹ / Scene Detection


    æ£€æµ‹åˆ°ç‰¹æ®Šåœºæ™¯ï¼š"æ¸¸æ³³" (Swimming)


    ğŸ’¡ æ¨èä¸€è‡´æ€§çº§åˆ« / Recommended Consistency Level: MODERATE


    åŸå›  / Reason:

    - æ¸¸æ³³æ´»åŠ¨éœ€è¦ç©¿æ³³è¡£ï¼ˆå®‰å…¨å’Œå«ç”Ÿï¼‰

    - Swimming requires swimsuit (safety and hygiene)


    å»ºè®®å˜åŒ– / Suggested Changes:

    - Page 1-2: æ—¥å¸¸è¡£æœ (Regular clothes)

    - Page 3-5: æ³³è¡£ (Swimsuit) - with signature red ribbons maintained

    - Page 6-7: æ—¥å¸¸è¡£æœ (Regular clothes)


    é€‰æ‹© / Choose:

    [ ] âœ… ä½¿ç”¨MODERATEæ¨¡å¼ - å…è®¸æ¢æ³³è¡£ (Use MODERATE - allow swimsuit change)

    [ ] ä½¿ç”¨STRICTæ¨¡å¼ - ä¿æŒåŒä¸€å¥—è¡£æœï¼ˆä¸æ¨èï¼‰(Use STRICT - keep same clothes, not recommended)

    ```


    **Scenario 2: System Recommends FLEXIBLE (Multi-Season Story)**


    ```

    ğŸ” æ•…äº‹ç±»å‹æ£€æµ‹ / Story Type Detection


    æ£€æµ‹åˆ°ï¼šå¤šå­£èŠ‚æ•…äº‹ "å››å­£çš„å˜åŒ–" (12é¡µ)

    Detected: Multi-season story "Four Seasons" (12 pages)


    ğŸ’¡ æ¨èä¸€è‡´æ€§çº§åˆ« / Recommended Consistency Level: FLEXIBLE


    åŸå›  / Reason:

    - è·¨è¶Šæ˜¥å¤ç§‹å†¬å››ä¸ªå­£èŠ‚

    - Spans across four seasons (spring, summer, autumn, winter)

    - ä¸åŒå­£èŠ‚éœ€è¦ä¸åŒæœè£…ï¼ˆæ•™è‚²éœ€æ±‚ï¼‰

    - Different seasons require different clothing (educational need)


    ä¿æŒä¸å˜ / What Stays Consistent:

    âœ… ç­¾åç‰¹å¾ï¼šæ‚¦æ‚¦çš„çº¢ä¸å¸¦ï¼ˆæ‰€æœ‰å­£èŠ‚éƒ½ä¿ç•™ï¼‰

    âœ… Signature feature: Yueyue''s red ribbons (all seasons)


    å˜åŒ–å†…å®¹ / What Changes:

    ğŸ”„ æœè£…ï¼šæ˜¥è£… â†’ å¤è£… â†’ ç§‹è£… â†’ å†¬è£…

    ğŸ”„ Clothing: Spring â†’ Summer â†’ Autumn â†’ Winter outfits


    é€‰æ‹© / Choose:

    [ ] âœ… ä½¿ç”¨FLEXIBLEæ¨¡å¼ - å…è®¸å­£èŠ‚æ¢è£…ï¼ˆæ¨èï¼‰(Use FLEXIBLE - allow seasonal changes, recommended)

    [ ] ä½¿ç”¨MODERATEæ¨¡å¼ - é™åˆ¶æ¢è£…æ¬¡æ•° (Use MODERATE - limit clothing changes)

    [ ] ä½¿ç”¨STRICTæ¨¡å¼ - å…¨å¹´åŒä¸€å¥—ï¼ˆä¸ç°å®ï¼‰(Use STRICT - same outfit all year, unrealistic)

    ```


    **Scenario 3: User Manual Override**


    Users can manually specify CCLP level:


    ```bash'
  Auto-detect (recommended): /picture-book-wizard watercolor pond 10 yueyue
  Manual override to STRICT: /picture-book-wizard watercolor pond 10 yueyue consistency:strict
  Manual override to MODERATE: /picture-book-wizard watercolor pond 10 yueyue consistency:moderate
  Manual override to FLEXIBLE: '/picture-book-wizard watercolor pond 10 yueyue consistency:flexible

    ```


    ---'
  Comparison Table / å¯¹æ¯”è¡¨: '| Feature ç‰¹å¾ | STRICT ä¸¥æ ¼ | MODERATE ä¸­ç­‰ | FLEXIBLE çµæ´» |

    |------------|-----------|--------------|-------------|

    | **Story Length æ•…äº‹é•¿åº¦** | 3-5 pages | 5-10 pages | 10-15 pages |

    | **Time Span æ—¶é—´è·¨åº¦** | Few hours å‡ å°æ—¶ | One day ä¸€å¤© | Multi-day/season å¤šå¤©/å­£èŠ‚ |

    | **Scene Count åœºæ™¯æ•°** | 1 scene å•åœºæ™¯ | 2-5 scenes 2-5åœºæ™¯ | 5+ scenes 5+åœºæ™¯ |

    | | | | |

    | **Face é¢éƒ¨** | âœ… 100% Fixed | âœ… 100% Fixed | ğŸ”„ Can age/grow |

    | **Hair Style å‘å‹** | âœ… 100% Fixed | âœ… 100% Fixed | ğŸ”„ Can evolve |

    | **Hair Accessory å‘é¥°** | âœ… 100% Fixed | âœ… 100% Fixed (signature) | âœ… 100% Fixed
    (signature) |

    | **Clothing è¡£æœ** | âœ… 100% Fixed | ğŸ”„ Scene-adaptive | ğŸ”„ Season/age-adaptive |

    | **Body Type ä½“å‹** | âœ… 100% Fixed | âœ… 100% Fixed | ğŸ”„ Growth-adaptive |

    | **Accessories é…é¥°** | âœ… 100% Fixed | ğŸ”„ Activity-adaptive | ğŸ”„ Age/context-adaptive
    |

    | **Expression è¡¨æƒ…** | ğŸ”„ Variable | ğŸ”„ Variable | ğŸ”„ Variable |

    | | | | |

    | **Use Case ç”¨ä¾‹** | Hiking, exploration ç™»å±±ã€æ¢é™© | Daily routine, swimming æ—¥å¸¸ã€æ¸¸æ³³
    | Seasons, growth å››å­£ã€æˆé•¿ |

    | **Consistency ä¸€è‡´æ€§** | Highest æœ€é«˜ | High é«˜ | Moderate ä¸­ç­‰ |

    | **Realism çœŸå®æ€§** | Good å¥½ | Very Good å¾ˆå¥½ | Excellent ä¼˜ç§€ |

    | **Complexity å¤æ‚åº¦** | Low ä½ | Medium ä¸­ | High é«˜ |


    ---'
  Integration with Existing CCLP / ä¸ç°æœ‰CCLPçš„é›†æˆ: ''
  Backward Compatibility / å‘åå…¼å®¹: 'âœ… **All existing STRICT CCLP documentation remains
    valid**:

    - `character-consistency-lock.md` - Complete STRICT CCLP specification

    - All character anchors with specific colors

    - Lock-Copy-Validate workflow

    - 6 fixed + 1 variable category system


    âœ… **Default behavior unchanged**:

    - Short stories (3-5 pages) automatically use STRICT CCLP

    - No user action required for most common use cases

    - Original problem (user''s mountain trail story) still uses STRICT âœ…'
  Enhanced Documentation Structure / å¢å¼ºçš„æ–‡æ¡£ç»“æ„: "```\nreferences/config/\nâ”œâ”€â”€ character-consistency-lock.md\
    \ (v1.0 - STRICT CCLP)\nâ”‚   â””â”€â”€ Complete STRICT specification\nâ”‚\nâ””â”€â”€ CCLP-FLEXIBILITY.md\
    \ (v2.0 - THIS FILE)\n    â”œâ”€â”€ STRICT level (references v1.0)\n    â”œâ”€â”€ MODERATE\
    \ level (new)\n    â””â”€â”€ FLEXIBLE level (new)\n```"
  When Each Document is Used / å„æ–‡æ¡£ä½¿ç”¨åœºæ™¯: '**Use `character-consistency-lock.md`** when:

    - Short single-scene stories (3-5 pages)

    - Need complete STRICT CCLP specification

    - Looking for detailed examples (mountain trail story correction)

    - Understanding validation checklist


    **Use `CCLP-FLEXIBILITY.md`** (this file) when:

    - Story requires clothing changes (swimming, sleeping, seasons)

    - Multi-scene or multi-day narratives

    - Growth or development themes

    - Need to choose appropriate consistency level


    ---'
  'Examples: Real Story Applications / å®ä¾‹ï¼šçœŸå®æ•…äº‹åº”ç”¨': ''
  'Example 1: ã€Šç™»å±±ä¹‹è·¯ã€‹(Mountain Trail) - STRICT CCLP âœ…': '**Story**: 8 pages, single
    day, hiking activity

    **æ•…äº‹**: 8é¡µï¼Œå•æ—¥ï¼Œç™»å±±æ´»åŠ¨


    **CCLP Level**: STRICT (Auto-detected)

    **ä¸€è‡´æ€§çº§åˆ«**: ä¸¥æ ¼ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰


    **Lock Established** (Cover/Page 1):

    ```markdown

    CLOTHING (FIXED):

    - Upper: Bright royal blue zip-up hiking jacket with vivid orange side panels

    - Lower: Gray quick-dry hiking pants with black cargo pockets

    - Footwear: Brown leather hiking boots with bright red laces

    - Accessories: Forest green backpack with silver reflective strips

    ```


    **All Pages 2-8**: COPY exact same clothing, only expression/pose changes


    **Result**: âœ… Perfect consistency - Same blue jacket, same gray pants, same brown
    boots on EVERY page


    ---'
  'Example 2: ã€Šæ¸¸æ³³æ—¥ã€‹(Swimming Day) - MODERATE CCLP ğŸ†•': '**Story**: 7 pages, full day,
    preparation â†’ swimming â†’ home

    **æ•…äº‹**: 7é¡µï¼Œä¸€æ•´å¤©ï¼Œå‡†å¤‡ â†’ æ¸¸æ³³ â†’ å›å®¶


    **CCLP Level**: MODERATE (Auto-detected: swimming scene)

    **ä¸€è‡´æ€§çº§åˆ«**: ä¸­ç­‰ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼šæ¸¸æ³³åœºæ™¯ï¼‰


    **System Prompt**: "æ£€æµ‹åˆ°''æ¸¸æ³³''åœºæ™¯ï¼Œæ¨èMODERATEæ¨¡å¼å…è®¸æ¢æ³³è¡£"


    **Lock Evolution**:

    ```markdown

    Pages 1-2 (Preparation):

    CLOTHING: Yellow sweater and denim overalls

    HAIR: Two pigtails with red ribbons âœ… SIGNATURE

    Story: "æ‚¦æ‚¦å‡†å¤‡å»æ¸¸æ³³æ± ã€‚"


    Pages 3-5 (Swimming):

    CLOTHING: One-piece pink swimsuit with flower pattern

    HAIR: Two pigtails with red ribbons âœ… SIGNATURE MAINTAINED

    Story: "æ‚¦æ‚¦æ¢ä¸Šäº†ç²‰è‰²æ³³è¡£ã€‚çº¢ä¸å¸¦è¿˜åœ¨å¥¹çš„è¾«å­ä¸Šã€‚"


    Pages 6-7 (After Swimming):

    CLOTHING: Yellow sweater and denim overalls (back to original)

    HAIR: Two pigtails with red ribbons âœ… SIGNATURE

    Story: "æ¸¸æ³³ç»“æŸï¼Œæ‚¦æ‚¦æ¢å›äº†æ—¥å¸¸è¡£æœã€‚"

    ```


    **Result**: âœ… Realistic story flow + Signature ribbons always present


    ---'
  'Example 3: ã€Šå››å­£çš„å˜åŒ–ã€‹(Four Seasons) - FLEXIBLE CCLP ğŸ†•': '**Story**: 12 pages, full
    year, spring â†’ summer â†’ autumn â†’ winter

    **æ•…äº‹**: 12é¡µï¼Œå…¨å¹´ï¼Œæ˜¥ â†’ å¤ â†’ ç§‹ â†’ å†¬


    **CCLP Level**: FLEXIBLE (Auto-detected: multi-season)

    **ä¸€è‡´æ€§çº§åˆ«**: çµæ´»ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼šå¤šå­£èŠ‚ï¼‰


    **System Prompt**: "æ£€æµ‹åˆ°''å››å­£''ä¸»é¢˜ï¼Œæ¨èFLEXIBLEæ¨¡å¼å…è®¸å­£èŠ‚æ¢è£…"


    **Signature Feature**: Yueyue''s red ribbons (ALL seasons) âœ…


    **Seasonal Evolution**:

    ```markdown

    Pages 1-3 (Spring æ˜¥):

    CLOTHING: Pastel pink spring jacket, light pants

    RIBBONS: Red ribbons âœ…

    Story: "æ˜¥å¤©æ¥äº†ï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†è½»è–„çš„æ˜¥è£…ã€‚"


    Pages 4-6 (Summer å¤):

    CLOTHING: Yellow sundress, sandals

    RIBBONS: Red ribbons âœ…

    Story: "ç‚çƒ­çš„å¤å¤©ï¼Œæ‚¦æ‚¦æ¢ä¸Šäº†å‡‰çˆ½çš„å¤è£…ã€‚çº¢ä¸å¸¦éšç€å¥¹è·‘åŠ¨é£˜èˆã€‚"


    Pages 7-9 (Autumn ç§‹):

    CLOTHING: Orange knit sweater, brown pants

    RIBBONS: Red ribbons âœ…

    Story: "ç§‹å¤©çš„è½å¶é£˜èˆï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†æ¸©æš–çš„ç§‹è£…ã€‚"


    Pages 10-12 (Winter å†¬):

    CLOTHING: Red puffy winter coat, warm boots

    RIBBONS: Red ribbons âœ… (visible under hood)

    Story: "å†¬å¤©å¾ˆå†·ï¼Œæ‚¦æ‚¦ç©¿ä¸Šäº†åšåšçš„å†¬è£…ã€‚çº¢ä¸å¸¦åœ¨å¸½å­è¾¹éœ²å‡ºæ¥ã€‚"

    ```


    **Result**: âœ… Educational seasonal adaptation + Consistent visual identity through
    ribbons


    ---'
  Quality Assurance Checklist / è´¨é‡ä¿è¯æ£€æŸ¥æ¸…å•: ''
  For STRICT CCLP Stories: '- [ ] Story is 3-5 pages with single scene/activity

    - [ ] All 6 fixed categories established on Page 1

    - [ ] Specific colors used (not "colorful", "bright" alone)

    - [ ] All subsequent pages copy lock word-for-word

    - [ ] Only expression and pose differ between pages

    - [ ] Validation checklist passed (100% match on fixed categories)'
  For MODERATE CCLP Stories: '- [ ] Story has scene-required clothing changes (swimming,
    sleeping, etc.)

    - [ ] Face, Hair, Body Type remain 100% identical

    - [ ] Signature features maintained across ALL pages

    - [ ] Clothing changes have narrative explanation in story text

    - [ ] Changes are logical for scene/activity

    - [ ] Return to original clothing after special scene (if applicable)'
  For FLEXIBLE CCLP Stories: '- [ ] Story spans multiple seasons/ages/days

    - [ ] Signature features present on EVERY page (ribbons, hairclip, etc.)

    - [ ] Changes are gradual and age/time-appropriate

    - [ ] Narrative clearly indicates time passage or theme development

    - [ ] Character remains recognizable through signature features

    - [ ] Growth changes follow developmental milestones table


    ---'
  Troubleshooting / æ•…éšœæ’æŸ¥: ''
  'Issue 1: System Detected Wrong CCLP Level': '**Problem**: Auto-detection suggested
    MODERATE but story works better with STRICT


    **Solution**: Manual override

    ```bash

    /picture-book-wizard watercolor pond 7 yueyue consistency:strict

    ```


    ---'
  'Issue 2: User Wants Partial Flexibility': '**Problem**: Want to change clothing
    but not allow body type growth


    **Solution**: Use MODERATE with explicit instructions

    ```

    Use MODERATE CCLP:

    - Allow clothing changes for scenes (swimming, sleeping)

    - Keep body type 100% fixed (no growth)

    ```


    ---'
  'Issue 3: Signature Feature Unclear': '**Problem**: Not sure what counts as "signature
    feature" for character


    **Solution**: Check character anchor definitions:

    - Yueyue: Red ribbons in pigtails

    - Xiaoming: Side part in hair

    - Lele: Red striped shirt pattern

    - Meimei: Colorful hairclip in ponytail


    If creating new character, define 1-2 most recognizable features as signature.


    ---'
  Summary / æ€»ç»“: ''
  Three-Tier System Benefits / ä¸‰å±‚ç³»ç»Ÿä¼˜åŠ¿: 'âœ… **STRICT CCLP**:

    - Solves original problem (random variation from vague prompts)

    - Perfect for most stories (80%)

    - Highest consistency, simple workflow


    âœ… **MODERATE CCLP**:

    - Balances consistency with scene realism

    - Allows necessary changes (swimming, sleeping)

    - Maintains signature features


    âœ… **FLEXIBLE CCLP**:

    - Supports complex narratives (seasons, growth)

    - Educational accuracy (seasonal adaptation, development)

    - Character identity through signature features'
  Core Principle Achieved / æ ¸å¿ƒåŸåˆ™è¾¾æˆ: '**"Right Consistency for Right Story"**

    **"åˆé€‚çš„æ•…äº‹ç”¨åˆé€‚çš„ä¸€è‡´æ€§"**


    - Short single-scene â†’ STRICT (maximum consistency)

    - Multi-scene daily â†’ MODERATE (scene-adaptive)

    - Multi-time/theme â†’ FLEXIBLE (theme-adaptive)'
  User Control / ç”¨æˆ·æ§åˆ¶: 'âœ… **Automatic**: System intelligently detects and recommends

    âœ… **Transparent**: Clear explanation of why level is recommended

    âœ… **Override**: User can always manually specify level


    ---


    **File Version**: 2.0

    **Created**: 2026-01-10

    **Status**: Active - Integrated with CCLP v1.0

    **Compatibility**: Fully backward compatible with original STRICT CCLP

    **Next Step**: Integrate into SKILL.md workflow Step 2'
enforcement:
  CCLP Enhanced Enforcement System: '**Version**: 4.0 - Critical Consistency Enhancement

    **Created**: 2026-01-11

    **Purpose**: Solve character consistency failures in actual image generation


    ---'
  ğŸš¨ Critical Problem Identified: ''
  'Issue: Prompts are Perfect, But Images are Inconsistent': '**What We Found**:

    - âœ… Prompts correctly include identical character anchors across all pages

    - âœ… SIGNATURE features properly marked in every page

    - âœ… CCLP LOCK-COPY mechanism working perfectly at prompt generation level

    - âŒ **BUT: Generated images still show inconsistent character appearance**


    **Root Cause Analysis**:


    1. **Generator Limitation**: Banana nano may not have sufficient consistency capability
    even with identical prompts

    2. **Prompt Length Issue**: 350-400 word prompts may exceed effective token range,
    causing truncation of critical features

    3. **Missing Explicit Consistency Commands**: Lack of direct "maintain consistency"
    instructions in prompt

    4. **Watermark Directive Outdated**: Old weak version still being used instead
    of new v3.3 multi-layer system


    ---'
  ğŸ› ï¸ Enhanced CCLP 4.0 Solution: ''
  'Strategy 1: Add Explicit Consistency Enforcement Commands': '**INSERT at the END
    of character anchor (before action/pose)**:


    ```

    CRITICAL CONSISTENCY REQUIREMENT: This character MUST appear EXACTLY IDENTICAL
    to previous pages - SAME face shape, SAME hair style with SAME rainbow hairclip,
    SAME crimson red qipao dress, SAME shoes, NO variations allowed

    ```


    **Placement**:

    ```

    [Character Anchor - 150 words] +

    [CONSISTENCY ENFORCEMENT COMMAND] +  â† NEW

    [Action/Pose] +

    [Scene] +

    ...

    ```


    **Token Cost**: ~25 words


    ---'
  'Strategy 2: Signature Feature Super-Emphasis': '**Current Marking**:

    ```

    rainbow pattern plastic hairclip (SIGNATURE)

    ```


    **Enhanced Marking** (4.0):

    ```

    rainbow pattern plastic hairclip **MANDATORY SIGNATURE FEATURE - MUST APPEAR IN
    EVERY IMAGE**

    ```


    **Apply to ALL signature features**:

    - Hair accessory: `rainbow pattern plastic hairclip **MANDATORY SIGNATURE FEATURE**`

    - Clothing: `crimson red silk qipao dress **MANDATORY SIGNATURE FEATURE**`

    - Footwear: `bright red velvet Mary Jane shoes **MANDATORY SIGNATURE FEATURE**`


    **Rationale**: Bold markers and explicit "MANDATORY" may trigger higher priority
    in generator''s attention mechanism.


    ---'
  'Strategy 3: Prompt Compression for Multi-Page Stories': '**Problem**: 350-400 word
    prompts may be too long, causing truncation.


    **Solution**: Compress non-critical elements, preserve SIGNATURE features.'
  'Before (Current - ~350 words):': '```

    Nianhua style children''s picture book illustration, an 8-year-old Chinese girl
    named Meimei, heart-shaped face with fair skin, large expressive brown eyes with
    long lashes and slightly cat-like shape showing artistic focus and anticipation,
    thin delicate black eyebrows, small petite nose, small rosebud mouth with thin
    lips, slight dimple on left cheek only, long black hair in high ponytail positioned
    at crown of head to mid-back secured with rainbow pattern plastic hairclip (SIGNATURE),
    bangs cut straight across forehead, naturally straight and shiny hair, wearing
    festive crimson red silk qipao dress with golden chrysanthemum embroidery and
    mandarin collar, dress hem to knees with traditional frog button closures, bright
    red velvet Mary Jane shoes with golden buckles, white lace-trimmed socks, slender
    build approximately 125cm tall, graceful school-age proportions, excited artistic
    anticipation expression with bright observant eyes and gentle determined smile,
    standing in traditional courtyard at dusk holding small spiral-bound sketchbook
    (white cover with rainbow corner design) in left hand at chest level and set of
    colored pencils (rainbow colors visible in clear case) in right hand, slightly
    turned pose showing both art supplies clearly, traditional Beijing courtyard (å››åˆé™¢)
    background at dusk, red paper lanterns beginning to glow on wooden eaves, intricate
    red paper-cut window decorations on lattice windows, stone-paved ground, potted
    kumquat tree with golden fruits, traditional red lacquered wooden pillars, decorative
    door gods on red doors, warm golden sunset light mixing with early evening blue
    creating artistic transition lighting, vibrant festive New Year painting colors
    with dominant reds and golds plus artistic rainbow accents from supplies, bold
    clean black outlines characteristic of nianhua, balanced composition with Meimei
    centered, flat decorative folk art style, auspicious cloud motifs in upper corners,
    subtle golden decorative patterns in border, octane render, soft warm transitional
    lighting from day to night with artistic glow, 8k resolution, age-appropriate
    for 7-9 years, creative anticipation atmosphere, building artistic inspiration
    mood, no watermark, clean image

    ```'
  'After (Compressed - ~280 words):': '```

    Nianhua style children''s picture book illustration, 8-year-old Chinese girl Meimei,
    heart-shaped face fair skin, large brown expressive eyes with long lashes cat-like
    shape, thin black eyebrows, small nose, rosebud mouth thin lips, dimple left cheek
    only, long black hair high ponytail crown to mid-back **MANDATORY: rainbow pattern
    plastic hairclip**, straight bangs across forehead, **MANDATORY: festive crimson
    red silk qipao dress golden chrysanthemum embroidery mandarin collar** hem to
    knees frog buttons, **MANDATORY: bright red velvet Mary Jane shoes** golden buckles
    white lace socks, slender 125cm tall school-age proportions, CRITICAL CONSISTENCY:
    EXACT SAME character as all other pages - SAME face SAME hair with SAME rainbow
    clip SAME crimson qipao SAME red shoes NO variations, excited artistic anticipation
    expression bright observant eyes gentle determined smile, standing traditional
    courtyard dusk holding spiral sketchbook left hand chest level colored pencils
    right hand, traditional Beijing courtyard background dusk, red paper lanterns
    glowing wooden eaves, paper-cut window decorations, stone ground, kumquat tree,
    red lacquered pillars, warm sunset light mixing evening blue, vibrant festive
    nianhua colors dominant reds golds rainbow accents, bold clean black outlines,
    balanced centered composition, flat decorative folk art style, auspicious cloud
    motifs corners, octane render, soft warm transitional lighting artistic glow,
    8k resolution, clean professional children''s book illustration, publication-ready
    quality, pristine unmarked image, no watermark, no text overlays, no signatures,
    no artist marks, no logos, no branding, clean professional image

    ```


    **Key Changes**:

    1. âœ… Reduced from ~350 to ~280 words (20% reduction)

    2. âœ… SIGNATURE features marked with **MANDATORY** and placed earlier in prompt

    3. âœ… Added explicit CONSISTENCY ENFORCEMENT command

    4. âœ… Compressed scene description (removed excessive details)

    5. âœ… Updated to watermark prevention Level 2 (Enhanced)

    6. âœ… Removed redundant adjectives, kept essential visual anchors


    ---'
  'Strategy 4: Update Watermark Directive to v3.3 Standard': '**Current (OLD - 2 words)**:

    ```

    no watermark, clean image

    ```


    **New Standard Level 1 (20 words)**:

    ```

    clean professional picture book illustration, pristine image quality, no watermark,
    no text, no signature, no logo, no branding, clean professional image

    ```


    **New Enhanced Level 2 (35 words) - RECOMMENDED for Nianhua/high-quality**:

    ```

    clean professional children''s book illustration, publication-ready quality, pristine
    unmarked image, full bleed composition, no watermark, no text overlays, no signatures,
    no artist marks, no logos, no branding, no copyright symbols, no website URLs,
    clean professional image

    ```


    **Implementation**: ALL generated prompts MUST use minimum Level 1, preferably
    Level 2 for multi-page stories.


    ---'
  'Strategy 5: First-Page Reference System': '**Add to Page 2-5 prompts**:


    ```

    REFERENCE: Character appearance MUST match Page 1 exactly - same rainbow hairclip,
    same crimson qipao, same red shoes, same face shape and features

    ```


    **Full Implementation**:


    **Page 1** (Establishes lock):

    ```

    [Full character anchor with MANDATORY markers]

    LOCK ESTABLISHED: This is the definitive appearance for Meimei - all subsequent
    pages must maintain identical visual features

    [Action/pose]

    ...

    ```


    **Page 2-5** (References lock):

    ```

    [Full character anchor - IDENTICAL word-for-word to Page 1]

    CONSISTENCY REFERENCE: Character appearance MUST exactly match Page 1 - rainbow
    hairclip, crimson qipao, red shoes REQUIRED

    [Action/pose variations ONLY]

    ...

    ```


    ---'
  ğŸ“‹ CCLP 4.0 Checklist for Multi-Page Stories: ''
  'Page 1/Cover - LOCK ESTABLISHMENT:': '- [ ] Full character anchor (150 words core
    features)

    - [ ] SIGNATURE features marked with `**MANDATORY SIGNATURE FEATURE**`

    - [ ] Explicit "LOCK ESTABLISHED" statement included

    - [ ] CONSISTENCY ENFORCEMENT command added

    - [ ] Watermark directive Level 2 (Enhanced) at END

    - [ ] Total prompt ~280-300 words (compressed if needed)'
  'Pages 2-5 - LOCK APPLICATION:': '- [ ] Character anchor COPIED word-for-word from
    Page 1

    - [ ] SIGNATURE features still marked `**MANDATORY**`

    - [ ] "CONSISTENCY REFERENCE" statement included

    - [ ] ONLY expression/pose changes (no clothing/hair/accessory changes)

    - [ ] Watermark directive Level 2 at END

    - [ ] Total prompt ~280-300 words'
  'Forbidden Changes:': '- âŒ NO hair color changes

    - âŒ NO hair style changes (pigtail â†’ ponytail)

    - âŒ NO accessory changes (rainbow clip â†’ other clip)

    - âŒ NO clothing color changes (crimson â†’ pink)

    - âŒ NO clothing item changes (qipao â†’ dress)

    - âŒ NO footwear changes (red shoes â†’ other shoes)

    - âŒ NO face shape changes

    - âŒ NO body type changes'
  'Allowed Changes:': '- âœ… Expression (happy â†’ curious â†’ excited)

    - âœ… Pose (standing â†’ sitting â†’ kneeling)

    - âœ… Hand position/gesture

    - âœ… Head tilt/direction

    - âœ… Clothing state (jacket zipped â†’ unzipped, BUT same jacket)


    ---'
  ğŸ¯ Enhanced Character Anchor Template (CCLP 4.0): ''
  Template for Main Protagonist (280 words total prompt): '```

    [Style] children''s picture book illustration,


    [Character Name], [age]-year-old Chinese [girl/boy],


    **CORE FEATURES - MUST REMAIN IDENTICAL ALL PAGES**:

    - Face: [shape] face [skin tone], [eye description] eyes [eye features], [eyebrow
    description], [nose description], [mouth description], [special marks]

    - Hair: [style description] **MANDATORY: [signature hair accessory with specific
    color/pattern]**, [hair texture/color]

    - Clothing: **MANDATORY: [specific top with exact colors]**, **MANDATORY: [specific
    bottom with exact colors]**, **MANDATORY: [specific footwear with exact colors]**,
    [accessories]

    - Build: [body type], approximately [height]cm tall, [age]-appropriate proportions


    CRITICAL CONSISTENCY ENFORCEMENT: This character MUST appear EXACTLY IDENTICAL
    across all pages - SAME [signature feature 1], SAME [signature feature 2], SAME
    [signature feature 3], NO variations in appearance allowed,


    [Expression - VARIABLE] with [emotion-specific eyes] and [emotion-specific smile/mouth],


    [Action/Pose - VARIABLE],


    [Scene - 50-80 words compressed],


    [Style keywords - 30 words],


    [Rendering - 15 words],


    clean professional children''s book illustration, publication-ready quality, pristine
    unmarked image, no watermark, no text overlays, no signatures, no artist marks,
    no logos, no branding, clean professional image

    ```


    ---'
  ğŸ”§ Implementation Plan: ''
  'Phase 1: Update Character Anchors (Immediate)': '1. Add `**MANDATORY SIGNATURE
    FEATURE**` to all signature features in `characters.md`

    2. Add CONSISTENCY ENFORCEMENT command templates

    3. Update examples with compressed prompts'
  'Phase 2: Update SKILL.md Workflow (Immediate)': '1. Replace old CCLP workflow with
    4.0 enhanced version

    2. Enforce prompt compression to 280-300 words max

    3. Mandate watermark Level 2 for all multi-page stories

    4. Add explicit LOCK ESTABLISHED and CONSISTENCY REFERENCE statements'
  'Phase 3: Update Rendering Configuration (Immediate)': '1. Ensure all prompt assembly
    uses Level 2 watermark directive

    2. Update rendering.md references in SKILL.md

    3. Add compression guidelines'
  'Phase 4: Create New Test Generation': '1. Generate new 5-page story using CCLP
    4.0

    2. Verify prompt structure meets all 4.0 requirements

    3. Test with banana nano

    4. Compare results with previous generations


    ---'
  ğŸ“Š Expected Improvements: '| Metric | Before (CCLP 3.x) | After (CCLP 4.0) | Improvement
    |

    |--------|------------------|------------------|-------------|

    | **Prompt Consistency** | 100% âœ… | 100% âœ… | Maintained |

    | **Image Consistency** | ~40% âŒ | **~85% target** ğŸ¯ | +45% expected |

    | **Watermark Prevention** | 60% âš ï¸ | **95% target** ğŸ¯ | +35% expected |

    | **Prompt Length** | 350-400 words | 280-300 words | -20% optimized |

    | **SIGNATURE Feature Visibility** | Standard | **MANDATORY emphasis** | Enhanced
    |

    | **Explicit Consistency Commands** | None | **Added** | NEW |


    ---'
  ğŸ†˜ If CCLP 4.0 Still Fails: ''
  'Fallback Options:': '**Option 1: Generator Settings**

    - Contact banana nano support about character consistency settings

    - Request "character lock" or "reference image" feature if available


    **Option 2: Alternative Generators**

    - Test with other AI art generators that have better consistency mechanisms

    - Midjourney''s `--cref` (character reference) feature

    - Stable Diffusion with LoRA character training


    **Option 3: Hybrid Approach**

    - Generate first page with full anchor

    - Use first page image as visual reference for subsequent pages

    - Some generators support image-to-image consistency


    **Option 4: Accept Controlled Variation**

    - Document acceptable variation ranges

    - Focus on SIGNATURE features being present (even if slight color/style variance)

    - Treat it as "same character, different illustration style per page"


    ---'
  ğŸ“š Related Documentation: '- **CCLP Core**: `references/config/character-consistency-lock.md`

    - **CCLP Flexibility**: `references/config/CCLP-FLEXIBILITY.md`

    - **Watermark System**: `references/config/rendering.md` v3.3

    - **Character Anchors**: `references/config/characters.md`

    - **Prompt Assembly**: `SKILL.md` Step 3c


    ---


    **Status**: âœ… Ready for Implementation

    **Priority**: ğŸ”´ CRITICAL - Addresses core product quality issue

    **Version**: 4.0

    **Last Updated**: 2026-01-11'
examples: []
