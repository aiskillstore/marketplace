{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-16T21:56:39.750Z",
    "slug": "cleanexpo-database-migration",
    "source_url": "https://github.com/CleanExpo/Unite-Hub/tree/main/.claude/skills/database-migration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "3.0.0",
    "source_type": "community",
    "content_hash": "faafb967656356f09f26c27a9107086725e34cfcb13c999afa6a717ff4235373",
    "tree_hash": "0b18c2f885aa272ef395853d957a1f08e02aeaaa623c8642b539c59dae61e617"
  },
  "skill": {
    "name": "database-migration",
    "description": "Guide for creating idempotent Supabase database migrations with RLS policies and workspace isolation",
    "summary": "Guide for creating idempotent Supabase database migrations with RLS policies and workspace isolation",
    "icon": "üóÑÔ∏è",
    "version": "1.0.0",
    "author": "CleanExpo",
    "license": "MIT",
    "category": "data",
    "tags": [
      "supabase",
      "database",
      "migration",
      "postgresql",
      "rls"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network",
      "filesystem",
      "external_commands"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a documentation-only skill containing SQL migration patterns and guidelines. All static findings are false positives: the scanner misinterprets SQL syntax ($$ dollar quotes as backticks, gen_random_uuid as weak crypto, RLS mentions as crypto, BEGIN/END blocks as Windows SAM). No executable code, no file system access, no network calls, no command execution.",
    "risk_factor_evidence": [
      {
        "factor": "network",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          }
        ]
      },
      {
        "factor": "filesystem",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          }
        ]
      },
      {
        "factor": "external_commands",
        "evidence": [
          {
            "file": "SKILL.md",
            "line_start": 17,
            "line_end": 23
          },
          {
            "file": "SKILL.md",
            "line_start": 23,
            "line_end": 27
          },
          {
            "file": "SKILL.md",
            "line_start": 27,
            "line_end": 30
          },
          {
            "file": "SKILL.md",
            "line_start": 30,
            "line_end": 32
          },
          {
            "file": "SKILL.md",
            "line_start": 32,
            "line_end": 36
          },
          {
            "file": "SKILL.md",
            "line_start": 36,
            "line_end": 36
          },
          {
            "file": "SKILL.md",
            "line_start": 36,
            "line_end": 38
          },
          {
            "file": "SKILL.md",
            "line_start": 38,
            "line_end": 85
          },
          {
            "file": "SKILL.md",
            "line_start": 85,
            "line_end": 89
          },
          {
            "file": "SKILL.md",
            "line_start": 89,
            "line_end": 89
          },
          {
            "file": "SKILL.md",
            "line_start": 89,
            "line_end": 91
          },
          {
            "file": "SKILL.md",
            "line_start": 91,
            "line_end": 105
          },
          {
            "file": "SKILL.md",
            "line_start": 105,
            "line_end": 125
          },
          {
            "file": "SKILL.md",
            "line_start": 125,
            "line_end": 147
          },
          {
            "file": "SKILL.md",
            "line_start": 147,
            "line_end": 151
          },
          {
            "file": "SKILL.md",
            "line_start": 151,
            "line_end": 156
          },
          {
            "file": "SKILL.md",
            "line_start": 156,
            "line_end": 160
          },
          {
            "file": "SKILL.md",
            "line_start": 160,
            "line_end": 174
          },
          {
            "file": "SKILL.md",
            "line_start": 174,
            "line_end": 182
          },
          {
            "file": "SKILL.md",
            "line_start": 182,
            "line_end": 194
          },
          {
            "file": "SKILL.md",
            "line_start": 194,
            "line_end": 198
          },
          {
            "file": "SKILL.md",
            "line_start": 198,
            "line_end": 203
          },
          {
            "file": "SKILL.md",
            "line_start": 203,
            "line_end": 207
          },
          {
            "file": "SKILL.md",
            "line_start": 207,
            "line_end": 216
          },
          {
            "file": "SKILL.md",
            "line_start": 216,
            "line_end": 225
          },
          {
            "file": "SKILL.md",
            "line_start": 225,
            "line_end": 226
          },
          {
            "file": "SKILL.md",
            "line_start": 226,
            "line_end": 241
          },
          {
            "file": "SKILL.md",
            "line_start": 241,
            "line_end": 241
          },
          {
            "file": "SKILL.md",
            "line_start": 241,
            "line_end": 244
          },
          {
            "file": "SKILL.md",
            "line_start": 244,
            "line_end": 244
          }
        ]
      }
    ],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 2,
    "total_lines": 431,
    "audit_model": "claude",
    "audited_at": "2026-01-16T21:56:39.749Z"
  },
  "content": {
    "user_title": "Create Supabase database migrations",
    "value_statement": "Database schema changes are error-prone and can break production. This skill provides battle-tested patterns for creating idempotent Supabase migrations with workspace isolation and Row Level Security policies.",
    "seo_keywords": [
      "database migration",
      "supabase",
      "postgresql",
      "sql",
      "row level security",
      "rls policies",
      "schema changes",
      "claude code",
      "claude",
      "codex"
    ],
    "actual_capabilities": [
      "Generate idempotent SQL migrations using IF NOT EXISTS and CREATE OR REPLACE patterns",
      "Create workspace-isolated tables with proper multi-tenant architecture",
      "Implement Row Level Security policies using user_organizations join pattern",
      "Add indexes, constraints, triggers, ENUM types, and functions with safe migration patterns"
    ],
    "limitations": [
      "Does not execute migrations - generates SQL for manual review",
      "Does not handle data migration or schema transforms",
      "Does not validate existing database schema automatically",
      "Does not roll back migrations or manage migration history"
    ],
    "use_cases": [
      {
        "target_user": "Backend Developers",
        "title": "Add new tables safely",
        "description": "Create tables with proper RLS, indexes, and workspace isolation in Supabase projects"
      },
      {
        "target_user": "DevOps Engineers",
        "title": "Schema change automation",
        "description": "Generate consistent migration patterns for CI/CD deployment pipelines"
      },
      {
        "target_user": "Platform Engineers",
        "title": "Multi-tenant database design",
        "description": "Implement secure multi-tenant isolation with enforced Row Level Security"
      }
    ],
    "prompt_templates": [
      {
        "title": "Create simple table",
        "scenario": "Add new table to Supabase",
        "prompt": "Create a migration for a new table called 'project_tasks' with name, status, due_date, and workspace_id. Include workspace isolation and RLS."
      },
      {
        "title": "Add ENUM type",
        "scenario": "Create status enum",
        "prompt": "Generate migration to add an ENUM type 'task_priority' with values 'low', 'medium', 'high', 'urgent' and a column using it."
      },
      {
        "title": "Create trigger",
        "scenario": "Auto-update timestamps",
        "prompt": "Write a migration that adds an update_updated_at trigger to the 'users' table that sets updated_at on row changes."
      },
      {
        "title": "Complex schema",
        "scenario": "Full feature module",
        "prompt": "Create a complete migration for a 'customer_orders' module with tables, foreign keys, indexes, enums, RLS policies for admins and customers, and a function to calculate order totals."
      }
    ],
    "output_examples": [
      {
        "input": "Create a migration for a 'project_tasks' table with name, status, due_date, and workspace_id. Include workspace isolation and RLS.",
        "output": [
          "Table created with workspace_id and proper references",
          "Index added on workspace_id for query performance",
          "RLS enabled with user_organizations join pattern",
          "SELECT policy allows users to view their workspace tasks",
          "System policy enables management via service role",
          "Migration is idempotent with IF NOT EXISTS clauses"
        ]
      },
      {
        "input": "Add an ENUM type 'order_status' with values 'pending', 'processing', 'shipped', 'delivered', 'cancelled'",
        "output": [
          "ENUM type created using DO $$ block pattern",
          "Idempotent creation handles existing type gracefully",
          "Column added to orders table with the new type"
        ]
      },
      {
        "input": "Create a function to calculate order total with items and tax",
        "output": [
          "Function created with proper parameter handling",
          "Uses CREATE OR REPLACE for idempotency",
          "Includes proper error handling with EXCEPTION block",
          "Returns calculated total as integer"
        ]
      }
    ],
    "best_practices": [
      "Always check schema-reference.md for existing tables before creating new ones",
      "Use IF NOT EXISTS and CREATE OR REPLACE to make migrations re-runnable",
      "Always add workspace_id with CASCADE delete for multi-tenant tables",
      "Include RLS policies with both user access and system management rules"
    ],
    "anti_patterns": [
      "Using workspace_members table instead of user_organizations join pattern",
      "Creating migrations without idempotent IF NOT EXISTS checks",
      "Missing indexes on workspace_id causing query performance issues",
      "Forgetting to enable RLS or create policies after ALTER TABLE"
    ],
    "faq": [
      {
        "question": "What databases are supported?",
        "answer": "This skill targets Supabase PostgreSQL databases. The SQL patterns work with any PostgreSQL 14+ instance."
      },
      {
        "question": "Are there limits on migration size?",
        "answer": "PostgreSQL has a 1GB statement limit. For larger changes, split into multiple migration files."
      },
      {
        "question": "How do I integrate with Supabase CLI?",
        "answer": "Generated SQL can be pasted into Supabase Dashboard SQL Editor or saved to supabase/migrations/ for CLI deployment."
      },
      {
        "question": "Is my data safe during migration?",
        "answer": "The skill generates read-only patterns by default. Review all generated SQL before execution to ensure data safety."
      },
      {
        "question": "Why am I seeing 'relation does not exist' errors?",
        "answer": "This usually means using workspace_members table. Use the user_organizations + workspaces join pattern documented in the skill."
      },
      {
        "question": "How does this compare to TypeORM or Prisma migrations?",
        "answer": "This skill generates native SQL for Supabase, offering more control over RLS and PostgreSQL-specific features than ORM migrations."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md",
      "lines": 252
    }
  ]
}
