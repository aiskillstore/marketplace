{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-16T20:41:00.525Z",
    "slug": "cjharmath-py-async-patterns",
    "source_url": "https://github.com/CJHarmath/claude-agents-skills/tree/main/skills/py-async-patterns",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "3.0.0",
    "source_type": "community",
    "content_hash": "1068d9843498d52aa6a65702f5579ea60e08300dc3b4d4e48c7a896737410ae3",
    "tree_hash": "288dd683c97d51cb0df7a25885dbadd77eeadf3b425a933b43e8e98daaa0d8aa"
  },
  "skill": {
    "name": "py-async-patterns",
    "description": "Async/await patterns for FastAPI and SQLAlchemy. Use when working with async code, database sessions, concurrent operations, or debugging async issues in Python.",
    "summary": "Async/await patterns for FastAPI and SQLAlchemy. Use when working with async code, database sessions...",
    "icon": "âš¡",
    "version": "1.0.0",
    "author": "CJHarmath",
    "license": "MIT",
    "category": "coding",
    "tags": [
      "async",
      "python",
      "fastapi",
      "sqlalchemy",
      "database"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network",
      "external_commands",
      "env_access"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Pure documentation skill containing markdown patterns and Python code examples. Contains no executable code, scripts, network calls, or file modifications. All external command references are in markdown code blocks showing grep/ruff commands for detection purposes only. The skill provides guidance through prompts and does not access or execute anything on user systems.",
    "risk_factor_evidence": [
      {
        "factor": "network",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          }
        ]
      },
      {
        "factor": "external_commands",
        "evidence": [
          {
            "file": "SKILL.md",
            "line_start": 18,
            "line_end": 39
          },
          {
            "file": "SKILL.md",
            "line_start": 39,
            "line_end": 49
          },
          {
            "file": "SKILL.md",
            "line_start": 49,
            "line_end": 90
          },
          {
            "file": "SKILL.md",
            "line_start": 90,
            "line_end": 96
          },
          {
            "file": "SKILL.md",
            "line_start": 96,
            "line_end": 97
          },
          {
            "file": "SKILL.md",
            "line_start": 97,
            "line_end": 105
          },
          {
            "file": "SKILL.md",
            "line_start": 105,
            "line_end": 141
          },
          {
            "file": "SKILL.md",
            "line_start": 141,
            "line_end": 147
          },
          {
            "file": "SKILL.md",
            "line_start": 147,
            "line_end": 147
          },
          {
            "file": "SKILL.md",
            "line_start": 147,
            "line_end": 148
          },
          {
            "file": "SKILL.md",
            "line_start": 148,
            "line_end": 148
          },
          {
            "file": "SKILL.md",
            "line_start": 148,
            "line_end": 148
          },
          {
            "file": "SKILL.md",
            "line_start": 148,
            "line_end": 149
          },
          {
            "file": "SKILL.md",
            "line_start": 149,
            "line_end": 158
          },
          {
            "file": "SKILL.md",
            "line_start": 158,
            "line_end": 178
          },
          {
            "file": "SKILL.md",
            "line_start": 178,
            "line_end": 186
          },
          {
            "file": "SKILL.md",
            "line_start": 186,
            "line_end": 220
          },
          {
            "file": "SKILL.md",
            "line_start": 220,
            "line_end": 226
          },
          {
            "file": "SKILL.md",
            "line_start": 226,
            "line_end": 227
          },
          {
            "file": "SKILL.md",
            "line_start": 227,
            "line_end": 228
          },
          {
            "file": "SKILL.md",
            "line_start": 228,
            "line_end": 236
          },
          {
            "file": "SKILL.md",
            "line_start": 236,
            "line_end": 267
          },
          {
            "file": "SKILL.md",
            "line_start": 267,
            "line_end": 275
          },
          {
            "file": "SKILL.md",
            "line_start": 275,
            "line_end": 300
          },
          {
            "file": "SKILL.md",
            "line_start": 300,
            "line_end": 306
          },
          {
            "file": "SKILL.md",
            "line_start": 306,
            "line_end": 331
          },
          {
            "file": "SKILL.md",
            "line_start": 331,
            "line_end": 343
          },
          {
            "file": "SKILL.md",
            "line_start": 343,
            "line_end": 349
          },
          {
            "file": "SKILL.md",
            "line_start": 349,
            "line_end": 358
          }
        ]
      },
      {
        "factor": "env_access",
        "evidence": [
          {
            "file": "SKILL.md",
            "line_start": 161,
            "line_end": 161
          }
        ]
      }
    ],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 2,
    "total_lines": 538,
    "audit_model": "claude",
    "audited_at": "2026-01-16T20:41:00.525Z"
  },
  "content": {
    "user_title": "Apply Python Async Patterns",
    "value_statement": "Async Python code often suffers from race conditions, session leaks, and connection pool issues. This skill provides battle-tested patterns for FastAPI and SQLAlchemy that prevent common async pitfalls.",
    "seo_keywords": [
      "python async",
      "async await patterns",
      "fastapi async",
      "sqlalchemy async",
      "asyncio best practices",
      "async database",
      "concurrent python",
      "claude async code",
      "codex async python",
      "claude-code async"
    ],
    "actual_capabilities": [
      "Guide AsyncSession lifecycle management and dependency injection",
      "Optimize concurrent versus sequential database queries",
      "Implement proper transaction boundaries with commit and rollback",
      "Configure connection pool settings for asyncpg compatibility",
      "Use BackgroundTasks for non-blocking post-response operations",
      "Prevent deadlocks with consistent lock ordering"
    ],
    "limitations": [
      "Does not generate new async code from scratch",
      "Does not execute or test async code",
      "Does not modify existing codebase files",
      "Does not integrate with async debugging tools"
    ],
    "use_cases": [
      {
        "target_user": "Backend Developer",
        "title": "Fix Session Leaks",
        "description": "Identify and resolve async session management issues that cause stale data and connection exhaustion."
      },
      {
        "target_user": "API Engineer",
        "title": "Optimize Query Performance",
        "description": "Transform sequential database queries into parallel operations using asyncio.gather for faster endpoints."
      },
      {
        "target_user": "Full-Stack Developer",
        "title": "Implement Safe Transactions",
        "description": "Handle multi-step database operations with proper commit, rollback, and refresh patterns."
      }
    ],
    "prompt_templates": [
      {
        "title": "Session Management",
        "scenario": "Fix session lifecycle issues",
        "prompt": "Help me fix session lifecycle issues in my FastAPI app. I am seeing 'Session is closed' errors and connection timeouts."
      },
      {
        "title": "Query Optimization",
        "scenario": "Parallelize database queries",
        "prompt": "I have multiple independent database queries in my endpoint that are running slowly. Show me how to use asyncio.gather to run them in parallel."
      },
      {
        "title": "Transaction Safety",
        "scenario": "Handle complex transactions",
        "prompt": "I need to implement a multi-step transfer operation between accounts. Show me the correct pattern for transactions with commit, rollback, and refresh."
      },
      {
        "title": "Background Operations",
        "scenario": "Offload slow tasks",
        "prompt": "My endpoint is slow because it sends emails and updates analytics after processing. Show me how to use BackgroundTasks or asyncio.create_task for non-blocking operations."
      }
    ],
    "output_examples": [
      {
        "input": "Help me fix session lifecycle issues in my FastAPI app. I am seeing 'Session is closed' errors and connection timeouts.",
        "output": [
          "Session lifecycle issues typically occur when the session is used outside its request scope.",
          "Use dependency injection with FastAPI's Depends to scope sessions to each request.",
          "Always use async context managers: async with async_session() as session.",
          "Never store sessions in global variables or module-level state.",
          "Return sessions from dependency functions that yield to the request handler.",
          "The session automatically closes when the request completes, preventing leaks."
        ]
      },
      {
        "input": "I have multiple independent database queries in my endpoint that are running slowly.",
        "output": [
          "Independent queries can run in parallel using asyncio.gather().",
          "This executes all queries concurrently, reducing total response time.",
          "Dependent queries must remain sequential to maintain data integrity.",
          "The skill provides a decision framework for choosing between concurrent and sequential execution."
        ]
      },
      {
        "input": "Show me the correct pattern for transactions with commit, rollback, and refresh.",
        "output": [
          "Use session.begin() as a context manager for automatic transaction handling.",
          "The context manager commits on success and rolls back on exception.",
          "Call session.refresh() after commit to get database-generated values like ID and created_at.",
          "For complex operations, use explicit try/except with manual commit and rollback."
        ]
      }
    ],
    "best_practices": [
      "Always scope AsyncSession to individual requests using dependency injection",
      "Use asyncio.gather for independent queries but sequential await for dependent queries",
      "Acquire database locks in consistent order to prevent deadlocks in concurrent transfers"
    ],
    "anti_patterns": [
      "Storing global session references that survive across requests",
      "Running independent queries sequentially instead of using asyncio.gather",
      "Forgetting to call session.refresh() after commit to get database-generated values"
    ],
    "faq": [
      {
        "question": "Does this skill work with synchronous SQLAlchemy?",
        "answer": "No. This skill covers async SQLAlchemy patterns with create_async_engine and AsyncSession. Synchronous patterns use different session management."
      },
      {
        "question": "What connection pool settings does this skill recommend?",
        "answer": "For asyncpg, NullPool is recommended to avoid connection reuse issues. This creates new connections per request and closes them after."
      },
      {
        "question": "Can I use these patterns with other async frameworks?",
        "answer": "Yes. The session lifecycle and transaction patterns apply to any async Python framework using SQLAlchemy async."
      },
      {
        "question": "Does this skill access my data or files?",
        "answer": "No. This skill only provides guidance through prompts. It does not read, write, or execute any code on your system."
      },
      {
        "question": "Why am I getting connection timeouts with my async code?",
        "answer": "Timeouts usually indicate connection pool exhaustion from session leaks. Check that sessions are closed properly and not stored globally."
      },
      {
        "question": "How is this different from the official SQLAlchemy async documentation?",
        "answer": "This skill provides battle-tested patterns specifically for FastAPI web applications including common pitfalls and detection commands."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md",
      "lines": 359
    }
  ]
}
