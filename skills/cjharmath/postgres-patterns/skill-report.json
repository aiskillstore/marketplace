{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-16T20:33:28.943Z",
    "slug": "cjharmath-postgres-patterns",
    "source_url": "https://github.com/CJHarmath/claude-agents-skills/tree/main/skills/postgres-patterns",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "3.0.0",
    "source_type": "community",
    "content_hash": "5ffd7ce6d21331c7a256663e9dac4b2ac1ef425cab502644907bee373c25fccc",
    "tree_hash": "7c7624a810aba5b52c99ddf20a4e3901828d0b0ec021281c35bae2a142390641"
  },
  "skill": {
    "name": "postgres-patterns",
    "description": "PostgreSQL patterns for reviewing migrations and writing efficient queries. Use when reviewing Alembic migrations, optimizing queries, or debugging database issues.",
    "summary": "PostgreSQL patterns for reviewing migrations and writing efficient queries. Use when reviewing Alemb...",
    "icon": "üêò",
    "version": "1.0.0",
    "author": "CJHarmath",
    "license": "MIT",
    "category": "data",
    "tags": [
      "postgresql",
      "database",
      "migrations",
      "performance",
      "sql"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network",
      "external_commands"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a pure documentation skill containing only PostgreSQL best practices. No executable code, network calls, file access, or external commands exist. The skill-report.json audit explicitly states risk_level: safe and safe_to_publish: true. All 81 static findings are false positives caused by the scanner misinterpreting SQL identifier backticks as shell execution and database terminology as malicious patterns.",
    "risk_factor_evidence": [
      {
        "factor": "network",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          }
        ]
      },
      {
        "factor": "external_commands",
        "evidence": [
          {
            "file": "SKILL.md",
            "line_start": 18,
            "line_end": 30
          },
          {
            "file": "SKILL.md",
            "line_start": 30,
            "line_end": 34
          },
          {
            "file": "SKILL.md",
            "line_start": 34,
            "line_end": 39
          },
          {
            "file": "SKILL.md",
            "line_start": 39,
            "line_end": 43
          },
          {
            "file": "SKILL.md",
            "line_start": 43,
            "line_end": 52
          },
          {
            "file": "SKILL.md",
            "line_start": 52,
            "line_end": 60
          },
          {
            "file": "SKILL.md",
            "line_start": 60,
            "line_end": 76
          },
          {
            "file": "SKILL.md",
            "line_start": 76,
            "line_end": 79
          },
          {
            "file": "SKILL.md",
            "line_start": 79,
            "line_end": 85
          },
          {
            "file": "SKILL.md",
            "line_start": 85,
            "line_end": 91
          },
          {
            "file": "SKILL.md",
            "line_start": 91,
            "line_end": 103
          },
          {
            "file": "SKILL.md",
            "line_start": 103,
            "line_end": 111
          },
          {
            "file": "SKILL.md",
            "line_start": 111,
            "line_end": 117
          },
          {
            "file": "SKILL.md",
            "line_start": 117,
            "line_end": 120
          },
          {
            "file": "SKILL.md",
            "line_start": 120,
            "line_end": 127
          },
          {
            "file": "SKILL.md",
            "line_start": 127,
            "line_end": 133
          },
          {
            "file": "SKILL.md",
            "line_start": 133,
            "line_end": 144
          },
          {
            "file": "SKILL.md",
            "line_start": 144,
            "line_end": 147
          },
          {
            "file": "SKILL.md",
            "line_start": 147,
            "line_end": 148
          },
          {
            "file": "SKILL.md",
            "line_start": 148,
            "line_end": 149
          },
          {
            "file": "SKILL.md",
            "line_start": 149,
            "line_end": 150
          },
          {
            "file": "SKILL.md",
            "line_start": 150,
            "line_end": 156
          },
          {
            "file": "SKILL.md",
            "line_start": 156,
            "line_end": 165
          },
          {
            "file": "SKILL.md",
            "line_start": 165,
            "line_end": 171
          },
          {
            "file": "SKILL.md",
            "line_start": 171,
            "line_end": 189
          },
          {
            "file": "SKILL.md",
            "line_start": 189,
            "line_end": 195
          },
          {
            "file": "SKILL.md",
            "line_start": 195,
            "line_end": 219
          },
          {
            "file": "SKILL.md",
            "line_start": 219,
            "line_end": 237
          },
          {
            "file": "SKILL.md",
            "line_start": 237,
            "line_end": 245
          },
          {
            "file": "SKILL.md",
            "line_start": 245,
            "line_end": 251
          },
          {
            "file": "SKILL.md",
            "line_start": 251,
            "line_end": 278
          },
          {
            "file": "SKILL.md",
            "line_start": 278,
            "line_end": 286
          },
          {
            "file": "SKILL.md",
            "line_start": 286,
            "line_end": 288
          },
          {
            "file": "SKILL.md",
            "line_start": 288,
            "line_end": 289
          },
          {
            "file": "SKILL.md",
            "line_start": 289,
            "line_end": 290
          },
          {
            "file": "SKILL.md",
            "line_start": 290,
            "line_end": 291
          },
          {
            "file": "SKILL.md",
            "line_start": 291,
            "line_end": 292
          },
          {
            "file": "SKILL.md",
            "line_start": 292,
            "line_end": 293
          },
          {
            "file": "SKILL.md",
            "line_start": 293,
            "line_end": 294
          },
          {
            "file": "SKILL.md",
            "line_start": 294,
            "line_end": 315
          },
          {
            "file": "SKILL.md",
            "line_start": 315,
            "line_end": 340
          }
        ]
      }
    ],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 1,
    "total_lines": 341,
    "audit_model": "claude",
    "audited_at": "2026-01-16T20:33:28.943Z"
  },
  "content": {
    "user_title": "Review PostgreSQL migrations and optimize queries",
    "value_statement": "Alembic generates migrations without understanding PostgreSQL performance implications. This skill provides patterns for reviewing database migrations and writing efficient queries that avoid common performance pitfalls.",
    "seo_keywords": [
      "PostgreSQL patterns",
      "Alembic migration review",
      "database optimization",
      "query performance",
      "SQL best practices",
      "index optimization",
      "PostgreSQL indexes",
      "Claude Code",
      "Claude",
      "Codex"
    ],
    "actual_capabilities": [
      "Review migrations for PostgreSQL-specific issues",
      "Identify missing indexes and optimize index column order",
      "Create partial indexes for filtered queries",
      "Write efficient JSONB queries with proper indexes",
      "Avoid table locks during index creation with CONCURRENTLY",
      "Analyze query performance using EXPLAIN ANALYZE"
    ],
    "limitations": [
      "Does not execute queries against actual databases",
      "Cannot access your database schema directly",
      "Does not generate migration files",
      "Cannot monitor real-time database performance"
    ],
    "use_cases": [
      {
        "target_user": "Backend Developers",
        "title": "Review migration safety",
        "description": "Check new migrations for table locks, missing indexes, and constraint issues before deployment."
      },
      {
        "target_user": "Database Engineers",
        "title": "Optimize query performance",
        "description": "Identify slow queries and apply proper indexing strategies including partial and JSONB indexes."
      },
      {
        "target_user": "DevOps Engineers",
        "title": "Debug database issues",
        "description": "Diagnose connection problems, lock contention, and table size issues using diagnostic queries."
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic Migration Review",
        "scenario": "Review a new migration",
        "prompt": "Review this Alembic migration for PostgreSQL issues. Check for table locks, missing indexes, and constraint problems: [paste migration code]"
      },
      {
        "title": "Index Optimization",
        "scenario": "Optimize slow queries",
        "prompt": "This query is slow. Design proper indexes including partial indexes if the query filters by specific values: [paste query and table schema]"
      },
      {
        "title": "JSONB Query Tuning",
        "scenario": "Improve JSONB performance",
        "prompt": "Our JSONB queries are slow. Show us how to create proper GIN indexes and expression indexes for this pattern: [describe JSONB query pattern]"
      },
      {
        "title": "Lock Troubleshooting",
        "scenario": "Investigate locking issues",
        "prompt": "Our application is experiencing locks. Show diagnostic queries to identify blocking processes and long-running transactions: [describe symptoms]"
      }
    ],
    "output_examples": [
      {
        "input": "Review this migration for PostgreSQL issues:\n\nop.add_column('users', sa.Column('bio', sa.Text(), nullable=False))",
        "output": [
          "WARNING: This migration will LOCK the table on large tables",
          "PROBLEM: Adding a NOT NULL column without a default causes a full table rewrite",
          "BETTER APPROACH (3-step process):",
          "1. Add nullable column first: ALTER TABLE users ADD COLUMN bio TEXT;",
          "2. Backfill data in batches to avoid long locks",
          "3. Add constraint: ALTER TABLE users ALTER COLUMN bio SET NOT NULL;",
          "ALSO: Consider adding an index on bio if you will query by it"
        ]
      },
      {
        "input": "Our users table has 10 million rows and queries are slow:\n\nSELECT * FROM users WHERE status = 'active' ORDER BY created_at DESC LIMIT 100;",
        "output": [
          "Consider a partial index for active users only:",
          "CREATE INDEX ix_users_active_status_created ON users (status, created_at) WHERE status = 'active';",
          "This index will be much smaller than a full index on status",
          "The WHERE clause matches your query filter exactly",
          "Also consider adding covering index if you select specific columns"
        ]
      }
    ],
    "best_practices": [
      "Always use CREATE INDEX CONCURRENTLY on production tables to avoid locking writes",
      "Use partial indexes when you only query a subset of rows to keep indexes small",
      "Apply the 3-step process when adding NOT NULL columns to existing tables"
    ],
    "anti_patterns": [
      "Using CREATE INDEX without CONCURRENTLY on production databases",
      "Adding indexes on low-cardinality columns alone (like boolean flags)",
      "Using uuid4 as primary keys without considering BRIN indexes or index fragmentation"
    ],
    "faq": [
      {
        "question": "Does this skill connect to my database?",
        "answer": "No. This skill provides patterns and examples. You paste your migration or query code, and it suggests improvements based on PostgreSQL best practices."
      },
      {
        "question": "What PostgreSQL versions are supported?",
        "answer": "Patterns support PostgreSQL 11 and later. CONCURRENTLY indexes and certain ALTER TABLE improvements require PostgreSQL 11+."
      },
      {
        "question": "Can this skill generate migration files?",
        "answer": "No. It reviews existing migrations and suggests improvements. You would apply the recommendations to your Alembic migration files manually."
      },
      {
        "question": "Is my data safe when using this skill?",
        "answer": "Yes. The skill only processes text you paste. No data is stored or transmitted. Nothing leaves your session."
      },
      {
        "question": "Why is my query slow even with indexes?",
        "answer": "Common causes include: index column order mismatch, low-cardinality index columns, missing covering indexes, or index fragmentation with UUID primary keys."
      },
      {
        "question": "How is this different from pgAdmin or pg_stat_statements?",
        "answer": "This skill provides pattern guidance. pgAdmin and pg_stat_statements are monitoring tools. Use this skill for migration review before deployment, and monitoring tools for production troubleshooting."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md",
      "lines": 341
    }
  ]
}
