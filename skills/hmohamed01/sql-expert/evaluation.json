{
  "skill": {
    "name": "sql-expert",
    "description": "Write, optimize, and debug T-SQL queries for Microsoft SQL Server. Covers CTEs, window functions, PIVOT, MERGE, APPLY operators, execution plan analysis, indexing strategies, and stored procedures. Use when working with SQL Server, T-SQL scripts, .sql files, stored procedures, query optimization, or database performance tuning.",
    "summary": "Expert T-SQL assistance for Microsoft SQL Server development, query optimization, and database performance tuning.",
    "icon": "ðŸ—ƒï¸",
    "version": "1.0.0",
    "author": "hmohamed01",
    "license": "MIT",
    "category": "data",
    "tags": ["sql-server", "t-sql", "database", "query-optimization"],
    "supported_tools": ["claude", "codex", "claude-code"]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a documentation-only skill containing markdown files with T-SQL code examples. All 235 static findings are FALSE_POSITIVES. The analyzer incorrectly flags markdown syntax (triple backticks for code blocks) as shell commands, and educational security content as vulnerabilities. No executable code, network access, or file system operations exist.",
    "static_findings_evaluation": [
      {
        "finding": "[MEDIUM] external_commands: Ruby/shell backtick execution at SKILL.md:32",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "Triple backticks (```sql) are markdown syntax for code blocks, not Ruby/shell commands. This is a documentation file containing T-SQL examples. No command execution occurs."
      },
      {
        "finding": "[HIGH] blocker: Weak cryptographic algorithm at SKILL.md:3",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "SKILL.md line 3 contains YAML frontmatter describing the skill. No cryptographic algorithms or code execution exists. This is metadata/configuration, not code."
      },
      {
        "finding": "[MEDIUM] external_commands: Ruby/shell backtick execution at references/security.md:9",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "Markdown code block syntax (```sql) is incorrectly flagged as shell backtick execution. This security documentation teaches SQL injection prevention through parameterized queries - educational content, not malicious code."
      },
      {
        "finding": "[HIGH] blocker: Weak cryptographic algorithm at references/security.md:117",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "Documentation discusses SQL Server encryption features (AES_256, certificates). This is educational content about secure database practices, not vulnerable cryptographic code. The skill teaches defensive security patterns."
      },
      {
        "finding": "[CRITICAL] sensitive: Windows SAM database at references/security.md:221",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "SAM database is mentioned in security documentation discussing xp_cmdshell and SQL Server hardening. This is educational security content, not credential access or exfiltration."
      },
      {
        "finding": "[HIGH] blocker: C2 keywords at references/transactions.md:235",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "C2-related terms appear when documenting SQL injection attack patterns. This is security education teaching how to detect and prevent attacks, not command-and-control functionality."
      },
      {
        "finding": "[MEDIUM] sensitive: SQLite database file at references/transactions.md:390",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "SQLite is mentioned in documentation about distributed transactions and database compatibility. Educational content about data persistence patterns, not file access or exfiltration."
      },
      {
        "finding": "[CRITICAL] obfuscation: [HEURISTIC] DANGEROUS COMBINATION at multiple:1",
        "verdict": "false_positive",
        "confidence": "high",
        "reasoning": "This heuristic incorrectly triggers on documentation that discusses security topics together. A documentation skill containing security education is not obfuscated malware. No code execution, network access, or credential theft exists."
      }
    ],
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 6,
    "total_lines": 1849
  },
  "content": {
    "user_title": "Write and optimize T-SQL queries for SQL Server",
    "value_statement": "Get expert help writing complex T-SQL queries, stored procedures, and performance optimizations for Microsoft SQL Server. Covers advanced patterns like CTEs, window functions, PIVOT, and MERGE statements.",
    "seo_keywords": [
      "SQL Server",
      "T-SQL",
      "Microsoft SQL Server",
      "query optimization",
      "database development",
      "stored procedures",
      "CTE",
      "window functions",
      "Claude Code",
      "Claude"
    ],
    "actual_capabilities": [
      "Write and debug complex T-SQL queries with CTEs, window functions, and PIVOT operations",
      "Analyze execution plans and recommend indexing strategies for query performance",
      "Create and optimize stored procedures with proper error handling and transaction management",
      "Implement security patterns including SQL injection prevention and dynamic SQL safety"
    ],
    "limitations": [
      "Does not execute queries or connect to databases directly",
      "Does not have access to your specific database schema or data",
      "Does not provide GUI-based database design or administration"
    ],
    "use_cases": [
      {
        "target_user": "Database developers",
        "title": "Write complex T-SQL queries",
        "description": "Create queries with advanced patterns like recursive CTEs, running totals, and gap detection"
      },
      {
        "target_user": "Performance engineers",
        "title": "Optimize slow queries",
        "description": "Analyze query patterns and execution plans to identify and fix performance bottlenecks"
      },
      {
        "target_user": "Backend developers",
        "title": "Build secure stored procedures",
        "description": "Implement parameterized queries, proper error handling, and transaction management patterns"
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic query help",
        "scenario": "Write a simple query",
        "prompt": "Write a T-SQL query to select all orders from last month with their customer names, joining the Orders and Customers tables"
      },
      {
        "title": "Advanced pattern",
        "scenario": "Use window functions",
        "prompt": "Create a query using window functions to show each product with its sales, running total, and rank within category"
      },
      {
        "title": "Performance tuning",
        "scenario": "Optimize slow query",
        "prompt": "This query takes 30 seconds to run on a table with 10 million rows. Suggest optimizations including index changes and query rewrite: SELECT * FROM transactions WHERE YEAR(date) = 2024"
      },
      {
        "title": "Security patterns",
        "scenario": "Prevent SQL injection",
        "prompt": "Show me how to safely build a dynamic WHERE clause that accepts user input for filtering, preventing SQL injection while allowing optional filters"
      }
    ],
    "output_examples": [
      {
        "input": "Write a recursive CTE to traverse an organizational hierarchy where each employee has a manager_id pointing to another employee",
        "output": [
          "WITH RECURSIVE hierarchy AS (",
          "  -- Anchor: top-level employees (no manager)",
          "  SELECT id, name, manager_id, 0 AS level",
          "  FROM employees WHERE manager_id IS NULL",
          "  ",
          "  UNION ALL",
          "  ",
          "  -- Recursive: employees reporting to current level",
          "  SELECT e.id, e.name, e.manager_id, h.level + 1",
          "  FROM employees e",
          "  INNER JOIN hierarchy h ON e.manager_id = h.id",
          ")",
          "SELECT * FROM hierarchy OPTION (MAXRECURSION 100)"
        ]
      },
      {
        "input": "How do I implement keyset pagination for better performance on large tables?",
        "output": [
          "Keyset (seek method) pagination is more efficient than OFFSET for large datasets:",
          " ",
          "CREATE PROCEDURE GetProductsPage",
          "  @LastProductId INT,",
          "  @PageSize INT = 20",
          "AS",
          "BEGIN",
          "  SELECT TOP (@PageSize) * FROM Products",
          "  WHERE ProductId > @LastProductId",
          "  ORDER BY ProductId;",
          "END",
          " ",
          "Benefits: consistent performance at any page, works with real-time data"
        ]
      }
    ],
    "best_practices": [
      "Always use parameterized queries with sp_executesql instead of string concatenation to prevent SQL injection",
      "Write SARGable queries by avoiding functions on indexed columns in WHERE clauses",
      "Handle NULLs explicitly using IS NULL, ISNULL(), or COALESCE rather than relying on defaults"
    ],
    "anti_patterns": [
      "Using SELECT * in production queries - explicitly list columns to improve performance and avoid schema binding issues",
      "Calling functions on indexed columns in WHERE clauses (e.g., WHERE YEAR(date) = 2024) which prevents index usage",
      "Not validating or white-listing dynamic object names in dynamic SQL, even when using sp_executesql"
    ],
    "faq": [
      {
        "question": "What versions of SQL Server are supported?",
        "answer": "The skill covers features from SQL Server 2012 through 2022, with version-specific notes for features like STRING_AGG (2017+) and GENERATE_SERIES (2022+)."
      },
      {
        "question": "Can this skill help with database migration?",
        "answer": "Yes, the skill can help translate patterns between SQL Server and other databases, optimize migration queries, and handle data type conversions."
      },
      {
        "question": "Does the skill provide execution plan analysis?",
        "answer": "Yes, describe your query and execution plan operators (Table Scan, Key Lookup, Hash Match) for specific optimization recommendations."
      },
      {
        "question": "How do I handle dynamic sorting safely?",
        "answer": "Validate sort columns against a whitelist, then use QUOTENAME() for the column name. Never concatenate user input directly into ORDER BY clauses."
      },
      {
        "question": "What error handling patterns are recommended?",
        "answer": "Use TRY...CATCH blocks with proper transaction rollback. Check @@TRANCOUNT before rolling back and use THROW to re-raise exceptions."
      },
      {
        "question": "Can this help with JSON and XML processing?",
        "answer": "Yes, the skill covers OPENJSON, FOR JSON, and XML methods for parsing and generating structured data in SQL Server 2016+."
      }
    ]
  }
}
