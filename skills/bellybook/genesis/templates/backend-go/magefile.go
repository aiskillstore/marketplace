//go:build mage
// +build mage

/**
 * [INPUT]: ä¾èµ– github.com/magefile/mage/sh
 * [OUTPUT]: å¯¹å¤–æä¾› Run, Build, Docs æ„å»ºç›®æ ‡
 * [POS]: é¡¹ç›®æ ¹ç›®å½•çš„æ„å»ºè„šæœ¬
 * [PROTOCOL]: å˜æ›´æ—¶æ›´æ–°æ­¤å¤´éƒ¨ï¼Œç„¶åæ£€æŸ¥ CLAUDE.md
 */

package main

import (
	"fmt"
	"os"
	"path/filepath"
	"runtime"

	"github.com/magefile/mage/sh"
)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Run æœ¬åœ°å¼€å‘è¿è¡Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func Run() error {
	fmt.Println("ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡...")
	return sh.RunV("go", "run", "./cmd/api")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Build æ„å»ºäºŒè¿›åˆ¶
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func Build() error {
	outDir := "_output/bin"
	if err := os.MkdirAll(outDir, 0o755); err != nil {
		return err
	}

	outName := "api"
	if runtime.GOOS == "windows" {
		outName += ".exe"
	}

	outPath := filepath.Join(outDir, outName)
	fmt.Printf("ğŸ”¨ æ„å»º: %s\n", outPath)

	return sh.RunV("go", "build", "-o", outPath, "./cmd/api")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Docs ç”Ÿæˆ Swagger æ–‡æ¡£
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func Docs() error {
	fmt.Println("ğŸ“š ç”Ÿæˆ API æ–‡æ¡£...")
	return sh.RunV("swag", "init",
		"-g", "cmd/api/main.go",
		"-o", "docs/",
		"--parseDependency",
	)
}
