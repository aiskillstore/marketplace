{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-17T08:10:00.269Z",
    "slug": "labring-workflow-stop-design",
    "source_url": "https://github.com/labring/FastGPT/tree/main/.claude/skills/core/app/workflow/stop",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "3.0.0",
    "source_type": "community",
    "content_hash": "9a79330c875e63a85e739ab7e1be3072faa8452d5d0acb90c454b4fe06f783b3",
    "tree_hash": "0b96539a5178ea646dbe1ca71d5a127bdaf9b1a9994fcba57c527a1751186a99"
  },
  "skill": {
    "name": "workflow-stop-design",
    "description": "Â∑•‰ΩúÊµÅÊöÇÂÅúÈÄªËæëËÆæËÆ°ÊñπÊ°à",
    "summary": "Â∑•‰ΩúÊµÅÊöÇÂÅúÈÄªËæëËÆæËÆ°ÊñπÊ°à",
    "icon": "üõë",
    "version": "1.0.0",
    "author": "labring",
    "license": "Apache-2.0",
    "category": "documentation",
    "tags": [
      "workflow",
      "redis",
      "design",
      "architecture"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network",
      "filesystem",
      "external_commands"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a pure documentation skill containing only design documentation and code examples. No executable code, no network calls, no file system access. All 116 static findings are false positives: backticks are template literal syntax (not shell commands), paths are TypeScript type definitions (not file system operations), and flagged strings are metadata/identifier names (not crypto algorithms).",
    "risk_factor_evidence": [
      {
        "factor": "network",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          }
        ]
      },
      {
        "factor": "filesystem",
        "evidence": [
          {
            "file": "skill-report.json",
            "line_start": 6,
            "line_end": 6
          },
          {
            "file": "SKILL.md",
            "line_start": 107,
            "line_end": 107
          },
          {
            "file": "SKILL.md",
            "line_start": 107,
            "line_end": 107
          },
          {
            "file": "SKILL.md",
            "line_start": 107,
            "line_end": 107
          },
          {
            "file": "SKILL.md",
            "line_start": 108,
            "line_end": 108
          },
          {
            "file": "SKILL.md",
            "line_start": 108,
            "line_end": 108
          },
          {
            "file": "SKILL.md",
            "line_start": 108,
            "line_end": 108
          }
        ]
      },
      {
        "factor": "external_commands",
        "evidence": [
          {
            "file": "SKILL.md",
            "line_start": 11,
            "line_end": 15
          },
          {
            "file": "SKILL.md",
            "line_start": 15,
            "line_end": 18
          },
          {
            "file": "SKILL.md",
            "line_start": 18,
            "line_end": 26
          },
          {
            "file": "SKILL.md",
            "line_start": 26,
            "line_end": 31
          },
          {
            "file": "SKILL.md",
            "line_start": 31,
            "line_end": 36
          },
          {
            "file": "SKILL.md",
            "line_start": 36,
            "line_end": 38
          },
          {
            "file": "SKILL.md",
            "line_start": 38,
            "line_end": 51
          },
          {
            "file": "SKILL.md",
            "line_start": 51,
            "line_end": 52
          },
          {
            "file": "SKILL.md",
            "line_start": 52,
            "line_end": 56
          },
          {
            "file": "SKILL.md",
            "line_start": 56,
            "line_end": 57
          },
          {
            "file": "SKILL.md",
            "line_start": 57,
            "line_end": 62
          },
          {
            "file": "SKILL.md",
            "line_start": 62,
            "line_end": 67
          },
          {
            "file": "SKILL.md",
            "line_start": 67,
            "line_end": 73
          },
          {
            "file": "SKILL.md",
            "line_start": 73,
            "line_end": 75
          },
          {
            "file": "SKILL.md",
            "line_start": 75,
            "line_end": 75
          },
          {
            "file": "SKILL.md",
            "line_start": 75,
            "line_end": 76
          },
          {
            "file": "SKILL.md",
            "line_start": 76,
            "line_end": 89
          },
          {
            "file": "SKILL.md",
            "line_start": 89,
            "line_end": 97
          },
          {
            "file": "SKILL.md",
            "line_start": 97,
            "line_end": 104
          },
          {
            "file": "SKILL.md",
            "line_start": 104,
            "line_end": 106
          },
          {
            "file": "SKILL.md",
            "line_start": 106,
            "line_end": 123
          },
          {
            "file": "SKILL.md",
            "line_start": 123,
            "line_end": 138
          },
          {
            "file": "SKILL.md",
            "line_start": 138,
            "line_end": 186
          },
          {
            "file": "SKILL.md",
            "line_start": 186,
            "line_end": 188
          },
          {
            "file": "SKILL.md",
            "line_start": 188,
            "line_end": 190
          },
          {
            "file": "SKILL.md",
            "line_start": 190,
            "line_end": 274
          },
          {
            "file": "SKILL.md",
            "line_start": 274,
            "line_end": 280
          },
          {
            "file": "SKILL.md",
            "line_start": 280,
            "line_end": 288
          },
          {
            "file": "SKILL.md",
            "line_start": 288,
            "line_end": 314
          },
          {
            "file": "SKILL.md",
            "line_start": 314,
            "line_end": 317
          },
          {
            "file": "SKILL.md",
            "line_start": 317,
            "line_end": 318
          },
          {
            "file": "SKILL.md",
            "line_start": 318,
            "line_end": 323
          },
          {
            "file": "SKILL.md",
            "line_start": 323,
            "line_end": 350
          },
          {
            "file": "SKILL.md",
            "line_start": 350,
            "line_end": 354
          },
          {
            "file": "SKILL.md",
            "line_start": 354,
            "line_end": 356
          },
          {
            "file": "SKILL.md",
            "line_start": 356,
            "line_end": 358
          },
          {
            "file": "SKILL.md",
            "line_start": 358,
            "line_end": 385
          },
          {
            "file": "SKILL.md",
            "line_start": 385,
            "line_end": 388
          },
          {
            "file": "SKILL.md",
            "line_start": 388,
            "line_end": 389
          },
          {
            "file": "SKILL.md",
            "line_start": 389,
            "line_end": 397
          },
          {
            "file": "SKILL.md",
            "line_start": 397,
            "line_end": 399
          },
          {
            "file": "SKILL.md",
            "line_start": 399,
            "line_end": 401
          },
          {
            "file": "SKILL.md",
            "line_start": 401,
            "line_end": 406
          },
          {
            "file": "SKILL.md",
            "line_start": 406,
            "line_end": 416
          },
          {
            "file": "SKILL.md",
            "line_start": 416,
            "line_end": 419
          },
          {
            "file": "SKILL.md",
            "line_start": 419,
            "line_end": 426
          },
          {
            "file": "SKILL.md",
            "line_start": 426,
            "line_end": 430
          },
          {
            "file": "SKILL.md",
            "line_start": 430,
            "line_end": 432
          },
          {
            "file": "SKILL.md",
            "line_start": 432,
            "line_end": 470
          },
          {
            "file": "SKILL.md",
            "line_start": 470,
            "line_end": 472
          },
          {
            "file": "SKILL.md",
            "line_start": 472,
            "line_end": 474
          },
          {
            "file": "SKILL.md",
            "line_start": 474,
            "line_end": 481
          },
          {
            "file": "SKILL.md",
            "line_start": 482,
            "line_end": 504
          },
          {
            "file": "SKILL.md",
            "line_start": 504,
            "line_end": 507
          },
          {
            "file": "SKILL.md",
            "line_start": 507,
            "line_end": 510
          },
          {
            "file": "SKILL.md",
            "line_start": 510,
            "line_end": 518
          },
          {
            "file": "SKILL.md",
            "line_start": 518,
            "line_end": 526
          },
          {
            "file": "SKILL.md",
            "line_start": 526,
            "line_end": 528
          },
          {
            "file": "SKILL.md",
            "line_start": 528,
            "line_end": 537
          },
          {
            "file": "SKILL.md",
            "line_start": 537,
            "line_end": 541
          },
          {
            "file": "SKILL.md",
            "line_start": 541,
            "line_end": 563
          },
          {
            "file": "SKILL.md",
            "line_start": 563,
            "line_end": 573
          },
          {
            "file": "SKILL.md",
            "line_start": 573,
            "line_end": 595
          },
          {
            "file": "SKILL.md",
            "line_start": 595,
            "line_end": 599
          },
          {
            "file": "SKILL.md",
            "line_start": 599,
            "line_end": 613
          },
          {
            "file": "SKILL.md",
            "line_start": 613,
            "line_end": 617
          },
          {
            "file": "SKILL.md",
            "line_start": 617,
            "line_end": 629
          },
          {
            "file": "SKILL.md",
            "line_start": 629,
            "line_end": 652
          },
          {
            "file": "SKILL.md",
            "line_start": 652,
            "line_end": 652
          },
          {
            "file": "SKILL.md",
            "line_start": 652,
            "line_end": 653
          },
          {
            "file": "SKILL.md",
            "line_start": 653,
            "line_end": 654
          },
          {
            "file": "SKILL.md",
            "line_start": 654,
            "line_end": 657
          },
          {
            "file": "SKILL.md",
            "line_start": 657,
            "line_end": 660
          },
          {
            "file": "SKILL.md",
            "line_start": 660,
            "line_end": 671
          }
        ]
      }
    ],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 2,
    "total_lines": 852,
    "audit_model": "claude",
    "audited_at": "2026-01-17T08:10:00.269Z"
  },
  "content": {
    "user_title": "Design workflow stop mechanism",
    "value_statement": "Need to implement graceful workflow termination in your AI agent system. This design document provides a Redis-based state management solution with API endpoints and polling patterns for reliable workflow stopping.",
    "seo_keywords": [
      "workflow stop",
      "redis state management",
      "ai agent control",
      "fastgpt design",
      "claude code workflow",
      "graceful shutdown",
      "workflow cancellation",
      "agent runtime",
      "polling mechanism"
    ],
    "actual_capabilities": [
      "Design Redis-based workflow stop state management",
      "Implement stop flag with TTL and key patterns",
      "Create polling mechanism for stop detection",
      "Define stop API endpoint with authentication",
      "Handle edge cases including timeouts and concurrency",
      "Write unit tests for stop functionality"
    ],
    "limitations": [
      "Design document only, requires implementation",
      "Does not include frontend code for all scenarios",
      "HTTP request nodes may not be immediately terminated",
      "Focus on v2 API version, v1 uses different mechanism"
    ],
    "use_cases": [
      {
        "target_user": "AI System Architects",
        "title": "Design stop mechanism",
        "description": "Learn Redis-based state management for workflow control and implement graceful agent termination patterns"
      },
      {
        "target_user": "Backend Developers",
        "title": "Implement stop API",
        "description": "Build the /api/v2/chat/stop endpoint with authentication, polling, and timeout handling"
      },
      {
        "target_user": "QA Engineers",
        "title": "Test workflow control",
        "description": "Understand testing strategy for stop functionality including concurrency and timeout scenarios"
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic design query",
        "scenario": "Understanding workflow stop",
        "prompt": "Explain the Redis-based workflow stop mechanism and the key functions for setting, checking, and deleting stop flags."
      },
      {
        "title": "API implementation",
        "scenario": "Building stop endpoint",
        "prompt": "How do I implement the /api/v2/chat/stop endpoint with authentication and the waitForWorkflowComplete function?"
      },
      {
        "title": "Testing strategy",
        "scenario": "Writing unit tests",
        "prompt": "What test cases should I write to verify the workflow stop functionality, including concurrency and timeout scenarios?"
      },
      {
        "title": "Edge cases",
        "scenario": "Handling failures",
        "prompt": "How should I handle Redis operation failures, TTL expiration, and concurrent stop requests in the workflow stop design?"
      }
    ],
    "output_examples": [
      {
        "input": "Explain the workflow stop mechanism and how it handles the stop signal from user click to actual workflow termination",
        "output": [
          "User clicks stop button ‚Üí Frontend aborts HTTP connection",
          "Backend sets Redis stop flag (agent_runtime_stopping:{appId}:{chatId})",
          "Timer polls Redis every 100ms and updates stopping variable",
          "Next node execution checks stopping flag and exits gracefully",
          "Workflow completion handler deletes Redis key",
          "60-second TTL provides fallback cleanup"
        ]
      },
      {
        "input": "What are the main components of the Redis state management design for workflow stopping",
        "output": [
          "Stop flag key pattern: agent_runtime_stopping:{appId}:{chatId}",
          "TTL of 60 seconds for automatic cleanup",
          "Three core functions: setAgentRuntimeStop, shouldWorkflowStop, delAgentRuntimeStopSign",
          "waitForWorkflowComplete for graceful waiting with 5s timeout",
          "Polling timer that checks Redis every 100ms"
        ]
      },
      {
        "input": "How does the stop API handle authentication and what happens if Redis fails",
        "output": [
          "API uses authChatCrud with token and API key support",
          "On Redis failure, shouldWorkflowStop returns false to continue execution",
          "Delete errors are logged but do not block workflow completion",
          "Graceful degradation ensures workflows keep running if Redis is unavailable"
        ]
      }
    ],
    "best_practices": [
      "Use Redis key existence as the stop signal rather than storing complex state values",
      "Implement graceful degradation when Redis operations fail by continuing workflow execution",
      "Set appropriate TTL on stop flags to prevent key leaks from system crashes",
      "Poll frequently enough to balance responsiveness with system performance"
    ],
    "anti_patterns": [
      "Blocking the stop API indefinitely without timeout handling",
      "Storing stop state in memory only without persistence across server restarts",
      "Assuming all node types can be immediately terminated",
      "Not handling concurrent stop requests from multiple user actions"
    ],
    "faq": [
      {
        "question": "What Redis operations does this design use?",
        "answer": "SETEX for setting stop flag with TTL, GET for checking flag existence, and DEL for cleanup. All operations are idempotent."
      },
      {
        "question": "What is the polling frequency?",
        "answer": "The backend polls Redis every 100ms to check for stop flags, balancing responsiveness with system performance."
      },
      {
        "question": "How does it integrate with existing authentication?",
        "answer": "The stop API reuses authChatCrud which supports both token-based and API key authentication, plus external link auth data."
      },
      {
        "question": "Is my data safe when stopping workflows?",
        "answer": "Yes, the design only modifies in-memory state and Redis keys for the workflow being stopped. No external data access or exfiltration."
      },
      {
        "question": "What happens if Redis fails during stop operation?",
        "answer": "The design implements graceful degradation. Failed stop checks return false, and delete errors are logged without blocking."
      },
      {
        "question": "How does this compare to traditional thread interruption?",
        "answer": "This is a cooperative model using Redis as the coordination mechanism, suitable for async/await workflows where nodes must explicitly check the stopping flag."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md",
      "lines": 673
    }
  ]
}
