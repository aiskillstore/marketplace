---
description: "éœ€æ±‚è§„åˆ’æ‹†è§£ï¼šå°†å¤æ‚éœ€æ±‚è½¬åŒ–ä¸ºç»“æ„åŒ–ä»»åŠ¡æ ‘ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’"
---

# /runtime.plan - éœ€æ±‚è§„åˆ’ä¸ä»»åŠ¡æ‹†è§£

## æ ¸å¿ƒç›®æ ‡

**æˆ‘ä»¬ä¸æ˜¯æ‰§è¡Œè€…ï¼Œæˆ‘ä»¬æ˜¯è§„åˆ’è€…**ã€‚

å½“é¢å¯¹å¤æ‚éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬åƒç»éªŒä¸°å¯Œçš„æ¶æ„å¸ˆä¸€æ ·ï¼š
1. **ç†è§£éœ€æ±‚æœ¬è´¨** - ç”¨æˆ·çœŸæ­£æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ
2. **åŠŸèƒ½åˆ†è§£** - å°†å¤§é—®é¢˜æ‹†è§£ä¸ºå°ä»»åŠ¡
3. **è¯†åˆ«ä¾èµ–** - å“ªäº›å¿…é¡»å…ˆåšï¼Œå“ªäº›å¯ä»¥å¹¶è¡Œï¼Ÿ
4. **ä¼°ç®—å·¥æ—¶** - éœ€è¦å¤šå°‘æ—¶é—´ï¼Ÿé£é™©åœ¨å“ªé‡Œï¼Ÿ
5. **ç”Ÿæˆæ‰§è¡Œè·¯å¾„** - æœ€ä¼˜çš„å®æ–½é¡ºåº

```
ç”¨æˆ·éœ€æ±‚ â†’ éœ€æ±‚åˆ†æ â†’ åŠŸèƒ½æ‹†è§£ â†’ ä¾èµ–è¯†åˆ« â†’ ä»»åŠ¡æ ‘ â†’ æ‰§è¡Œè®¡åˆ’
                                                              â†“
                                                    /runtime.iterate
```

---

## ä½•æ—¶ä½¿ç”¨ /runtime.plan

### å¿…é¡»ä½¿ç”¨åœºæ™¯
- âœ… **ç”¨æˆ·éœ€æ±‚æ¨¡ç³Š**ï¼š"æˆ‘æƒ³åŠ ä¸ªç”µå•†åŠŸèƒ½" â†’ éœ€è¦æ‹†è§£ä¸ºå…·ä½“ä»»åŠ¡
- âœ… **æŠ€æœ¯æ–¹æ¡ˆä¸ç¡®å®š**ï¼šéœ€è¦åˆ†æå¤šç§å®ç°è·¯å¾„
- âœ… **é¡¹ç›®èŒƒå›´å¤§**ï¼šåŠŸèƒ½å¤æ‚ï¼Œéœ€è¦ç³»ç»Ÿæ€§è§„åˆ’
- âœ… **å›¢é˜Ÿåä½œ**ï¼šéœ€è¦æ¸…æ™°çš„ä»»åŠ¡åˆ†é…å’Œä¾èµ–å…³ç³»
- âœ… **ä¼°ç®—å’Œæ’æœŸ**ï¼šéœ€è¦å·¥ä½œé‡ä¼°ç®—å’Œæ—¶é—´çº¿

### ä½¿ç”¨æµç¨‹

```bash
ç”¨æˆ·: "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæ³¨å†Œã€ç™»å½•ã€å¯†ç é‡ç½®ã€JWTï¼‰"

AI:
/runtime.plan "ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
  â†“ è‡ªåŠ¨æ‰§è¡Œ...

[é˜¶æ®µ1: éœ€æ±‚åˆ†æ]
- è¯†åˆ«éœ€æ±‚ç±»å‹: æ–°åŠŸèƒ½å¼€å‘
- æå–çº¦æŸ: JWTæœ‰æ•ˆæœŸ7å¤©ã€å¹¶å‘1000
- åˆ†ææŠ€æœ¯æ ˆ: Express + PostgreSQL
- è¯†åˆ«èŒƒå›´: APIã€DBã€å®‰å…¨ã€é‚®ä»¶

[é˜¶æ®µ2: åŠŸèƒ½æ‹†è§£]
- åŠŸèƒ½ç‚¹: æ³¨å†Œã€ç™»å½•ã€å¯†ç é‡ç½®ã€JWTç®¡ç†ã€ç™»å‡º
- ä»»åŠ¡æ•°: 17ä¸ªä»»åŠ¡
- åˆ†å±‚: åŸºç¡€è®¾æ–½ â†’ æœåŠ¡å±‚ â†’ API â†’ å®‰å…¨ â†’ æµ‹è¯•

[é˜¶æ®µ3: ä¾èµ–åˆ†æ]
- æ„å»ºä¾èµ–å›¾
- è®¡ç®—å…³é”®è·¯å¾„
- è¯†åˆ«å¯å¹¶è¡Œä»»åŠ¡

[é˜¶æ®µ4: ä¼°ç®—ä¸é£é™©]
- æ€»å·¥æ—¶: 17.75å°æ—¶
- å…³é”®è·¯å¾„: 9å°æ—¶
- é£é™©: å¯†ç é‡ç½®æµç¨‹å¤æ‚

[è¾“å‡º: äº¤ä»˜ç»™ç”¨æˆ·]
- å¯è§†åŒ–ä»»åŠ¡æ ‘ (ASCII/MDæ ¼å¼)
- JSONæ ¼å¼çš„æœºå™¨å¯è¯»è®¡åˆ’
- ç”˜ç‰¹å›¾æ—¶é—´çº¿
- é£é™©è¯„ä¼°æŠ¥å‘Š

# ç„¶åè¿›å…¥è¿­ä»£æ‰§è¡Œ
/runtime.iterate --plan=plan-2025xx.json
  â†“ è‡ªåŠ¨æ‰§è¡Œ...
```

---

## è§„åˆ’è¿‡ç¨‹è¯¦è§£

### é˜¶æ®µ1: éœ€æ±‚åˆ†æ (Understanding)

#### 1.1 éœ€æ±‚ç±»å‹è¯†åˆ«

```python
def identify_requirement_type(text: str) -> RequirementType:
    """è¯†åˆ«éœ€æ±‚ç±»å‹"""
    if any(word in text for word in ["æ·»åŠ ", "å®ç°", "å¼€å‘", "æ–°åŠŸèƒ½"]):
        return RequirementType.NEW_FEATURE

    if any(word in text for word in ["ä¿®å¤", "bug", "é”™è¯¯", "é—®é¢˜"]):
        return RequirementType.BUG_FIX

    if any(word in text for word in ["é‡æ„", "ä¼˜åŒ–", "æ”¹è¿›", "æ¸…ç†"]):
        return RequirementType.REFACTORING

    if any(word in text for word in ["å­¦ä¹ ", "ç†è§£", "è°ƒç ”", "ç ”ç©¶"]):
        return RequirementType.RESEARCH

    return RequirementType.UNKNOWN
```

#### 1.2 çº¦æŸæå–

ä»éœ€æ±‚ä¸­æå–éšå«çº¦æŸï¼š

```python
def extract_constraints(demand: str) -> Constraints:
    """æå–çº¦æŸæ¡ä»¶"""

    constraints = {
        "time": None,      # æ—¶é—´çº¦æŸ
        "budget": None,    # èµ„æºçº¦æŸ
        "tech_stack": [],  # æŠ€æœ¯æ ˆçº¦æŸ
        "performance": {}, # æ€§èƒ½çº¦æŸ
        "security": {},    # å®‰å…¨çº¦æŸ
    }

    # æ€§èƒ½çº¦æŸ
    if "å¹¶å‘" in demand:
        # "æ”¯æŒå¹¶å‘1000ç”¨æˆ·"
        match = re.search(r"å¹¶å‘(\d+)", demand)
        if match:
            constraints["performance"]["concurrency"] = int(match.group(1))

    # æ—¶é—´çº¦æŸ
    if "JWT" in demand and "å¤©" in demand:
        # "JWTæœ‰æ•ˆæœŸ7å¤©"
        match = re.search(r"æœ‰æ•ˆæœŸ(\d+)å¤©", demand)
        if match:
            constraints["security"]["tokenExpiry"] = int(match.group(1))

    # å®‰å…¨çº¦æŸ
    if "åŠ å¯†" in demand:
        constraints["security"]["encryption"] = True

    return constraints
```

#### 1.3 çŸ¥è¯†ç¼ºå£è¯†åˆ«

```python
def identify_knowledge_gaps(demand: str, context: Memory) -> List[str]:
    """
    è¯†åˆ«è§„åˆ’éœ€è¦ä½†å½“å‰ç¼ºä¹çš„çŸ¥è¯†
    """
    gaps = []

    # æ£€æŸ¥æŠ€æœ¯æ ˆ
    if "JWT" in demand and not context.has_pattern("jwt"):
        gaps.append("JWTå®ç°æ¨¡å¼")

    if "å¯†ç " in demand and not context.has_pattern("bcrypt"):
        gaps.append("å¯†ç å“ˆå¸Œæ¨¡å¼")

    # æ£€æŸ¥æ¶æ„
    if "è®¤è¯" in demand and not context.has_pattern("auth"):
        gaps.append("è®¤è¯æ¶æ„æ¨¡å¼")

    # æ£€æŸ¥é¡¹ç›®ä¸Šä¸‹æ–‡
    if not context.has_key("tech_stack"):
        gaps.append("é¡¹ç›®æŠ€æœ¯æ ˆ")

    return gaps
```

---

### é˜¶æ®µ2: åŠŸèƒ½åˆ†è§£ (Decomposition)

#### 2.1 æ´‹è‘±æ¨¡å‹åˆ†è§£æ³•

```
                [ç”¨æˆ·å¯è§åŠŸèƒ½]
                      â†‘
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘   APIå±‚ (REST/GraphQL) â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•
                        â†“
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘  æœåŠ¡å±‚ (ä¸šåŠ¡é€»è¾‘)    â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•
                        â†“
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘  æ•°æ®å±‚ (DB/Cache)   â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•
                        â†“
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘  åŸºç¡€è®¾æ–½ (å®‰å…¨/ç›‘æ§) â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**åˆ†è§£è§„åˆ™**:
- æ¯ä¸€å±‚éƒ½å¯ä»¥ç‹¬ç«‹åˆ†è§£
- ä¸Šå±‚ä¾èµ–ä¸‹å±‚
- åŒå±‚ä»»åŠ¡å°½é‡è§£è€¦

#### 2.2 è®¤è¯ç³»ç»Ÿåˆ†è§£ç¤ºä¾‹

```python
# é¡¶å±‚: ç”¨æˆ·æ•…äº‹
stories = [
    "ä½œä¸ºæ–°ç”¨æˆ·ï¼Œæˆ‘å¯ä»¥æ³¨å†Œè´¦å·",
    "ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘å¯ä»¥ç™»å½•ç³»ç»Ÿ",
    "ä½œä¸ºå¿˜è®°å¯†ç çš„ç”¨æˆ·ï¼Œæˆ‘å¯ä»¥é‡ç½®å¯†ç ",
    "ä½œä¸ºç™»å½•ç”¨æˆ·ï¼Œæˆ‘å¯ä»¥å®‰å…¨é€€å‡º"
]

# ç¬¬äºŒå±‚: åŠŸèƒ½ç‚¹
features = {
    "æ³¨å†Œ": {
        "è¾“å…¥": ["email", "password"],
        "éªŒè¯": ["é‚®ç®±æ ¼å¼", "å¯†ç å¼ºåº¦", "é‚®ç®±å”¯ä¸€æ€§"],
        "å‰¯ä½œç”¨": ["å¯†ç å“ˆå¸Œ", "ç”ŸæˆéªŒè¯Token", "å‘é€é‚®ä»¶"]
    },
    "ç™»å½•": {
        "è¾“å…¥": ["email", "password"],
        "éªŒè¯": ["è´¦å·å­˜åœ¨", "å¯†ç åŒ¹é…", "è´¦å·å·²éªŒè¯"],
        "è¾“å‡º": ["JWT Token", "Refresh Token"]
    }
}

# ç¬¬ä¸‰å±‚: æŠ€æœ¯ä»»åŠ¡
tasks = {
    "æ³¨å†Œ": [
        "åˆ›å»ºUserè¡¨",
        "å®ç°å¯†ç bcryptå“ˆå¸Œ",
        "å®ç°é‚®ç®±éªŒè¯é€»è¾‘",
        "å®ç°Register API",
        "é›†æˆé‚®ä»¶æœåŠ¡",
        "å†™å•å…ƒæµ‹è¯•"
    ]
}
```

#### 2.3 MECEåŸåˆ™ï¼ˆMutually Exclusive, Collectively Exhaustiveï¼‰

```markdown
# å¥½çš„åˆ†è§£ï¼ˆç¬¦åˆMECEï¼‰

âœ… è®¤è¯ç³»ç»Ÿ
â”œâ”€ æ³¨å†Œï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰
â”œâ”€ ç™»å½•ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰
â”œâ”€ å¯†ç é‡ç½®ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰
â””â”€ Tokenç®¡ç†ï¼ˆç‹¬ç«‹åŠŸèƒ½ï¼‰

# åçš„åˆ†è§£ï¼ˆä¸ç¬¦åˆMECEï¼‰

âŒ è®¤è¯ç³»ç»Ÿ
â”œâ”€ æ³¨å†Œï¼ˆç‹¬ç«‹ï¼‰
â”œâ”€ ç™»å½•ï¼ˆç‹¬ç«‹ï¼‰
â”œâ”€ å‘é€é‚®ä»¶ï¼ˆé‡å¤ï¼šæ³¨å†Œå’Œå¯†ç é‡ç½®éƒ½å‘é€é‚®ä»¶ï¼‰  â† ä¸äº’æ–¥
â””â”€ ...ï¼ˆç¼ºå°‘Tokenåˆ·æ–°ã€ç™»å‡ºï¼‰ â† ä¸ç©·å°½
```

---

### é˜¶æ®µ3: ä¾èµ–å…³ç³»åˆ†æ

#### 3.1 ä¾èµ–ç±»å‹

```python
class DependencyType(Enum):
    # å¿…é¡»å…ˆå®ŒæˆAï¼Œæ‰èƒ½å¼€å§‹B
    SEQUENTIAL = "sequential"  # ä¸²è¡Œ

    # Aå’ŒBå¯ä»¥åŒæ—¶è¿›è¡Œ
    PARALLEL = "parallel"      # å¹¶è¡Œ

    # Aå®Œæˆåï¼ŒBæ‰èƒ½å¼€å§‹ï¼Œä½†Cä¸éœ€è¦A
    PARTIAL = "partial"        # éƒ¨åˆ†ä¾èµ–

    # Aå’ŒBäº’ç›¸ä¾èµ–ï¼ˆéœ€è¦é‡æ„è®¾è®¡ï¼‰
    CIRCULAR = "circular"      # å¾ªç¯ä¾èµ–ï¼ˆåå‘³é“ï¼‰
```

#### 3.2 æ„å»ºä¾èµ–å›¾

```python
def build_dependency_graph(tasks: List[Task]) -> nx.DiGraph:
    """
    æ„å»ºä»»åŠ¡ä¾èµ–å…³ç³»å›¾
    """
    G = nx.DiGraph()

    # æ·»åŠ èŠ‚ç‚¹
    for task in tasks:
        G.add_node(task.id,
                  name=task.name,
                  effort=task.effort,
                  priority=task.priority,
                  risk=task.risk_level)

    # æ·»åŠ è¾¹ï¼ˆä¾èµ–å…³ç³»ï¼‰
    for task in tasks:
        for dep_id in task.dependencies:
            G.add_edge(dep_id, task.id, type="depends_on")

    return G
```

#### 3.3 è¯†åˆ«å…³é”®è·¯å¾„

```python
def find_critical_path(G: nx.DiGraph) -> List[str]:
    """
    è®¡ç®—å…³é”®è·¯å¾„ï¼ˆæœ€é•¿å·¥æ—¶è·¯å¾„ï¼‰
    """
    # è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹åˆ°ç»ˆç‚¹çš„æœ€é•¿è·¯å¾„
    critical_path = nx.dag_longest_path(G, weight="effort")

    return critical_path
```

**è®¤è¯ç³»ç»Ÿå…³é”®è·¯å¾„ç¤ºä¾‹**: `Userè¡¨ â†’ Tokenè¡¨ â†’ TokenæœåŠ¡ â†’ Login API â†’ é›†æˆæµ‹è¯•`

**æ€»å·¥æ—¶**: 9å°æ—¶ï¼ˆæœ€çŸ­å¯èƒ½å®Œæˆæ—¶é—´ï¼‰

---

### é˜¶æ®µ4: ä»»åŠ¡æ ‘ç”Ÿæˆ

#### 4.1 å¯è§†åŒ–ä»»åŠ¡æ ‘ (ASCII)

```python
def generate_ascii_tree(tasks: List[Task]) -> str:
    """
    ç”ŸæˆASCIIæ ¼å¼çš„ä»»åŠ¡æ ‘
    """
    lines = []
    lines.append("å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (ç›®æ ‡)")
    lines.append("â”‚")

    # æŒ‰å±‚çº§åˆ†ç»„
    layers = {
        "åŸºç¡€è®¾æ–½": ["â‘ ", "â‘¡", "â‘¢"],
        "æœåŠ¡å±‚": ["â‘£", "â‘¤", "â‘¥"],
        "APIå±‚": ["â‘¦", "â‘§", "â‘¨", "â‘©", "â‘ª"],
        "å®‰å…¨å±‚": ["â‘«", "â‘¬", "â‘­"],
        "æµ‹è¯•": ["â‘®", "â‘¯", "â‘°"]
    }

    for i, (layer_name, task_ids) in enumerate(layers.items()):
        lines.append(f"â”œâ”€ {layer_name}")

        for j, task_id in enumerate(task_ids):
            task = get_task(task_id)
            prefix = "â””â”€" if j == len(task_ids) - 1 else "â”œâ”€"
            lines.append(f"â”‚   {prefix} {task_id}: {task.name} ({task.effort}h)")

    return "\n".join(lines)
```

**è¾“å‡ºç¤ºä¾‹**: `.ai-runtime/commands/runtime.plan.md`ä¸­åŒ…å«å®Œæ•´ç¤ºä¾‹

#### 4.2 JSONæ ¼å¼çš„ä»»åŠ¡æ ‘

```json
{
  "project": "ç”¨æˆ·è®¤è¯ç³»ç»Ÿ",
  "total_tasks": 17,
  "total_effort": "17.75h",
  "critical_path": ["â‘ ","â‘¡","â‘¤","â‘§","â‘®","â‘¯"],
  "critical_path_effort": "9h",
  "tasks": [
    {
      "id": "â‘ ",
      "name": "åˆ›å»ºUserè¡¨",
      "layer": "åŸºç¡€è®¾æ–½",
      "effort": 0.5,
      "priority": "P0",
      "dependencies": [],
      "risk": "low",
      "acceptance_criteria": [
        "è¡¨ç»“æ„ç¬¦åˆUseræ¨¡å‹",
        "å·²æ·»åŠ emailå”¯ä¸€ç´¢å¼•",
        "created_atè‡ªåŠ¨å¡«å……"
      ]
    },
    {
      "id": "â‘¡",
      "name": "åˆ›å»ºTokenè¡¨",
      "layer": "åŸºç¡€è®¾æ–½",
      "effort": 0.5,
      "priority": "P0",
      "dependencies": ["â‘ "],
      "risk": "low"
    }
  ],
  "phases": [
    {
      "phase": 1,
      "name": "åŸºç¡€è®¾æ–½",
      "tasks": ["â‘ ","â‘¡","â‘¢"],
      "parallelizable": true
    },
    {
      "phase": 2,
      "name": "æœåŠ¡å±‚",
      "tasks": ["â‘£","â‘¤","â‘¥"]
    }
  ]
}
```

#### 4.3 ç”˜ç‰¹å›¾ç”Ÿæˆ

```python
def generate_gantt(tasks: List[Task]) -> str:
    """
    ç”Ÿæˆç®€å•çš„ç”˜ç‰¹å›¾ï¼ˆMarkdownæ ¼å¼ï¼‰
    """
    lines = []
    lines.append("```gantt")
    lines.append("title è®¤è¯ç³»ç»Ÿå®æ–½è®¡åˆ’")
    lines.append("dateFormat  YYYY-MM-DD")
    lines.append("")

    # æŒ‰é˜¶æ®µåˆ†ç»„
    for phase in ["åŸºç¡€è®¾æ–½", "æœåŠ¡å±‚", "APIå±‚", "å®‰å…¨å±‚", "æµ‹è¯•"]:
        phase_tasks = [t for t in tasks if t.layer == phase]
        if phase_tasks:
            lines.append(f"section {phase}")
            for task in phase_tasks:
                start = task.start_date.strftime('%Y-%m-%d')
                end = task.end_date.strftime('%Y-%m-%d')
                lines.append(f"{task.name} :a{task.id}, {start}, {end}")

    lines.append("```")

    return "\n".join(lines)
```

---

### é˜¶æ®µ5: é£é™©è¯„ä¼°

#### 5.1 è¯†åˆ«é£é™©

```python
def identify_risks(tasks: List[Task]) -> List[Risk]:
    """
    åŸºäºä»»åŠ¡ç‰¹å¾è¯†åˆ«é£é™©
    """
    risks = []

    for task in tasks:
        # å¤æ‚åº¦è¿‡é«˜é£é™©
        if task.effort > 4:
            risks.append(Risk(
                task=task.id,
                level="medium",
                category="complexity",
                description="ä»»åŠ¡è¿‡å¤§ï¼Œå¯èƒ½éšè—æœªçŸ¥é—®é¢˜",
                mitigation="è¿›ä¸€æ­¥åˆ†è§£æˆå­ä»»åŠ¡"
            ))

        # ä¾èµ–è¿‡å¤šé£é™©
        if len(task.dependencies) > 3:
            risks.append(Risk(
                task=task.id,
                level="high",
                category="dependency",
                description="å¼ºä¾èµ–å¤šä¸ªä»»åŠ¡ï¼Œæˆä¸ºé˜»å¡ç‚¹",
                mitigation="å°½æ—©å¼€å§‹ï¼Œæˆ–ä¸ä¸‹æ¸¸ä»»åŠ¡åŒæ­¥è¿›è¡Œ"
            ))

        # æ–°çŸ¥è¯†é£é™©
        if task.confidence < 0.6:
            risks.append(Risk(
                task=task.id,
                level="high",
                category="knowledge",
                description="ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯/æ¨¡å¼ï¼Œå®¹æ˜“å‡ºé”™",
                mitigation="å…ˆè¿›è¡Œå°çš„Spikeï¼Œæˆ–è¯·æ±‚ä¸“å®¶å¸®åŠ©"
            ))

    return risks
```

#### 5.2 é£é™©çŸ©é˜µ

```markdown
## é£é™©è¯„ä¼°çŸ©é˜µ

| ä»»åŠ¡ | é£é™©ç±»å‹ | å¯èƒ½æ€§ | å½±å“ | ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
|------|---------|--------|------|------|---------|
| å¯†ç é‡ç½®æµç¨‹ | å¤æ‚åº¦ | ä¸­ | é«˜ | ğŸ”´ é«˜ | è¿›ä¸€æ­¥åˆ†è§£ï¼Œå…ˆåšSpike |
| Tokenåˆ·æ–° | çŸ¥è¯†ç¼ºå£ | é«˜ | ä¸­ | ğŸŸ¡ ä¸­ | æŸ¥é˜…èµ„æ–™ï¼Œå’¨è¯¢ä¸“å®¶ |
| EmailæœåŠ¡ | å¤–éƒ¨ä¾èµ– | ä½ | ä¸­ | ğŸŸ¢ ä½ | è®¾è®¡é™çº§æ–¹æ¡ˆ |
```

---

## å‘½ä»¤å®šä¹‰

### è¯­æ³•

```bash
/runtime.plan "[éœ€æ±‚æè¿°]" \
  --strategy=[full|mvp|risk-driven] \
  --estimate=[true|false] \
  --detail=[high|medium|low] \
  --output=[json|md|both]
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `strategy` | è§„åˆ’ç­–ç•¥<br>- `full`: å®Œæ•´è§„åˆ’æ‰€æœ‰ç»†èŠ‚<br>- `mvp`: åªè§„åˆ’MVPæ ¸å¿ƒåŠŸèƒ½<br>- `risk-driven`: ä¼˜å…ˆè§„åˆ’é«˜é£é™©éƒ¨åˆ† | `full` |
| `estimate` | æ˜¯å¦åŒ…å«å·¥æ—¶ä¼°ç®— | `true` |
| `detail` | ä»»åŠ¡è¯¦ç»†ç¨‹åº¦ | `medium` |
| `output` | è¾“å‡ºæ ¼å¼ | `both` |

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1: å®Œæ•´è§„åˆ’

```bash
/runtime.plan "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ³¨å†Œã€ç™»å½•ã€å¯†ç é‡ç½®ã€JWTç®¡ç†ï¼Œä½¿ç”¨bcryptåŠ å¯†ï¼ŒJWTæœ‰æ•ˆæœŸ7å¤©"
```

**è¾“å‡º**:

**console**:
```
ğŸ“‹ éœ€æ±‚è§„åˆ’: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

éœ€æ±‚ç±»å‹: æ–°åŠŸèƒ½å¼€å‘
æŠ€æœ¯æ ˆ: Node.js + Express + PostgreSQL + JWT
çº¦æŸ: JWTæœ‰æ•ˆæœŸ7å¤©ï¼ŒbcryptåŠ å¯†

[åŠŸèƒ½æ‹†è§£]
â”œâ”€ æ³¨å†Œ
â”œâ”€ ç™»å½•
â”œâ”€ å¯†ç é‡ç½®
â””â”€ JWTç®¡ç†

[ä»»åŠ¡ç»Ÿè®¡]
æ€»ä»»åŠ¡æ•°: 17ä¸ª
æ€»å·¥æ—¶: 17.75å°æ—¶
å…³é”®è·¯å¾„: 9å°æ—¶

[é£é™©]
âš ï¸  å¯†ç é‡ç½®æµç¨‹å¤æ‚åº¦é«˜ï¼ˆå»ºè®®Spikeï¼‰
âš ï¸  Tokenåˆ·æ–°æœºåˆ¶ä¸ç†Ÿæ‚‰ï¼ˆå»ºè®®å…ˆè°ƒç ”ï¼‰

è¾“å‡ºæ–‡ä»¶:
âœ“ cognition/plans/plan-20251114-1045.json
âœ“ cognition/plans/plan-20251114-1045.md
âœ“ cognition/graphs/task-tree-20251114-1045.svg
```

**JSONè¾“å‡º**: `cognition/plans/plan-20251114-1045.json`
```json
{
  "project": "ç”¨æˆ·è®¤è¯ç³»ç»Ÿ",
  "requirement": "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ³¨å†Œ...",
  "total_tasks": 17,
  "total_effort": "17.75h",
  "critical_path": ["â‘ ","â‘¡","â‘¤","â‘§","â‘®","â‘¯"],
  "tasks": [...],
  "risks": [...]
}
```

**Markdownè¾“å‡º**: `cognition/plans/plan-20251114-1045.md`
```markdown
# ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - å®æ–½è®¡åˆ’

## éœ€æ±‚æ¦‚è¿°
å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ...

## ä»»åŠ¡æ ‘

### é˜¶æ®µ1: åŸºç¡€è®¾æ–½
- â‘  åˆ›å»ºUserè¡¨ (0.5h) - P0
- â‘¡ åˆ›å»ºTokenè¡¨ (0.5h) - P0 - ä¾èµ–:â‘ 
- â‘¢ é…ç½®JWT (0.25h) - P0

...

## ç”˜ç‰¹å›¾
```gantt
...
```

## é£é™©è¯„ä¼°
...
```

#### ç¤ºä¾‹2: MVPè§„åˆ’

```bash
/runtime.plan "æ„å»ºå›¾ç‰‡åˆ†äº«ç¤¾äº¤å¹³å°" --strategy=mvp
```

**ç‰¹ç‚¹**:
- åªè§„åˆ’æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¸Šä¼ å›¾ç‰‡ã€æµè§ˆã€ç‚¹èµã€è¯„è®ºï¼‰
- éæ ¸å¿ƒåŠŸèƒ½ï¼ˆæ»¤é•œã€æ•…äº‹ã€æ¨èç®—æ³•ï¼‰æ¨è¿Ÿåˆ°åç»­è¿­ä»£
- å¿«é€Ÿäº¤ä»˜å¯æ¼”ç¤ºç‰ˆæœ¬

#### ç¤ºä¾‹3: é£é™©é©±åŠ¨è§„åˆ’

```bash
/runtime.plan "å®ç°å¾®æœåŠ¡æ¶æ„çš„ç”µå•†å¹³å°" --strategy=risk-driven
```

**ç‰¹ç‚¹**:
- ä¼˜å…ˆè¯†åˆ«é«˜é£é™©ä»»åŠ¡ï¼ˆæœåŠ¡æ‹†åˆ†ã€æ•°æ®ä¸€è‡´æ€§ã€åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰
- å»ºè®®å…ˆSpikeï¼Œé™ä½ä¸ç¡®å®šæ€§
- ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š

---

## è§„åˆ’ç­–ç•¥

### ç­–ç•¥1: Fullï¼ˆå®Œæ•´è§„åˆ’ï¼‰

```
é€‚ç”¨: é¡¹ç›®éœ€æ±‚æ˜ç¡®ï¼ŒæŠ€æœ¯æ–¹æ¡ˆæ¸…æ™°ï¼Œæœ‰è¶³å¤Ÿæ—¶é—´

ç‰¹ç‚¹:
- è§„åˆ’æ‰€æœ‰ç»†èŠ‚
- åŒ…æ‹¬æµ‹è¯•ã€æ–‡æ¡£ã€ç›‘æ§
- ç²¾ç¡®åˆ°å°æ—¶çš„ä¼°ç®—

è¾“å‡º: å®Œæ•´é¡¹ç›®è®¡åˆ’ï¼ˆç±»ä¼¼PRD + æŠ€æœ¯æ–¹æ¡ˆï¼‰
```

### ç­–ç•¥2: MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰

```
é€‚ç”¨: éœ€æ±‚æ¢ç´¢æœŸï¼Œéœ€è¦å¿«é€ŸéªŒè¯ï¼Œæ—¶é—´ç´§å¼ 

ç‰¹ç‚¹:
- åªè§„åˆ’æ ¸å¿ƒä»·å€¼åŠŸèƒ½
- ç æ‰æ‰€æœ‰"é”¦ä¸Šæ·»èŠ±"çš„åŠŸèƒ½
- ä¼°ç®—ç²—ç•¥ï¼ˆåªåˆ°å¤©ï¼‰

è¾“å‡º: MVPåŠŸèƒ½æ¸…å• + æœ€å°ä»»åŠ¡é›†
```

**ç¤ºä¾‹**: ç¤¾äº¤åº”ç”¨MVP
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… å‘å¸–
- âœ… æµè§ˆå¸–å­
- âœ… ç‚¹èµ

**æ¨è¿Ÿåˆ°è¿­ä»£2**:
- âŒ è¯„è®ºå›å¤
- âŒ ç§ä¿¡
- âŒ æ¨èç®—æ³•
- âŒ å›¾ç‰‡æ»¤é•œ

### ç­–ç•¥3: Risk-Drivenï¼ˆé£é™©é©±åŠ¨è§„åˆ’ï¼‰

```
é€‚ç”¨: æŠ€æœ¯ä¸ç¡®å®šæ€§å¼ºï¼Œæœ‰é«˜é£é™©æ¨¡å—

ç‰¹ç‚¹:
- ä¼˜å…ˆåˆ†æé«˜é£é™©ä»»åŠ¡
- å»ºè®®å…ˆåšæŠ€æœ¯è°ƒç ”ï¼ˆSpikeï¼‰
- ç”Ÿæˆé£é™©ç¼“è§£è®¡åˆ’

è¾“å‡º: é£é™©çŸ©é˜µ + åº”å¯¹ç­–ç•¥ + è°ƒæ•´åä»»åŠ¡æ ‘
```

**ç¤ºä¾‹**: å¾®æœåŠ¡æ¶æ„

é«˜é£é™©ä»»åŠ¡:
1. æœåŠ¡æ‹†åˆ†ç­–ç•¥ â†’ å…ˆåšSpike
2. åˆ†å¸ƒå¼äº‹åŠ¡ â†’ è°ƒç ”Sagaæ¨¡å¼
3. æ•°æ®ä¸€è‡´æ€§ â†’ è¯„ä¼°æœ€ç»ˆä¸€è‡´æ€§å½±å“

ä½é£é™©ä»»åŠ¡ï¼ˆå¯ä»¥æ¨è¿Ÿï¼‰:
- APIç½‘å…³ â†’ æˆç†ŸæŠ€æœ¯ï¼Œç›´æ¥ä½¿ç”¨
- æœåŠ¡å‘ç° â†’ Consul/Nacosç›´æ¥ä½¿ç”¨
- é…ç½®ä¸­å¿ƒ â†’ Apollo/Nacosç›´æ¥ä½¿ç”¨

---

## ä»»åŠ¡è§„æ ¼æ¨¡æ¿

æ¯ä¸ªä»»åŠ¡ä½¿ç”¨ç»Ÿä¸€æ¨¡æ¿ï¼š

```markdown
## Task {ID}: {ä»»åŠ¡åç§°}

**ID**: TASK-{ID}
**ç±»å‹**: [feature|bug|refactor|doc|test]
**ä¼˜å…ˆçº§**: [P0|P1|P2]
**é¢„è®¡å·¥æ—¶**: Xå°æ—¶
**ç½®ä¿¡åº¦**: 0.X (0-1)
**ä¾èµ–**: [ä¾èµ–çš„ä»»åŠ¡IDåˆ—è¡¨]

### ç›®æ ‡
[æ¸…æ™°æè¿°ä»»åŠ¡çš„ç›®æ ‡]

### éªŒæ”¶æ ‡å‡†ï¼ˆDoDï¼‰
- [ ] ä»£ç å®ç°å®Œæˆ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] æ— å›å½’é”™è¯¯

### å®ç°å¤§çº²
1. [æ­¥éª¤1]
2. [æ­¥éª¤2]
3. [æ­¥éª¤3]

### æ½œåœ¨é£é™©
- âš ï¸ [é£é™©1]
- âš ï¸ [é£é™©2]

### å¦‚æœå¡ä½ï¼ˆEscalationï¼‰
- [æ±‚åŠ©è°/æŸ¥é˜…ä»€ä¹ˆ]

### ç›¸å…³æ–‡ä»¶
- [æ–‡ä»¶è·¯å¾„]
```

---

## ä¸ /runtime.learn çš„åŒºåˆ«

| ç»´åº¦ | `/runtime.learn` | `/runtime.plan` | ä¸ºä»€ä¹ˆåˆ†å¼€ï¼Ÿ |
|------|-----------------|----------------|------------|
| **ç›®æ ‡** | ç†è§£æœªçŸ¥é—®é¢˜ | è§„åˆ’å·²çŸ¥éœ€æ±‚ | è®¤çŸ¥é˜¶æ®µä¸åŒ |
| **è¾“å…¥** | é—®é¢˜ï¼ˆéœ€è¦æ¢ç´¢ï¼‰ | éœ€æ±‚ï¼ˆç›¸å¯¹æ˜ç¡®ï¼‰ | å‰ææ¡ä»¶ä¸åŒ |
| **æ ¸å¿ƒ** | çŸ¥è¯†ç¼ºå£è¯†åˆ« | åŠŸèƒ½æ‹†è§£ä¸ä¾èµ–åˆ†æ | æ–¹æ³•è®ºä¸åŒ |
| **è¾“å‡º** | å­¦ä¹ æŠ¥å‘Š + æ–°çŸ¥è¯† | ä»»åŠ¡æ ‘ + æ‰§è¡Œè®¡åˆ’ | äº§ç‰©ä¸åŒ |
| **ä¸‹ä¸€æ­¥** | é€šå¸¸æ¥ /runtime.plan | æ¥ /runtime.iterate | å·¥ä½œæµåˆ†å·¥ |

**å…¸å‹å·¥ä½œæµ**:
```
æƒ…å†µA: å®Œå…¨æœªçŸ¥çš„é—®é¢˜
/runtime.learn "ä¸ºä»€ä¹ˆæœåŠ¡ä¼šå´©æºƒï¼Ÿ"
  â†“ ç†è§£åï¼Œå‘ç°é—®é¢˜: "éœ€è¦æ·»åŠ é™æµ"
/runtime.plan "å®ç°é™æµåŠŸèƒ½"  # ç”Ÿæˆå®æ–½è®¡åˆ’
  â†“
/runtime.iterate --plan=plan-xx.json  # æ‰§è¡Œè®¡åˆ’

æƒ…å†µB: æ˜ç¡®çš„éœ€æ±‚
/runtime.plan "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"  # ç›´æ¥è§„åˆ’
  â†“
/runtime.iterate --plan=plan-xx.json  # æ‰§è¡Œè®¡åˆ’
```

---

## å·¥å…·ä¸è„šæœ¬

### è¾…åŠ©è„šæœ¬: task-analyzer.py

```python
#!/usr/bin/env python3
"""
ä»»åŠ¡åˆ†æå™¨ - ä»éœ€æ±‚æ–‡æœ¬æå–ç»“æ„åŒ–ä¿¡æ¯
"""

import re
import json

class TaskAnalyzer:
    def __init__(self):
        self.patterns = {
            "action": r"(å®ç°|æ·»åŠ |ä¿®æ”¹|åˆ é™¤|é‡æ„|ä¿®å¤)",
            "object": r"(ç”¨æˆ·|è®¤è¯|JWT|å¯†ç |é‚®ä»¶|Token|API)",
            "constraint": r"\[(.*?)\]",
            "time": r"(\d+å¤©|\d+å°æ—¶|\d+h)"
        }

    def analyze(self, requirement_text):
        """åˆ†æéœ€æ±‚æ–‡æœ¬"""
        result = {
            "actions": [],
            "objects": [],
            "constraints": [],
            "time_keywords": []
        }

        for key, pattern in self.patterns.items():
            matches = re.findall(pattern, requirement_text)
            result[f"{key}s"] = matches

        return result

    def suggest_tasks(self, analysis):
        """åŸºäºåˆ†æå»ºè®®ä»»åŠ¡"""
        tasks = []

        # å¦‚æœå‘ç°"è®¤è¯"å’Œ"ç”¨æˆ·"
        if "è®¤è¯" in analysis["objects"] and "ç”¨æˆ·" in analysis["objects"]:
            tasks.extend([
                "åˆ›å»ºUserè¡¨",
                "å®ç°å¯†ç å“ˆå¸Œ",
                "å®ç°æ³¨å†ŒAPI",
                "å®ç°ç™»å½•API"
            ])

        # å¦‚æœå‘ç°"JWT"
        if "JWT" in analysis["objects"]:
            tasks.extend([
                "é…ç½®JWT",
                "å®ç°Tokenç”Ÿæˆ",
                "å®ç°TokenéªŒè¯",
                "å®ç°Tokenåˆ·æ–°"
            ])

        return list(set(tasks))

# ä½¿ç”¨ç¤ºä¾‹
analyzer = TaskAnalyzer()
result = analyzer.analyze("å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬JWTå’ŒbcryptåŠ å¯†")
print(json.dumps(result, indent=2, ensure_ascii=False))
```

---

## æœ€ä½³å®è·µ

### å®è·µ1: è§„åˆ’å‰å…ˆç”¨Learnï¼ˆå¦‚æœä¸ç¡®å®šï¼‰

```bash
# ä¸ç¡®å®šç°æœ‰æ¶æ„
âŒ /runtime.plan "å®ç°æ–°åŠŸèƒ½X"  # å¯èƒ½è§„åˆ’ä¸åˆ‡å®é™…

# å…ˆå­¦ä¹ ï¼Œå†è§„åˆ’
âœ… /runtime.learn "ç†è§£ç°æœ‰æ¶æ„" â†’ ç½®ä¿¡åº¦>0.8
âœ… /runtime.plan "å®ç°æ–°åŠŸèƒ½X"
```

### å®è·µ2: ç”¨å°éœ€æ±‚ç»ƒä¹ 

```bash
# å¤æ‚éœ€æ±‚ï¼ˆä¸å»ºè®®é¦–æ¬¡å°è¯•ï¼‰
âŒ /runtime.plan "é‡æ„æ•´ä¸ªå¾®æœåŠ¡æ¶æ„"

# ä»å°éœ€æ±‚å¼€å§‹
âœ… /runtime.plan "æ·»åŠ å¯†ç é‡ç½®åŠŸèƒ½"  # 3-5ä¸ªä»»åŠ¡
âœ… /runtime.plan "å®ç°ç”¨æˆ·æ³¨å†Œ"      # 2-3ä¸ªä»»åŠ¡
```

### å®è·µ3: å®šæœŸé‡æ–°è§„åˆ’

```python
# éœ€æ±‚å˜æ›´æ—¶
if requirement_changed:
    # ä¸æ˜¯ç»§ç»­æ‰§è¡Œæ—§è®¡åˆ’
    old_plan = load_old_plan()

    # è€Œæ˜¯é‡æ–°è§„åˆ’
    new_plan = runtime.plan(new_requirement)

    # æ¯”è¾ƒå·®å¼‚
    diff = compare_plans(old_plan, new_plan)

    # é€‚åº”æ–°è®¡åˆ’
    runtime.iterate(plan=new_plan)
```

### å®è·µ4: ä¿å­˜å¹¶å¤ç”¨æ¨¡å¼

```bash
# è§„åˆ’å®Œæˆå
/runtime.plan "å®ç°OAuth2.0è®¤è¯"

# å›ºåŒ–æˆåŠŸæ¨¡å¼
/runtime.remember "OAuth2.0è®¤è¯çš„ä»»åŠ¡æ ‘æ¨¡æ¿"

# ä¸‹æ¬¡ç±»ä¼¼éœ€æ±‚
/runtime.plan "å®ç°SAMLè®¤è¯"
  â†’ AIä»è®°å¿†ä¸­æå–OAuth2.0æ¨¡å¼ä½œä¸ºå‚è€ƒ
  â†’ ç”Ÿæˆç±»ä¼¼ç»“æ„çš„ä»»åŠ¡æ ‘
```

---

## è¾“å‡ºè§„èŒƒ

### JSON Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "version": {"type": "string"},
    "project": {"type": "string"},
    "requirement": {"type": "string"},
    "created_at": {"type": "string"},
    "total_tasks": {"type": "integer"},
    "total_effort": {"type": "string"},
    "critical_path": {
      "type": "array",
      "items": {"type": "string"}
    },
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "name": {"type": "string"},
          "layer": {"type": "string"},
          "effort": {"type": "number"},
          "priority": {"type": "string"},
          "dependencies": {
            "type": "array",
            "items": {"type": "string"}
          },
          "acceptance_criteria": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      }
    },
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "task": {"type": "string"},
          "level": {"type": "string"},
          "category": {"type": "string"},
          "description": {"type": "string"},
          "mitigation": {"type": "string"}
        }
      }
    }
  }
}
```

---

## å®ªæ³•éµå¾ª

**éµå¾ªåŸåˆ™**:
- âœ“ 1.2 ç±»è„‘æ€ç»´: å°†éœ€æ±‚æ‹†è§£ä¸ºå¯ç®¡ç†çš„æ¨¡å—
- âœ“ 2.1 ä»£ç å³çŸ¥è¯†: ä»»åŠ¡æ ‘æ˜¯ä»£ç ç»“æ„çš„å¿ƒæ™ºæ¨¡å‹
- âœ“ 4.4 è§„åˆ’é€æ˜: è§„åˆ’è¿‡ç¨‹æ¸…æ™°å¯è§ï¼ˆæ–°å¢ï¼‰
- âœ“ 1.3 è°¦é€Šä¸ä¸ç¡®å®š: æ˜ç¡®æ ‡æ³¨ç½®ä¿¡åº¦å’Œé£é™©
- âœ“ 2.2 æ¸è¿›å¼å®æ–½: æ”¯æŒMVPå’Œé£é™©é©±åŠ¨ç­–ç•¥

---

**å‘½ä»¤å®šä¹‰**: `.ai-runtime/commands/runtime.plan.md`
**è„šæœ¬**: `.ai-runtime/scripts/task-analyzer.py` (è¾…åŠ©åˆ†æ)
**è¾“å‡º**: `cognition/plans/plan-{timestamp}.{json|md}`
**ç‰ˆæœ¬**: 1.0.0