{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-10T10:52:04.188Z",
    "slug": "agentsecops-policy-opa",
    "source_url": "https://github.com/AgentSecOps/SecOpsAgentKit/tree/main/skills/compliance/policy-opa",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "source_type": "community",
    "content_hash": "7dec1c56076189612084399db1a7fed3ce0196f6bd54b52fb44de8f041b64514",
    "tree_hash": "944e03ad9fadd063a672d73e54ed299fdf5e7708cca2240ab369beb091a68065"
  },
  "skill": {
    "name": "policy-opa",
    "description": "Policy-as-code enforcement and compliance validation using Open Policy Agent (OPA). Use when: (1) Enforcing security and compliance policies across infrastructure and applications, (2) Validating Kubernetes admission control policies, (3) Implementing policy-as-code for compliance frameworks (SOC2, PCI-DSS, GDPR, HIPAA), (4) Testing and evaluating OPA Rego policies, (5) Integrating policy checks into CI/CD pipelines, (6) Auditing configuration drift against organizational security standards, (7) Implementing least-privilege access controls.\n",
    "summary": "Policy-as-code enforcement and compliance validation using Open Policy Agent (OPA). Use when: (1) En...",
    "icon": "üõ°Ô∏è",
    "version": "0.1.0",
    "author": "AgentSecOps",
    "license": "MIT",
    "category": "compliance",
    "tags": [
      "opa",
      "policy-as-code",
      "compliance",
      "rego",
      "kubernetes",
      "admission-control",
      "soc2",
      "gdpr",
      "pci-dss",
      "hipaa"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Pure documentation and policy template skill with no executable code. Contains only Rego policy definitions, YAML configurations, and reference documentation for Open Policy Agent. No scripts, network calls, filesystem access, or command execution detected.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 14,
    "total_lines": 3707,
    "audit_model": "claude",
    "audited_at": "2026-01-10T10:52:04.188Z"
  },
  "content": {
    "user_title": "Enforce policy-as-code with Open Policy Agent",
    "value_statement": "Manual compliance checks are slow and error-prone. This skill provides ready-to-use Rego policies for SOC2, PCI-DSS, GDPR, and HIPAA compliance that can be enforced automatically in CI/CD pipelines and Kubernetes admission controllers.",
    "seo_keywords": [
      "opa",
      "open policy agent",
      "policy-as-code",
      "compliance automation",
      "kubernetes admission control",
      "rego",
      "soc2 compliance",
      "pci-dss",
      "gdpr",
      "claude code"
    ],
    "actual_capabilities": [
      "Evaluate OPA Rego policies against configuration files",
      "Enforce Kubernetes pod security standards via admission control",
      "Validate Terraform infrastructure-as-code for security compliance",
      "Map policies to SOC2, PCI-DSS, GDPR, and HIPAA control frameworks",
      "Integrate policy validation into GitHub Actions and GitLab CI pipelines",
      "Generate compliance reports from policy evaluation results"
    ],
    "limitations": [
      "Requires OPA binary to be installed separately",
      "Does not include pre-built container images or binaries",
      "Policy enforcement depends on OPA Gatekeeper for Kubernetes runtime",
      "Does not automatically remediate violations"
    ],
    "use_cases": [
      {
        "target_user": "DevOps Engineers",
        "title": "Validate IaC Security",
        "description": "Run policy checks on Terraform plans before deployment to catch misconfigurations early."
      },
      {
        "target_user": "Security Architects",
        "title": "Define Compliance Policies",
        "description": "Create centralized policy templates mapped to regulatory frameworks for organization-wide enforcement."
      },
      {
        "target_user": "Platform Teams",
        "title": "Enforce K8s Standards",
        "description": "Block non-compliant workloads from running in Kubernetes clusters using admission controllers."
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic Policy Check",
        "scenario": "Evaluate a config file",
        "prompt": "Evaluate this Kubernetes deployment against the pod security policies in the policy-opa skill and report any violations."
      },
      {
        "title": "Compliance Mapping",
        "scenario": "Map to framework",
        "prompt": "Show me how the Rego policies in policy-opa map to SOC2 CC6.1 access control requirements."
      },
      {
        "title": "CI/CD Integration",
        "scenario": "Add to pipeline",
        "prompt": "How do I add OPA policy validation to my GitHub Actions workflow using the examples from policy-opa?"
      },
      {
        "title": "Custom Policy",
        "scenario": "Write new policy",
        "prompt": "Create a custom Rego policy using the patterns from policy-opa that denies AWS S3 buckets without versioning enabled."
      }
    ],
    "output_examples": [
      {
        "input": "Evaluate this Kubernetes Pod manifest against pod security policies",
        "output": [
          "Pod security violations found:",
          "- Container 'nginx' must run as non-root (line 15)",
          "- Container 'nginx' must use read-only root filesystem (line 16)",
          "- hostPath volumes are not allowed (line 22)",
          "Recommendations: Set securityContext.runAsNonRoot: true, securityContext.readOnlyRootFilesystem: true, and use emptyDir volumes instead of hostPath."
        ]
      }
    ],
    "best_practices": [
      "Store policies in version control with peer review requirements for all changes",
      "Maintain at least 80% test coverage for all Rego policy rules",
      "Map each policy to specific compliance controls for audit traceability"
    ],
    "anti_patterns": [
      "Embedding secrets or credentials directly in policy files",
      "Using wildcard (*) permissions in RBAC policies without justification",
      "Skipping policy validation in production deployments"
    ],
    "faq": [
      {
        "question": "What tools does this skill require?",
        "answer": "OPA binary, Docker for container testing, kubectl for Kubernetes integration, and jq/yq for data processing."
      },
      {
        "question": "What is the maximum policy bundle size?",
        "answer": "OPA supports bundles up to 50MB. For larger policy sets, split into domain-specific bundles evaluated separately."
      },
      {
        "question": "Can policies be applied to existing resources?",
        "answer": "OPA Gatekeeper supports audit mode to check existing resources. Remediation must be done manually or through separate automation."
      },
      {
        "question": "How is sensitive data handled?",
        "answer": "Policies should never embed secrets. Use external data sources or encrypted configuration files for sensitive parameters."
      },
      {
        "question": "Why are my policies not matching input data?",
        "answer": "Check input structure matches policy expectations. Use 'opa eval --explain full' to trace evaluation and identify mismatches."
      },
      {
        "question": "How does this compare to native cloud policies?",
        "answer": "OPA provides unified policy language across clouds. AWS has IAM Access Analyzer, Azure has Policy, GCP has Organization Policies. OPA integrates with all."
      }
    ]
  },
  "file_structure": [
    {
      "name": "assets",
      "type": "dir",
      "path": "assets",
      "children": [
        {
          "name": "ci-cd-pipeline.yaml",
          "type": "file",
          "path": "assets/ci-cd-pipeline.yaml"
        },
        {
          "name": "gdpr-compliance.rego",
          "type": "file",
          "path": "assets/gdpr-compliance.rego"
        },
        {
          "name": "k8s-constraint-template.yaml",
          "type": "file",
          "path": "assets/k8s-constraint-template.yaml"
        },
        {
          "name": "k8s-constraint.yaml",
          "type": "file",
          "path": "assets/k8s-constraint.yaml"
        },
        {
          "name": "k8s-pod-security.rego",
          "type": "file",
          "path": "assets/k8s-pod-security.rego"
        },
        {
          "name": "pci-dss-compliance.rego",
          "type": "file",
          "path": "assets/pci-dss-compliance.rego"
        },
        {
          "name": "soc2-compliance.rego",
          "type": "file",
          "path": "assets/soc2-compliance.rego"
        },
        {
          "name": "terraform-security.rego",
          "type": "file",
          "path": "assets/terraform-security.rego"
        }
      ]
    },
    {
      "name": "references",
      "type": "dir",
      "path": "references",
      "children": [
        {
          "name": "compliance-frameworks.md",
          "type": "file",
          "path": "references/compliance-frameworks.md"
        },
        {
          "name": "EXAMPLE.md",
          "type": "file",
          "path": "references/EXAMPLE.md"
        },
        {
          "name": "iac-policies.md",
          "type": "file",
          "path": "references/iac-policies.md"
        },
        {
          "name": "kubernetes-security.md",
          "type": "file",
          "path": "references/kubernetes-security.md"
        },
        {
          "name": "rego-patterns.md",
          "type": "file",
          "path": "references/rego-patterns.md"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}
