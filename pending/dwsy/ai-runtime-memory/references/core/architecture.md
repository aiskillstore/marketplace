# 记忆系统架构详解

## 分层记忆架构

AI Runtime采用三层记忆系统，模拟人类大脑的记忆机制：

```
短期记忆（工作记忆） ← 当前会话上下文 (7±2组块限制)
    ↓ 固化
长期记忆（语义记忆） ← 跨项目技术知识 (结构化知识图谱)
    ↓ 时间戳
情景记忆（体验记忆） ← 项目历史事件 (时间线序列)
```

## 设计原则详述

### 短期记忆 (short-term/)
- **位置**: `.ai-runtime/memory/short-term/`
- **内容**: 当前会话上下文、任务栈、工作假设
- **容量**: 类似人脑7±2组块限制
- **生命周期**: 实时衰减，支撑当前任务
- **管理**: 自动清理过期内容（7天）

### 长期记忆 (long-term/)
- **位置**: `.ai-runtime/memory/long-term/`
- **内容**: 跨项目技术知识、设计模式、代码质量经验
- **特点**: 结构化整理，支持快速检索
- **用途**: 提供经验基础上的智能建议

### 情景记忆 (episodic/)
- **位置**: `.ai-runtime/memory/episodic/`
- **内容**: 项目历史、关键决策、错误教训、会议纪要
- **格式**: 时间线记录 + 事件详情
- **特点**: 可追溯性，支持复杂SQL风格查询

## 文件夹结构详解

### episodic/ - 情景记忆存储

**目录结构**:
```
episodic/
├── 2025/
│   ├── 11/
│   │   ├── 14/
│   │   │   ├── event-001.md
│   │   │   └── meeting-001.md
│   │   └── 15/
│   └── 12/
└── timeline.md (自动生成的时间线索引)
```

**文件格式规范**:
- 必须使用YAML front matter
- 支持多级时间目录结构
- 自动时间推断机制

### long-term/ - 长期记忆存储

**内容分类**:
- `project-context.md` - 项目架构记忆
- `tech-stack.md` - 技术栈知识
- `design-patterns.md` - 设计模式经验
- `user-preferences.md` - 用户偏好记录

### short-term/ - 短期记忆存储

**文件类型**:
- `consciousness.md` - 当前意识流状态
- `task-stack.md` - 任务栈快照
- `working-hypothesis.md` - 工作假设

## 记忆生命周期管理

### 固化流程

1. **短期 → 长期固化**:
   - 识别有价值模式和知识
   - 整理为结构化文档
   - 移动到 `long-term/` 目录
   - 更新知识图谱索引

2. **工作记忆 → 情景记忆**:
   - 关键事件自动记录 (`/runtime.remember`)
   - 生成时间戳和上下文
   - 添加到episodic时间线

### 清理策略

**自动清理**:
- 短期记忆: 7天过期自动删除
- 工作状态: 会话结束后清理
- 临时假设: 验证后清理

**手动归档**:
- 重要事件移动到归档目录
- 合并相似记忆条目
- 更新索引和引用关系

## 索引和检索机制

### 自动索引生成
- episodic目录扫描生成timeline.md
- 基于文件名和front matter的时间推断
- 支持多级时间聚合（年/月/日）

### 检索优化
- 时间范围索引
- 标签倒排索引
- 类型分类索引
- 全文搜索支持
