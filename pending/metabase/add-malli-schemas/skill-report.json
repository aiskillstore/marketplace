{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-06T01:20:37.537Z",
    "slug": "metabase-add-malli-schemas",
    "source_url": "https://github.com/metabase/metabase/tree/master/.claude/skills/add-malli-schemas",
    "source_ref": "master",
    "model": "claude",
    "analysis_version": "2.0.0",
    "source_type": "community",
    "content_hash": "f9c6c2d0a197708300913509a98d2e50f6b0c0cbda7c4f069b3b01de5a926062",
    "tree_hash": "bef9302c1101a7df1b110b8487ea965e976809ff7485a5a20fe55e8cacbc7d78"
  },
  "skill": {
    "name": "add-malli-schemas",
    "description": "Efficiently add Malli schemas to API endpoints in the Metabase codebase with proper patterns, validation timing, and error handling",
    "summary": "Efficiently add Malli schemas to API endpoints in the Metabase codebase with proper patterns, valida...",
    "icon": "üîç",
    "version": "1.0.0",
    "author": "metabase",
    "license": "MIT",
    "category": "coding",
    "tags": [
      "clojure",
      "malli",
      "schemas",
      "api",
      "validation"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a documentation-only skill that provides guidance on adding Malli schemas to API endpoints. It contains no executable code, network calls, or file system access. The skill is purely educational and presents best practices for schema validation in Clojure applications.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 1,
    "total_lines": 421,
    "audit_model": "claude",
    "audited_at": "2026-01-06T01:20:37.537Z"
  },
  "content": {
    "user_title": "Add Malli Schemas to API Endpoints",
    "value_statement": "Adding proper schema validation to API endpoints prevents bugs and improves API reliability. This skill guides you through adding Malli schemas with correct patterns, validation timing, and error handling for Metabase APIs.",
    "seo_keywords": [
      "malli schemas",
      "clojure validation",
      "api endpoints",
      "metabase",
      "claude code",
      "schema validation",
      "clojure api",
      "type safety",
      "codex",
      "claude"
    ],
    "actual_capabilities": [
      "Provides step-by-step guidance for adding Malli schemas",
      "Shows proper schema patterns for route, query, and body parameters",
      "Explains validation timing for request vs response schemas",
      "Includes common pitfalls and best practices",
      "References real Metabase API examples"
    ],
    "limitations": [
      "Only applies to Metabase codebase using Malli",
      "Requires existing Clojure/Malli knowledge",
      "Does not generate schemas automatically",
      "Focused on API endpoints only"
    ],
    "use_cases": [
      {
        "target_user": "Clojure developers",
        "title": "Schema existing API endpoints",
        "description": "Add validation schemas to legacy endpoints that lack proper input validation"
      },
      {
        "target_user": "API designers",
        "title": "Design robust API contracts",
        "description": "Create comprehensive schemas that validate all request and response data"
      },
      {
        "target_user": "Code reviewers",
        "title": "Review schema implementations",
        "description": "Verify that API endpoints follow Metabase schema conventions and best practices"
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic schema addition",
        "scenario": "Adding schemas to a simple GET endpoint",
        "prompt": "Help me add Malli schemas to this GET endpoint: (api.macros/defendpoint :get \"/:id\" \"Get user by ID\" [{:keys [id]}] (t2/select-one :model/User :id id)). I need route param and response schemas."
      },
      {
        "title": "Complex validation",
        "scenario": "POST endpoint with nested data",
        "prompt": "I have a POST endpoint that creates a dashboard with cards. The body has nested card definitions. Show me how to create proper Malli schemas for validation including optional fields and default values."
      },
      {
        "title": "Custom error messages",
        "scenario": "Improving validation error messages",
        "prompt": "My API validation errors are confusing users. How do I add custom error messages to Malli schemas for specific validation failures like invalid email formats or out-of-range values?"
      },
      {
        "title": "Schema optimization",
        "scenario": "Refactoring repetitive schemas",
        "prompt": "I notice I'm repeating similar schema patterns across multiple endpoints. What's the best way to create reusable named schemas in Malli for common patterns like pagination responses?"
      }
    ],
    "output_examples": [
      {
        "input": "Help me add schemas to my user update endpoint",
        "output": [
          "Here's how to add proper Malli schemas to your user update endpoint:",
          "",
          "1. Route params schema for user ID",
          "2. Request body schema with optional fields",
          "3. Response schema matching your return type",
          "4. Custom error messages for validation failures",
          "5. Testing checklist to verify your schemas work correctly"
        ]
      }
    ],
    "best_practices": [
      "Always use existing schema types from ms namespace instead of raw predicates",
      "Test schemas with both valid and invalid data before deploying",
      "Create named schemas for structures used in multiple endpoints"
    ],
    "anti_patterns": [
      "Using ms/TemporalString in response schemas - use :any for Java Time objects",
      "Forgetting :optional true for query parameters that aren't required",
      "Creating anonymous inline schemas for complex reusable structures"
    ],
    "faq": [
      {
        "question": "Is this skill compatible with all Clojure projects?",
        "answer": "No, this skill is specifically designed for the Metabase codebase and assumes Malli is already configured with custom schema types."
      },
      {
        "question": "What are the main limitations when adding schemas?",
        "answer": "Response schemas validate before JSON serialization, so use :any for Java Time objects and [:set X] for sets, not strings."
      },
      {
        "question": "Can I integrate this with my existing API validation?",
        "answer": "Yes, Malli schemas complement other validation approaches and provide better error messages and type safety for Clojure APIs."
      },
      {
        "question": "Is my data safe when using these schemas?",
        "answer": "Yes, schemas only validate data structure and types. They don't store or transmit data, just ensure it matches expected formats."
      },
      {
        "question": "What if my endpoint returns unexpected data?",
        "answer": "Use the REPL to inspect actual return values before serialization, then design schemas to match the real data structure."
      },
      {
        "question": "How does this compare to other validation libraries?",
        "answer": "Malli is specifically chosen by Metabase for its performance, error messages, and integration with the existing codebase."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}
