{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2025-12-30T08:33:02.644Z",
    "slug": "mcp-integration",
    "source_url": "https://github.com/anthropics/claude-code/tree/main/plugins/plugin-dev/skills/mcp-integration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "trust_level": "official"
  },
  "skill": {
    "name": "MCP Integration",
    "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
    "summary": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in...",
    "icon": "ðŸ”Œ",
    "version": "0.1.0",
    "author": "Anthropic",
    "license": "Not specified",
    "category": "development",
    "tags": [
      "mcp",
      "integration",
      "api",
      "protocol",
      "plugins",
      "external-services",
      "oauth",
      "authentication",
      "stdio",
      "sse",
      "http",
      "websocket"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is an official Anthropic skill providing documentation and guidance for MCP integration. Contains no executable code, only configuration examples and educational content with strong emphasis on security best practices.",
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 7,
    "total_lines": 2249,
    "audit_model": "claude",
    "audited_at": "2025-12-30T08:33:02.643Z"
  },
  "content": {
    "user_title": "MCP Integration Guide for Claude Code Plugins",
    "value_statement": "Connect Claude Code plugins to external services, databases, and APIs using Model Context Protocol to expose 10+ related tools with OAuth support and automatic authentication handling.",
    "seo_keywords": [
      "model context protocol",
      "mcp integration",
      "claude code plugins",
      "external api integration",
      "oauth authentication",
      "stdio server",
      "sse server",
      "plugin development",
      "service integration",
      "api connector"
    ],
    "actual_capabilities": [
      "Configure stdio MCP servers for local tools and custom servers",
      "Integrate SSE servers for cloud services with automatic OAuth handling",
      "Connect HTTP REST API servers with token-based authentication",
      "Set up WebSocket servers for real-time bidirectional communication",
      "Use environment variable expansion for portable configurations",
      "Bundle MCP servers with plugins using .mcp.json or plugin.json",
      "Pre-allow MCP tools in commands with proper naming conventions",
      "Handle multiple MCP servers in a single plugin",
      "Implement various authentication patterns (OAuth, tokens, env vars)",
      "Debug MCP connections and tool calls with logging guidance"
    ],
    "limitations": [
      "Requires restart of Claude Code after configuration changes",
      "MCP servers must implement the Model Context Protocol specification",
      "OAuth flows require browser access for user authentication",
      "stdio servers are platform-dependent and require proper executables",
      "Network-based servers (SSE/HTTP/WS) require internet connectivity",
      "Tool names follow strict naming convention that cannot be customized",
      "Only supports documented MCP server types (stdio, SSE, HTTP, WebSocket)"
    ],
    "use_cases": [
      {
        "title": "Integrate Database Access",
        "description": "Add database querying capabilities to plugins using stdio MCP server with local database connections for reading and writing data.",
        "target_user": "Plugin developers building data-driven tools"
      },
      {
        "title": "Connect to Asana or GitHub",
        "description": "Integrate hosted cloud services using SSE servers with automatic OAuth authentication for seamless user experience.",
        "target_user": "Users needing project management or repository integration"
      },
      {
        "title": "Expose REST API Tools",
        "description": "Connect internal or external REST APIs using HTTP MCP servers with token-based authentication for stateless interactions.",
        "target_user": "Developers integrating custom or third-party APIs"
      },
      {
        "title": "Build Real-Time Features",
        "description": "Implement real-time data streaming and bidirectional communication using WebSocket MCP servers for low-latency applications.",
        "target_user": "Developers building collaborative or live-update features"
      },
      {
        "title": "Bundle File System Access",
        "description": "Package NPM-based MCP servers like @modelcontextprotocol/server-filesystem with plugins for portable file system tools.",
        "target_user": "Plugin developers creating file management utilities"
      }
    ],
    "prompt_templates": [
      {
        "title": "Add MCP Server to Plugin",
        "prompt": "Add an MCP server to my plugin that connects to [service name]. It should use [stdio/SSE/HTTP/WebSocket] and authenticate with [OAuth/token/environment variables].",
        "scenario": "Starting MCP integration in a new or existing plugin"
      },
      {
        "title": "Configure OAuth Authentication",
        "prompt": "Set up OAuth authentication for my SSE MCP server connecting to [service]. What configuration do I need and how will users authenticate?",
        "scenario": "Implementing OAuth for cloud service integration"
      },
      {
        "title": "Debug MCP Connection",
        "prompt": "My MCP server isn't connecting. It's a [stdio/SSE/HTTP/WS] server configured like [paste config]. How do I debug this?",
        "scenario": "Troubleshooting connection or authentication issues"
      },
      {
        "title": "Use MCP Tools in Commands",
        "prompt": "I have an MCP server providing tools for [service]. How do I use these tools in my plugin commands and what's the proper tool naming?",
        "scenario": "Integrating MCP tools into command workflows"
      },
      {
        "title": "Set Up Environment Variables",
        "prompt": "My MCP server needs [API_KEY, DATABASE_URL, etc.]. How do I configure environment variables and document them for users?",
        "scenario": "Configuring secure credential management"
      }
    ],
    "output_examples": [
      {
        "input": "Add a stdio MCP server for database access",
        "output": "Created .mcp.json with stdio configuration:\n{\n  \"database\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DATABASE_URL\": \"${DATABASE_URL}\"\n    }\n  }\n}\n\nDocumented required environment variables in README:\n- DATABASE_URL: PostgreSQL connection string\n\nTools will be available as: mcp__plugin_yourplugin_database__*"
      },
      {
        "input": "How do I use OAuth with an SSE server?",
        "output": "For SSE servers, OAuth is handled automatically by Claude Code:\n\n{\n  \"asana\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.asana.com/sse\"\n  }\n}\n\nNo additional auth configuration needed. On first use:\n1. User prompted to authenticate\n2. Browser opens for OAuth consent\n3. Tokens stored securely\n4. Automatic token refresh\n\nDocument required OAuth scopes in your README for user awareness."
      }
    ],
    "best_practices": [
      "Use ${CLAUDE_PLUGIN_ROOT} for all file references to ensure portability across installations",
      "Create dedicated .mcp.json file for cleaner separation when configuring multiple servers",
      "Always use HTTPS for SSE/HTTP servers and WSS for WebSocket servers, never plain HTTP/WS",
      "Store tokens and secrets in environment variables, never hardcode in configuration files",
      "Pre-allow specific MCP tools in commands instead of using wildcards for better security",
      "Document all required environment variables clearly in plugin README with setup instructions",
      "Handle connection failures and tool call errors gracefully with helpful user messages",
      "Test MCP integration locally using /mcp command and claude --debug before publishing",
      "Batch similar MCP requests when possible to improve performance and reduce API calls",
      "Choose stdio for local tools, SSE for OAuth-enabled cloud services, HTTP for REST APIs"
    ],
    "anti_patterns": [
      "Hardcoding API tokens or secrets directly in .mcp.json configuration files",
      "Using HTTP or WS protocols instead of HTTPS/WSS for network-based servers",
      "Pre-allowing all tools with wildcards (mcp__plugin_*__*) instead of specific tools",
      "Forgetting to document required environment variables in plugin README",
      "Using absolute file paths instead of ${CLAUDE_PLUGIN_ROOT} for portability",
      "Making many individual MCP tool calls instead of batching similar requests",
      "Committing credentials or .env files to version control",
      "Skipping error handling for connection failures or authentication issues",
      "Not testing MCP server connectivity before publishing plugin",
      "Choosing wrong server type (e.g., stdio for cloud service or SSE for local tool)"
    ],
    "faq": [
      {
        "question": "What's the difference between .mcp.json and mcpServers in plugin.json?",
        "answer": "Both work identically. .mcp.json is recommended for multiple servers or cleaner separation, while mcpServers in plugin.json works well for simple single-server plugins. Choose based on your plugin's complexity."
      },
      {
        "question": "How do MCP tool names work?",
        "answer": "MCP tools are automatically prefixed: mcp__plugin_<plugin-name>_<server-name>__<tool-name>. For example, a 'create_task' tool from 'asana' server in 'asana' plugin becomes: mcp__plugin_asana_asana__asana_create_task"
      },
      {
        "question": "When should I use stdio vs SSE vs HTTP servers?",
        "answer": "Use stdio for local tools and custom servers, SSE for hosted cloud services with OAuth, HTTP for REST APIs with token auth, and WebSocket for real-time bidirectional communication. stdio has lowest latency, SSE best user auth experience."
      },
      {
        "question": "How does OAuth authentication work with SSE servers?",
        "answer": "Claude Code handles OAuth automatically. When a user first uses an MCP tool requiring auth, they're prompted to authenticate in their browser. Claude Code manages tokens securely, refreshes them automatically, and clears them on sign-out."
      },
      {
        "question": "How do I pass environment variables to MCP servers?",
        "answer": "Use ${VARIABLE_NAME} syntax in configuration. For stdio servers, add to 'env' field. For HTTP/SSE servers, use in headers. Users set variables in their shell. Always document required variables in README."
      },
      {
        "question": "Can I use multiple MCP servers in one plugin?",
        "answer": "Yes! Add multiple entries to .mcp.json or mcpServers. Each server provides its own set of tools with unique names. Useful for plugins that integrate multiple services (e.g., GitHub + Jira)."
      },
      {
        "question": "How do I debug MCP connection issues?",
        "answer": "Run 'claude --debug' to see connection logs. Use '/mcp' command to verify servers are loaded and tools available. Check: server URL correctness, authentication credentials, network connectivity, and configuration JSON syntax."
      },
      {
        "question": "Do I need to restart Claude Code after changing MCP configuration?",
        "answer": "Yes, Claude Code must be restarted for MCP configuration changes to take effect. This includes changes to .mcp.json, plugin.json mcpServers, or environment variables."
      },
      {
        "question": "How do I pre-allow MCP tools in commands?",
        "answer": "Add allowed-tools array to command frontmatter with full tool names: ['mcp__plugin_name_server__tool_name']. Avoid wildcards unless truly necessary. This ensures commands can only access specific approved tools."
      },
      {
        "question": "What's the best way to handle MCP tool errors?",
        "answer": "Validate inputs before calling tools, catch and interpret error responses, provide helpful user messages (not raw errors), suggest remediation steps, and handle common cases like authentication failures, rate limiting, and network issues."
      }
    ],
    "technical_requirements": {
      "dependencies": [
        "Claude Code runtime environment",
        "MCP server implementation (stdio executable, hosted SSE/HTTP/WS endpoint, or NPM package)",
        "Network connectivity (for SSE/HTTP/WebSocket servers)",
        "Node.js and npx (for NPM-based stdio servers)",
        "Required environment variables set by user",
        "Valid OAuth configuration (for SSE servers using OAuth)"
      ],
      "permissions": [
        "Execute local processes (stdio servers)",
        "Network access to external services (SSE/HTTP/WebSocket)",
        "Read environment variables",
        "OAuth browser flow for user authentication (SSE)",
        "Access to user-specified paths for ${CLAUDE_PLUGIN_ROOT}",
        "Tool execution permissions in Claude Code commands"
      ],
      "complexity": "intermediate"
    }
  },
  "file_structure": [
    {
      "name": "examples",
      "type": "dir",
      "path": "examples",
      "children": [
        {
          "name": "http-server.json",
          "type": "file",
          "path": "examples/http-server.json"
        },
        {
          "name": "sse-server.json",
          "type": "file",
          "path": "examples/sse-server.json"
        },
        {
          "name": "stdio-server.json",
          "type": "file",
          "path": "examples/stdio-server.json"
        }
      ]
    },
    {
      "name": "references",
      "type": "dir",
      "path": "references",
      "children": [
        {
          "name": "authentication.md",
          "type": "file",
          "path": "references/authentication.md"
        },
        {
          "name": "server-types.md",
          "type": "file",
          "path": "references/server-types.md"
        },
        {
          "name": "tool-usage.md",
          "type": "file",
          "path": "references/tool-usage.md"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}