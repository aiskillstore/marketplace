{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2025-12-30T09:54:53.636Z",
    "slug": "mcp-integration",
    "source_url": "https://github.com/anthropics/claude-code/tree/main/plugins/plugin-dev/skills/mcp-integration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "trust_level": "official"
  },
  "skill": {
    "name": "MCP Integration",
    "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
    "summary": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in...",
    "icon": "ðŸ”Œ",
    "version": "0.1.0",
    "author": "Anthropic",
    "license": "Not specified",
    "category": "development",
    "tags": [
      "mcp",
      "integration",
      "api",
      "plugins",
      "external-services",
      "oauth",
      "authentication",
      "model-context-protocol",
      "stdio",
      "sse",
      "websocket",
      "http"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Official Anthropic skill providing educational content and configuration examples for MCP integration. No executable code, only documentation and JSON configuration examples with security best practices.",
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 7,
    "total_lines": 2249,
    "audit_model": "claude",
    "audited_at": "2025-12-30T09:54:53.636Z"
  },
  "content": {
    "user_title": "MCP Integration Guide for Claude Code Plugins",
    "value_statement": "Learn how to connect Claude Code plugins to external services and APIs using the Model Context Protocol, enabling access to databases, cloud services, and custom tools through stdio, SSE, HTTP, and WebSocket servers.",
    "seo_keywords": [
      "model context protocol",
      "mcp server configuration",
      "claude code plugins",
      "external service integration",
      "oauth authentication",
      "stdio mcp",
      "sse server",
      "api integration",
      "plugin development",
      "mcp tools"
    ],
    "actual_capabilities": [
      "Configure MCP servers in plugins using .mcp.json or plugin.json",
      "Connect to external services via stdio, SSE, HTTP, and WebSocket protocols",
      "Implement OAuth and token-based authentication for MCP servers",
      "Use environment variable expansion including ${CLAUDE_PLUGIN_ROOT}",
      "Pre-allow MCP tools in commands with proper namespacing",
      "Bundle MCP servers with plugins for automatic setup",
      "Handle connection failures and error scenarios gracefully",
      "Debug MCP integration using /mcp command and --debug flag"
    ],
    "limitations": [
      "Requires MCP server to be developed separately or use existing MCP servers",
      "OAuth flows only supported for SSE and HTTP server types",
      "Environment variables must be set by users before plugin can access them",
      "MCP configuration changes require Claude Code restart to take effect",
      "Tool naming convention adds verbose prefixes (mcp__plugin_name_server__tool)",
      "Mutual TLS (mTLS) not directly supported, requires wrapper implementation"
    ],
    "use_cases": [
      {
        "title": "Connect to Cloud Services",
        "description": "Integrate with hosted MCP servers like Asana, GitHub, or custom cloud APIs using SSE transport with automatic OAuth authentication",
        "target_user": "Plugin developers building integrations with SaaS platforms"
      },
      {
        "title": "Local File System Access",
        "description": "Use stdio MCP servers to provide safe, scoped file system access through NPM packages like @modelcontextprotocol/server-filesystem",
        "target_user": "Developers creating file management or project scaffolding tools"
      },
      {
        "title": "Database Query Tools",
        "description": "Expose database operations through custom stdio MCP servers that handle connections and queries with proper authentication via environment variables",
        "target_user": "Teams building database management or data analysis plugins"
      },
      {
        "title": "REST API Integration",
        "description": "Connect to internal or external REST APIs using HTTP MCP servers with token-based authentication for stateless interactions",
        "target_user": "Developers integrating with existing API backends"
      },
      {
        "title": "Real-time Data Streaming",
        "description": "Implement WebSocket MCP servers for bidirectional communication, push notifications, and low-latency tool calls",
        "target_user": "Developers building collaborative or live-update features"
      }
    ],
    "prompt_templates": [
      {
        "title": "Add stdio MCP server to plugin",
        "prompt": "I want to add an MCP server to my plugin that runs a local Node.js script at ./servers/my-server.js. It needs to access the DATABASE_URL environment variable. How do I configure this?",
        "scenario": "Setting up a local MCP server that communicates via stdin/stdout"
      },
      {
        "title": "Configure SSE server with OAuth",
        "prompt": "Help me connect to the Asana MCP server at https://mcp.asana.com/sse with OAuth authentication in my plugin",
        "scenario": "Integrating with a hosted cloud service using automatic OAuth"
      },
      {
        "title": "Use MCP tools in command",
        "prompt": "I have an MCP server called 'database' in my 'analytics' plugin that provides a 'query' tool. How do I use this tool in a command and what's the full tool name?",
        "scenario": "Understanding tool naming and pre-allowing MCP tools in commands"
      },
      {
        "title": "Debug MCP connection issues",
        "prompt": "My MCP server isn't connecting. How can I debug this and see what's happening?",
        "scenario": "Troubleshooting MCP server connectivity problems"
      },
      {
        "title": "Secure token configuration",
        "prompt": "What's the best way to handle API tokens for an HTTP MCP server without hardcoding them in my plugin?",
        "scenario": "Implementing secure authentication patterns"
      }
    ],
    "output_examples": [
      {
        "input": "Show me how to configure a stdio MCP server",
        "output": "Here's a .mcp.json configuration for a stdio server:\n\n```json\n{\n  \"my-server\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/my-server.js\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"API_KEY\": \"${MY_API_KEY}\",\n      \"LOG_LEVEL\": \"info\"\n    }\n  }\n}\n```\n\nKey points:\n- Use ${CLAUDE_PLUGIN_ROOT} for portable paths\n- Pass environment variables through the env field\n- Document required env vars (MY_API_KEY) in your README"
      },
      {
        "input": "What's the tool name format for MCP tools?",
        "output": "MCP tools follow this naming convention:\n\n**Format:** `mcp__plugin_<plugin-name>_<server-name>__<tool-name>`\n\n**Example:**\n- Plugin: asana\n- Server: asana\n- Tool: create_task\n- **Full name:** `mcp__plugin_asana_asana__asana_create_task`\n\nUse the `/mcp` command to see all available tools and their exact names."
      }
    ],
    "best_practices": [
      "Use ${CLAUDE_PLUGIN_ROOT} for all file paths to ensure portability across installations",
      "Always use HTTPS/WSS for network connections, never HTTP/WS",
      "Store sensitive credentials in environment variables, never hardcode tokens",
      "Document all required environment variables clearly in the plugin README",
      "Pre-allow specific MCP tools in commands rather than using wildcards",
      "Let OAuth handle authentication automatically for SSE/HTTP servers when available",
      "Handle connection failures and tool errors gracefully with user-friendly messages",
      "Test MCP integration locally using /mcp command and --debug flag before publishing",
      "Choose stdio for local tools, SSE for hosted OAuth services, HTTP for token APIs, and WebSocket for real-time needs",
      "Batch similar MCP requests together instead of making many individual calls"
    ],
    "anti_patterns": [
      "Hardcoding API tokens or credentials directly in .mcp.json configuration files",
      "Using HTTP instead of HTTPS or WS instead of WSS for network connections",
      "Pre-allowing all MCP tools with wildcards (mcp__plugin_*__*) in commands",
      "Using absolute file paths instead of ${CLAUDE_PLUGIN_ROOT} variable",
      "Committing environment variables or .env files containing secrets to git",
      "Making many individual MCP tool calls instead of batching queries",
      "Skipping error handling for connection failures or tool call errors",
      "Logging or exposing sensitive authentication tokens in debug output",
      "Using find-and-replace to change MCP tool names instead of checking /mcp output",
      "Forgetting to document required environment variables in README"
    ],
    "faq": [
      {
        "question": "What's the difference between .mcp.json and mcpServers in plugin.json?",
        "answer": "Both methods work identically. .mcp.json is recommended for better separation of concerns and easier maintenance, especially with multiple servers. Use mcpServers in plugin.json for simple single-server plugins."
      },
      {
        "question": "How do I find the exact MCP tool names to use in commands?",
        "answer": "Run the /mcp command in Claude Code to see all available MCP servers, their tools, schemas, and the full prefixed tool names like mcp__plugin_name_server__tool."
      },
      {
        "question": "Do MCP servers start automatically when my plugin is enabled?",
        "answer": "Yes, MCP servers are automatically started when the plugin loads. For stdio servers, Claude Code spawns the process. For network servers (SSE/HTTP/WS), connections are established on-demand."
      },
      {
        "question": "How does OAuth authentication work for SSE servers?",
        "answer": "Claude Code handles the entire OAuth flow automatically. When a user first uses an MCP tool requiring OAuth, they're prompted to authenticate in their browser. Tokens are securely stored and automatically refreshed by Claude Code."
      },
      {
        "question": "Can I use MCP tools in agents without pre-allowing them?",
        "answer": "Yes, agents have broader tool access than commands. They can use any MCP tool Claude determines is necessary without requiring pre-allowed lists in frontmatter."
      },
      {
        "question": "What environment variables are automatically available?",
        "answer": "CLAUDE_PLUGIN_ROOT is automatically provided and points to your plugin directory. All other environment variables must be set by users in their shell before running Claude Code."
      },
      {
        "question": "How do I debug MCP connection issues?",
        "answer": "Use claude --debug to see detailed logs of MCP server connections, authentication flows, and tool calls. Also run /mcp to verify servers are connected and tools are available."
      },
      {
        "question": "Which MCP server type should I use?",
        "answer": "Use stdio for local tools and custom servers, SSE for hosted cloud services with OAuth, HTTP for REST APIs with token auth, and WebSocket for real-time bidirectional communication needs."
      },
      {
        "question": "Can I bundle an MCP server with my plugin?",
        "answer": "Yes, place the MCP server code in your plugin directory (e.g., ./servers/) and reference it using ${CLAUDE_PLUGIN_ROOT}/servers/my-server in your MCP configuration."
      },
      {
        "question": "Do configuration changes take effect immediately?",
        "answer": "No, you must restart Claude Code after modifying .mcp.json or mcpServers configuration for changes to take effect."
      }
    ],
    "technical_requirements": {
      "dependencies": [
        "MCP server (stdio binary/script, or hosted SSE/HTTP/WS endpoint)",
        "Environment variables for authentication tokens if required",
        "Node.js/Python/etc runtime if using stdio servers",
        "Network connectivity for SSE/HTTP/WebSocket server types"
      ],
      "permissions": [
        "Access to environment variables (read-only)",
        "Network access for SSE/HTTP/WebSocket connections",
        "Process spawn permissions for stdio servers",
        "File system access to CLAUDE_PLUGIN_ROOT directory"
      ],
      "complexity": "intermediate"
    }
  },
  "file_structure": [
    {
      "name": "examples",
      "type": "dir",
      "path": "examples",
      "children": [
        {
          "name": "http-server.json",
          "type": "file",
          "path": "examples/http-server.json"
        },
        {
          "name": "sse-server.json",
          "type": "file",
          "path": "examples/sse-server.json"
        },
        {
          "name": "stdio-server.json",
          "type": "file",
          "path": "examples/stdio-server.json"
        }
      ]
    },
    {
      "name": "references",
      "type": "dir",
      "path": "references",
      "children": [
        {
          "name": "authentication.md",
          "type": "file",
          "path": "references/authentication.md"
        },
        {
          "name": "server-types.md",
          "type": "file",
          "path": "references/server-types.md"
        },
        {
          "name": "tool-usage.md",
          "type": "file",
          "path": "references/tool-usage.md"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}