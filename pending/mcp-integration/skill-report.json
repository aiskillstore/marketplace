{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2025-12-30T14:29:00.334Z",
    "slug": "mcp-integration",
    "source_url": "https://github.com/anthropics/claude-code/tree/main/plugins/plugin-dev/skills/mcp-integration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "trust_level": "official"
  },
  "skill": {
    "name": "MCP Integration",
    "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
    "summary": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in...",
    "icon": "ðŸ”Œ",
    "version": "0.1.0",
    "author": "Anthropic",
    "license": "MIT",
    "category": "development",
    "tags": [
      "mcp",
      "integration",
      "api",
      "external-services",
      "protocol",
      "plugin-development",
      "oauth",
      "authentication",
      "sse",
      "stdio",
      "websocket",
      "http"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Official Anthropic skill providing documentation and guidance for MCP integration. Contains no executable code, only configuration examples and best practices with strong emphasis on security patterns.",
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 7,
    "total_lines": 2249,
    "audit_model": "claude",
    "audited_at": "2025-12-30T14:29:00.334Z"
  },
  "content": {
    "user_title": "MCP Integration Guide",
    "value_statement": "Connect Claude Code plugins to external services like databases, APIs, and cloud platforms through the Model Context Protocol, enabling rich tool integration with OAuth support and multiple transport types.",
    "seo_keywords": [
      "model context protocol",
      "mcp integration",
      "claude code plugins",
      "external api integration",
      "oauth authentication",
      "sse server",
      "stdio server",
      "websocket mcp",
      "plugin development",
      "tool integration"
    ],
    "actual_capabilities": [
      "Configure MCP servers in plugins using .mcp.json or plugin.json",
      "Support for stdio (local process), SSE (server-sent events), HTTP (REST API), and WebSocket server types",
      "Automatic OAuth flow handling for cloud services",
      "Token-based authentication with environment variable support",
      "Environment variable expansion including ${CLAUDE_PLUGIN_ROOT}",
      "Automatic tool discovery and registration with namespaced tool names",
      "Multiple server integration within a single plugin",
      "Dynamic header generation with helper scripts",
      "Comprehensive error handling and debugging guidance"
    ],
    "limitations": [
      "MCP servers must be configured before plugin loads (requires restart for changes)",
      "Tool names follow strict naming convention: mcp__plugin_<name>_<server>__<tool>",
      "OAuth flows only supported for SSE and HTTP server types",
      "Mutual TLS (mTLS) requires custom wrapper implementation",
      "Environment variables must be set before Claude Code starts",
      "Server connection failures may not provide immediate feedback"
    ],
    "use_cases": [
      {
        "title": "Integrate Cloud Service with OAuth",
        "description": "Connect to hosted services like Asana or GitHub using SSE transport with automatic OAuth authentication, allowing users to authenticate once and access all service tools",
        "target_user": "Plugin developers integrating with popular cloud platforms"
      },
      {
        "title": "Add Local Database Access",
        "description": "Bundle a stdio MCP server with your plugin to provide database querying, schema inspection, and data manipulation tools using local database connections",
        "target_user": "Developers building data analysis or ETL plugins"
      },
      {
        "title": "Connect Internal REST API",
        "description": "Integrate with company internal APIs using HTTP transport with token-based authentication, exposing API endpoints as Claude Code tools",
        "target_user": "Enterprise developers building custom internal tooling"
      },
      {
        "title": "Real-time Data Streaming",
        "description": "Use WebSocket transport to connect to real-time services for live updates, notifications, or collaborative features with bidirectional communication",
        "target_user": "Developers building real-time monitoring or collaboration tools"
      },
      {
        "title": "File System Operations",
        "description": "Integrate the official filesystem MCP server using stdio to provide secure file operations within specified directories",
        "target_user": "Plugin developers needing controlled file system access"
      }
    ],
    "prompt_templates": [
      {
        "title": "Add SSE MCP Server for Cloud Service",
        "prompt": "Add an MCP server configuration for [service name] using SSE transport. The server URL is [url] and requires OAuth authentication.",
        "scenario": "When integrating a hosted cloud service that provides an MCP endpoint"
      },
      {
        "title": "Configure stdio Server with Environment Variables",
        "prompt": "Set up a stdio MCP server that runs [command] with arguments [args] and needs environment variables [var names] for database connection.",
        "scenario": "When bundling a local MCP server that requires database credentials"
      },
      {
        "title": "Add HTTP MCP Server with Token Auth",
        "prompt": "Configure an HTTP MCP server at [url] that uses Bearer token authentication from the ${API_TOKEN} environment variable.",
        "scenario": "When integrating a REST API that requires token-based authentication"
      },
      {
        "title": "Debug MCP Server Connection",
        "prompt": "My MCP server named [server-name] isn't connecting. Help me debug the configuration and check if the server is accessible.",
        "scenario": "When troubleshooting MCP server connectivity issues"
      },
      {
        "title": "Use MCP Tools in Command",
        "prompt": "Create a command that uses the MCP tools [tool names] from my [server name] server to [desired functionality].",
        "scenario": "When building commands that leverage MCP server capabilities"
      }
    ],
    "output_examples": [
      {
        "input": "Add an MCP server for the filesystem using stdio",
        "output": "Created .mcp.json with stdio configuration:\n{\n  \"filesystem\": {\n    \"command\": \"npx\",\n    \"args\": [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"${CLAUDE_PROJECT_DIR}\"],\n    \"env\": {\n      \"LOG_LEVEL\": \"info\"\n    }\n  }\n}\n\nThe filesystem MCP server will provide file operation tools prefixed with mcp__plugin_yourplugin_filesystem__"
      },
      {
        "input": "Configure Asana MCP integration",
        "output": "Added SSE configuration to .mcp.json:\n{\n  \"asana\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.asana.com/sse\"\n  }\n}\n\nOAuth authentication will be handled automatically. Users will authenticate in their browser on first use. Tools will be available as mcp__plugin_yourplugin_asana__asana_*"
      }
    ],
    "best_practices": [
      "Always use ${CLAUDE_PLUGIN_ROOT} for file paths to ensure portability across installations",
      "Document all required environment variables in the plugin README with clear setup instructions",
      "Use HTTPS for HTTP/SSE servers and WSS for WebSocket servers - never use insecure protocols",
      "Pre-allow specific MCP tools in command frontmatter rather than using wildcards",
      "Store sensitive tokens in environment variables, never hardcode them in configuration files",
      "Let OAuth handle authentication for supported services instead of managing tokens manually",
      "Test MCP server connectivity locally using the /mcp command before publishing",
      "Handle connection failures and tool call errors gracefully with helpful user messages",
      "Use .mcp.json as a dedicated configuration file for better maintainability",
      "Batch similar requests when possible to reduce MCP server round trips"
    ],
    "anti_patterns": [
      "Hardcoding API tokens or credentials directly in .mcp.json configuration",
      "Using HTTP instead of HTTPS or WS instead of WSS for network connections",
      "Using wildcard tool permissions (mcp__plugin_*__*) instead of specific tool lists",
      "Making many individual MCP tool calls instead of batching or querying with filters",
      "Forgetting to document required environment variables in the README",
      "Committing .env files or credentials to version control",
      "Using absolute paths instead of ${CLAUDE_PLUGIN_ROOT} for server commands",
      "Skipping error handling for MCP connection failures or tool call errors",
      "Testing only success cases without validating authentication and error scenarios"
    ],
    "faq": [
      {
        "question": "Should I use .mcp.json or add mcpServers to plugin.json?",
        "answer": "Use .mcp.json for better separation of concerns and easier maintenance, especially if you have multiple MCP servers. Use mcpServers in plugin.json only for simple single-server plugins where keeping everything in one file is preferred."
      },
      {
        "question": "How do MCP tool names work?",
        "answer": "MCP tools are automatically prefixed with mcp__plugin_<plugin-name>_<server-name>__<tool-name>. For example, a 'create_task' tool from an 'asana' server in an 'asana' plugin becomes mcp__plugin_asana_asana__asana_create_task."
      },
      {
        "question": "When should I use stdio vs SSE vs HTTP?",
        "answer": "Use stdio for local tools, custom servers, or NPM packages you bundle with your plugin. Use SSE for hosted cloud services with OAuth support. Use HTTP for REST APIs with token authentication. Use WebSocket for real-time bidirectional communication."
      },
      {
        "question": "How does OAuth authentication work?",
        "answer": "For SSE and HTTP servers that support OAuth, Claude Code automatically handles the entire OAuth flow. Users are prompted to authenticate in their browser on first tool use, and tokens are securely stored and automatically refreshed by Claude Code."
      },
      {
        "question": "What environment variables are available?",
        "answer": "${CLAUDE_PLUGIN_ROOT} points to your plugin directory and should always be used for file paths. Any environment variables set in the user's shell (like ${API_TOKEN}, ${DB_URL}) can be referenced in MCP configuration for authentication and server settings."
      },
      {
        "question": "How do I debug MCP server connection issues?",
        "answer": "Run claude --debug to see detailed connection logs. Use the /mcp command to verify servers are loaded and tools are available. Check that URLs are correct, authentication is configured, and required environment variables are set. For stdio servers, verify the command exists and is executable."
      },
      {
        "question": "Can I use multiple MCP servers in one plugin?",
        "answer": "Yes! You can configure multiple MCP servers in .mcp.json or plugin.json. Each server provides its own set of tools with unique names based on the server name. This is useful for plugins that integrate with multiple services."
      },
      {
        "question": "How do I handle MCP server errors in commands?",
        "answer": "Validate inputs before calling MCP tools, check for common error conditions (authentication failures, rate limits, network issues), and provide clear error messages to users with actionable remediation steps. Don't expose internal error details."
      }
    ],
    "technical_requirements": {
      "dependencies": [
        "Claude Code plugin system",
        "Model Context Protocol compatible server",
        "For stdio: Node.js/Python/executable for server process",
        "For SSE/HTTP/WebSocket: Network access to server URL",
        "Environment variables for authentication tokens (service-specific)"
      ],
      "permissions": [
        "Network access for SSE/HTTP/WebSocket servers",
        "Process spawning for stdio servers",
        "Environment variable access",
        "File system access to ${CLAUDE_PLUGIN_ROOT}"
      ],
      "complexity": "intermediate"
    }
  },
  "file_structure": [
    {
      "name": "examples",
      "type": "dir",
      "path": "examples",
      "children": [
        {
          "name": "http-server.json",
          "type": "file",
          "path": "examples/http-server.json"
        },
        {
          "name": "sse-server.json",
          "type": "file",
          "path": "examples/sse-server.json"
        },
        {
          "name": "stdio-server.json",
          "type": "file",
          "path": "examples/stdio-server.json"
        }
      ]
    },
    {
      "name": "references",
      "type": "dir",
      "path": "references",
      "children": [
        {
          "name": "authentication.md",
          "type": "file",
          "path": "references/authentication.md"
        },
        {
          "name": "server-types.md",
          "type": "file",
          "path": "references/server-types.md"
        },
        {
          "name": "tool-usage.md",
          "type": "file",
          "path": "references/tool-usage.md"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}