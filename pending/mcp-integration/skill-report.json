{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2025-12-30T09:08:48.391Z",
    "slug": "mcp-integration",
    "source_url": "https://github.com/anthropics/claude-code/tree/main/plugins/plugin-dev/skills/mcp-integration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "trust_level": "official"
  },
  "skill": {
    "name": "MCP Integration",
    "description": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in plugin\", \"use .mcp.json\", \"set up Model Context Protocol\", \"connect external service\", mentions \"${CLAUDE_PLUGIN_ROOT} with MCP\", or discusses MCP server types (SSE, stdio, HTTP, WebSocket). Provides comprehensive guidance for integrating Model Context Protocol servers into Claude Code plugins for external tool and service integration.",
    "summary": "This skill should be used when the user asks to \"add MCP server\", \"integrate MCP\", \"configure MCP in...",
    "icon": "ðŸ”Œ",
    "version": "0.1.0",
    "author": "Anthropic",
    "license": "Not specified",
    "category": "development",
    "tags": [
      "mcp",
      "integration",
      "api",
      "external-services",
      "protocol",
      "plugins",
      "claude-code"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": [
      "network"
    ]
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is an official Anthropic skill providing documentation and guidance for MCP integration. No executable code or security vulnerabilities detected - consists entirely of educational markdown documentation and example JSON configurations.",
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 7,
    "total_lines": 2249,
    "audit_model": "claude",
    "audited_at": "2025-12-30T09:08:48.391Z"
  },
  "content": {
    "user_title": "MCP Integration Guide for Claude Code Plugins",
    "value_statement": "Enable Claude Code plugins to connect with external services and APIs through the Model Context Protocol, providing seamless integration for databases, file systems, cloud services, and custom tools.",
    "seo_keywords": [
      "model context protocol",
      "mcp server",
      "claude code plugins",
      "api integration",
      "external services",
      "oauth authentication",
      "stdio",
      "sse",
      "http",
      "websocket"
    ],
    "actual_capabilities": [
      "Configure MCP servers in plugins using .mcp.json or plugin.json",
      "Support for 4 server types: stdio (local processes), SSE (server-sent events), HTTP (REST APIs), and WebSocket (real-time)",
      "Automatic OAuth authentication handling for cloud services",
      "Environment variable expansion for configuration portability",
      "Token-based authentication with Bearer tokens and API keys",
      "Dynamic header generation for complex auth flows",
      "Integration with external databases, file systems, and cloud APIs",
      "Bundling MCP servers with plugins for automatic setup",
      "Tool discovery and registration with prefixed naming convention",
      "Pre-allowing MCP tools in commands for security control"
    ],
    "limitations": [
      "Requires restart of Claude Code after configuration changes",
      "MCP tool names must match exactly (case-sensitive)",
      "Mutual TLS (mTLS) not directly supported, requires wrapper implementation",
      "OAuth flows limited to services with MCP-compatible endpoints",
      "stdio servers must communicate via stdin/stdout only",
      "Network-based servers must use secure connections (HTTPS/WSS)"
    ],
    "use_cases": [
      {
        "title": "Local File System Access",
        "description": "Configure stdio MCP server to provide file system tools for reading, writing, and managing files within allowed directories",
        "target_user": "Plugin developers needing local file operations"
      },
      {
        "title": "Cloud Service Integration (Asana, GitHub)",
        "description": "Connect to hosted MCP servers with automatic OAuth authentication for services like Asana and GitHub",
        "target_user": "Users integrating with SaaS platforms"
      },
      {
        "title": "Database Connectivity",
        "description": "Set up stdio or HTTP MCP servers to query, update, and manage database resources with proper credential handling",
        "target_user": "Developers building data-driven plugins"
      },
      {
        "title": "Custom REST API Integration",
        "description": "Configure HTTP MCP servers with token-based authentication to expose internal or third-party REST APIs as Claude Code tools",
        "target_user": "Enterprise developers integrating internal services"
      },
      {
        "title": "Real-Time Data Streaming",
        "description": "Use WebSocket MCP servers for bi-directional real-time communication with streaming data sources",
        "target_user": "Developers building collaborative or live-update features"
      }
    ],
    "prompt_templates": [
      {
        "title": "Configure stdio MCP server",
        "prompt": "Help me add an MCP server to my plugin that runs a local Node.js script at ${CLAUDE_PLUGIN_ROOT}/servers/my-server.js with environment variables for API_KEY and DATABASE_URL",
        "scenario": "Setting up a local MCP server for custom tools"
      },
      {
        "title": "Integrate hosted SSE service",
        "prompt": "I want to integrate the Asana MCP server (https://mcp.asana.com/sse) into my plugin. Show me the configuration and how to use OAuth",
        "scenario": "Connecting to cloud services with OAuth"
      },
      {
        "title": "Configure HTTP API with token auth",
        "prompt": "Add an MCP server that connects to https://api.example.com/mcp using Bearer token authentication from the API_TOKEN environment variable",
        "scenario": "Integrating REST APIs with token-based auth"
      },
      {
        "title": "Use MCP tools in commands",
        "prompt": "I have an MCP server configured. How do I pre-allow specific tools in my command's frontmatter and call them?",
        "scenario": "Using discovered MCP tools in plugin commands"
      },
      {
        "title": "Debug MCP connection issues",
        "prompt": "My MCP server isn't connecting. Help me troubleshoot using /mcp command and debug logs",
        "scenario": "Troubleshooting MCP integration problems"
      }
    ],
    "output_examples": [
      {
        "input": "Show me a complete .mcp.json for a database server",
        "output": "{\n  \"database-tools\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DATABASE_URL\": \"${DB_URL}\",\n      \"DB_POOL_SIZE\": \"10\"\n    }\n  }\n}"
      },
      {
        "input": "How do I use MCP tools in a command?",
        "output": "---\nallowed-tools: [\n  \"mcp__plugin_myplug_database__query\",\n  \"mcp__plugin_myplug_database__execute\"\n]\n---\n\n# Database Command\n\nSteps:\n1. Validate query parameters\n2. Use mcp__plugin_myplug_database__query with filters\n3. Display results to user"
      }
    ],
    "best_practices": [
      "Use .mcp.json for clearer separation of concerns when configuring MCP servers",
      "Always use ${CLAUDE_PLUGIN_ROOT} for portable file path references",
      "Document all required environment variables in your plugin README",
      "Use HTTPS/WSS for all network connections, never HTTP/WS",
      "Pre-allow specific MCP tools in commands rather than using wildcards",
      "Let OAuth handle authentication when available instead of manual token management",
      "Store tokens in environment variables, never hardcode in configuration",
      "Handle connection and tool call errors gracefully with clear user feedback",
      "Test MCP integration locally with /mcp command and --debug flag before publishing",
      "Batch similar requests when possible to optimize performance",
      "Use stdio for local tools and custom servers, SSE for hosted services with OAuth"
    ],
    "anti_patterns": [
      "Hardcoding API tokens or credentials directly in .mcp.json files",
      "Using HTTP instead of HTTPS or WS instead of WSS for network connections",
      "Pre-allowing all tools with wildcards (mcp__plugin_name_server__*) without security consideration",
      "Hardcoding absolute file paths instead of using ${CLAUDE_PLUGIN_ROOT}",
      "Committing credentials or .env files to version control",
      "Skipping error handling for MCP connection and tool call failures",
      "Making many individual tool calls instead of batching similar requests",
      "Using bash echo or output redirection for file operations instead of dedicated tools",
      "Forgetting to document required environment variables in plugin README",
      "Testing in production without local validation using /mcp and debug mode"
    ],
    "faq": [
      {
        "question": "When should I use .mcp.json vs mcpServers in plugin.json?",
        "answer": "Use .mcp.json for better separation of concerns and when configuring multiple MCP servers. Use mcpServers in plugin.json for simple single-server plugins where consolidation is preferred."
      },
      {
        "question": "How do MCP tool names work?",
        "answer": "MCP tools are automatically prefixed with the format: mcp__plugin_<plugin-name>_<server-name>__<tool-name>. For example, an 'asana' plugin with 'asana' server providing 'create_task' becomes 'mcp__plugin_asana_asana__asana_create_task'."
      },
      {
        "question": "Which MCP server type should I choose?",
        "answer": "Use stdio for local tools and custom servers, SSE for hosted cloud services with OAuth, HTTP for REST APIs with token auth, and WebSocket for real-time bidirectional communication."
      },
      {
        "question": "How does OAuth authentication work with MCP?",
        "answer": "Claude Code handles OAuth automatically for SSE and HTTP servers. Users authenticate in browser on first use, tokens are stored securely and auto-refreshed, no additional configuration needed in .mcp.json."
      },
      {
        "question": "How do I debug MCP connection issues?",
        "answer": "Run 'claude --debug' to see connection logs, use '/mcp' command to verify servers appear, check URL/authentication configuration, verify environment variables are set, and restart Claude Code after config changes."
      },
      {
        "question": "Can I use multiple MCP servers in one plugin?",
        "answer": "Yes, configure multiple servers in .mcp.json with different names. Each server's tools will be prefixed with its unique server name, allowing multi-service integration."
      },
      {
        "question": "How do I secure API tokens in MCP configuration?",
        "answer": "Always use environment variable substitution (${API_TOKEN}) in headers or env fields, document required variables in README, never hardcode tokens, and ensure tokens are in .gitignore."
      },
      {
        "question": "What happens when an MCP server fails to connect?",
        "answer": "Claude Code will attempt to reconnect for network-based servers (SSE/HTTP/WebSocket). For stdio servers, the process may be respawned. Commands should handle tool unavailability gracefully with clear error messages."
      }
    ],
    "technical_requirements": {
      "dependencies": [
        "Claude Code runtime environment",
        "MCP-compatible server (stdio executable, SSE/HTTP/WebSocket endpoint)",
        "Environment variables for authentication (API tokens, database URLs, etc.)",
        "HTTPS/WSS endpoints for network-based servers"
      ],
      "permissions": [
        "File system access for ${CLAUDE_PLUGIN_ROOT} paths (stdio servers)",
        "Network access for external MCP server endpoints (SSE/HTTP/WebSocket)",
        "Environment variable access for configuration and authentication",
        "OAuth authorization for cloud services (user grants via browser)"
      ],
      "complexity": "intermediate"
    }
  },
  "file_structure": [
    {
      "name": "examples",
      "type": "dir",
      "path": "examples",
      "children": [
        {
          "name": "http-server.json",
          "type": "file",
          "path": "examples/http-server.json"
        },
        {
          "name": "sse-server.json",
          "type": "file",
          "path": "examples/sse-server.json"
        },
        {
          "name": "stdio-server.json",
          "type": "file",
          "path": "examples/stdio-server.json"
        }
      ]
    },
    {
      "name": "references",
      "type": "dir",
      "path": "references",
      "children": [
        {
          "name": "authentication.md",
          "type": "file",
          "path": "references/authentication.md"
        },
        {
          "name": "server-types.md",
          "type": "file",
          "path": "references/server-types.md"
        },
        {
          "name": "tool-usage.md",
          "type": "file",
          "path": "references/tool-usage.md"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}