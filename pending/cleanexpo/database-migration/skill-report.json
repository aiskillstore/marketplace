{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-10T12:29:22.066Z",
    "slug": "cleanexpo-database-migration",
    "source_url": "https://github.com/CleanExpo/Unite-Hub/tree/main/.claude/skills/database-migration",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "2.0.0",
    "source_type": "community",
    "content_hash": "2c711f0cf15db583cf7205271b85ffeb224f35a9720336502ddcef93c96920fc",
    "tree_hash": "06327cb2bcf2d69eeaf34f9907f2a28865e31bef2b408a80cbe82fdbd59e5d67"
  },
  "skill": {
    "name": "Database Migration Skill",
    "description": "**When to Use**: Adding tables, modifying schemas, creating RLS policies, adding functions",
    "summary": "**When to Use**: Adding tables, modifying schemas, creating RLS policies, adding functions",
    "icon": "üóÑÔ∏è",
    "version": "1.0.0",
    "author": "CleanExpo",
    "license": "MIT",
    "category": "data",
    "tags": [
      "supabase",
      "database",
      "migration",
      "postgresql",
      "rls"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "Pure documentation skill containing SQL patterns and migration guidelines. No executable code, no file system access, no network calls, no command execution.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 1,
    "total_lines": 247,
    "audit_model": "claude",
    "audited_at": "2026-01-10T12:29:22.066Z"
  },
  "content": {
    "user_title": "Create Supabase database migrations",
    "value_statement": "Database schema changes are error-prone and can break production. This skill provides battle-tested patterns for creating idempotent Supabase migrations with workspace isolation and Row Level Security policies.",
    "seo_keywords": [
      "database migration",
      "supabase",
      "postgresql",
      "sql",
      "row level security",
      "rls policies",
      "schema changes",
      "claude code",
      "claude",
      "codex"
    ],
    "actual_capabilities": [
      "Generate idempotent SQL migrations using IF NOT EXISTS and CREATE OR REPLACE patterns",
      "Create workspace-isolated tables with proper multi-tenant architecture",
      "Implement Row Level Security policies using user_organizations join pattern",
      "Add indexes, constraints, triggers, ENUM types, and functions with safe migration patterns"
    ],
    "limitations": [
      "Does not execute migrations - generates SQL for manual review",
      "Does not handle data migration or schema transforms",
      "Does not validate existing database schema automatically",
      "Does not roll back migrations or manage migration history"
    ],
    "use_cases": [
      {
        "target_user": "Backend Developers",
        "title": "Add new tables safely",
        "description": "Create tables with proper RLS, indexes, and workspace isolation in Supabase projects"
      },
      {
        "target_user": "DevOps Engineers",
        "title": "Schema change automation",
        "description": "Generate consistent migration patterns for CI/CD deployment pipelines"
      },
      {
        "target_user": "Platform Engineers",
        "title": "Multi-tenant database design",
        "description": "Implement secure multi-tenant isolation with enforced Row Level Security"
      }
    ],
    "prompt_templates": [
      {
        "title": "Create simple table",
        "scenario": "Add new table to Supabase",
        "prompt": "Create a migration for a new table called 'project_tasks' with name, status, due_date, and assigned_to. Include workspace isolation and RLS."
      },
      {
        "title": "Add ENUM type",
        "scenario": "Create status enum",
        "prompt": "Generate migration to add an ENUM type 'task_priority' with values 'low', 'medium', 'high', 'urgent' and a column using it."
      },
      {
        "title": "Create trigger",
        "scenario": "Auto-update timestamps",
        "prompt": "Write a migration that adds an update_updated_at trigger to the 'users' table that sets updated_at on row changes."
      },
      {
        "title": "Complex schema",
        "scenario": "Full feature module",
        "prompt": "Create a complete migration for a 'customer_orders' module with tables, foreign keys, indexes, enums, RLS policies for admins and customers, and a function to calculate order totals."
      }
    ],
    "output_examples": [
      {
        "input": "Create a migration for a 'project_tasks' table with name, status, due_date, and workspace_id. Include workspace isolation and RLS.",
        "output": [
          "‚úì Table created with workspace_id and proper references",
          "‚úì Index added on workspace_id for query performance",
          "‚úì RLS enabled with user_organizations join pattern",
          "‚úì SELECT policy allows users to view their workspace tasks",
          "‚úì System policy enables management via service role",
          "‚úì Migration is idempotent (IF NOT EXISTS clauses)"
        ]
      }
    ],
    "best_practices": [
      "Always check schema-reference.md for existing tables before creating new ones",
      "Use IF NOT EXISTS and CREATE OR REPLACE to make migrations re-runnable",
      "Always add workspace_id with CASCADE delete for multi-tenant tables",
      "Include RLS policies with both user access and system management rules"
    ],
    "anti_patterns": [
      "Using workspace_members table instead of user_organizations join pattern",
      "Creating migrations without idempotent IF NOT EXISTS checks",
      "Missing indexes on workspace_id causing query performance issues",
      "Forgetting to enable RLS or create policies after ALTER TABLE"
    ],
    "faq": [
      {
        "question": "What databases are supported?",
        "answer": "This skill targets Supabase PostgreSQL databases. The SQL patterns work with any PostgreSQL 14+ instance."
      },
      {
        "question": "Are there limits on migration size?",
        "answer": "PostgreSQL has a 1GB statement limit. For larger changes, split into multiple migration files."
      },
      {
        "question": "How do I integrate with Supabase CLI?",
        "answer": "Generated SQL can be pasted into Supabase Dashboard SQL Editor or saved to supabase/migrations/ for CLI deployment."
      },
      {
        "question": "Is my data safe during migration?",
        "answer": "The skill generates read-only patterns by default. Review all generated SQL before execution to ensure data safety."
      },
      {
        "question": "Why am I seeing 'relation does not exist' errors?",
        "answer": "This usually means using workspace_members table. Use the user_organizations + workspaces join pattern documented in the skill."
      },
      {
        "question": "How does this compare to TypeORM or Prisma migrations?",
        "answer": "This skill generates native SQL for Supabase, offering more control over RLS and PostgreSQL-specific features than ORM migrations."
      }
    ]
  },
  "file_structure": [
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md"
    }
  ]
}
