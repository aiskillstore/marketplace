{
  "schema_version": "2.0",
  "meta": {
    "generated_at": "2026-01-23T08:07:12.158Z",
    "slug": "supabase-supabase-postgres-best-practices",
    "source_url": "https://github.com/supabase/agent-skills/tree/main/skills/postgres-best-practices/",
    "source_ref": "main",
    "model": "claude",
    "analysis_version": "3.0.0",
    "source_type": "community",
    "content_hash": "6aedcbaac07ab7316b84813270921a53c9e4993242060d25d40efa10c189a5b9",
    "tree_hash": "8a429e779006eb0fda2d69f138b3fc0f178462e898b7ba654a486703035c09be"
  },
  "skill": {
    "name": "supabase-postgres-best-practices",
    "description": "Postgres performance optimization and best practices from Supabase. Use this skill when writing, reviewing, or optimizing Postgres queries, schema designs, or database configurations.",
    "summary": "Postgres performance optimization and best practices from Supabase. Use this skill when writing, reviewing, or optimizing Postgres queries, schema designs, or database configurations.",
    "icon": "ðŸ“¦",
    "version": "1.0.0",
    "author": "supabase",
    "license": "MIT",
    "category": "data",
    "tags": [
      "postgresql",
      "database",
      "performance",
      "optimization",
      "sql"
    ],
    "supported_tools": [
      "claude",
      "codex",
      "claude-code"
    ],
    "risk_factors": []
  },
  "security_audit": {
    "risk_level": "safe",
    "is_blocked": false,
    "safe_to_publish": true,
    "summary": "This is a documentation-only skill containing PostgreSQL best practices. All static scanner findings are false positives. The skill contains only markdown documentation with SQL code examples for educational purposes. No executable code, no network calls, no file system access, and no external command execution. All flagged patterns are SQL syntax in documentation examples, not actual security vulnerabilities.",
    "risk_factor_evidence": [],
    "critical_findings": [],
    "high_findings": [],
    "medium_findings": [],
    "low_findings": [],
    "dangerous_patterns": [],
    "files_scanned": 37,
    "total_lines": 3485,
    "audit_model": "claude",
    "audited_at": "2026-01-23T08:07:12.158Z",
    "risk_factors": []
  },
  "content": {
    "user_title": "Optimize Postgres Queries and Database Design",
    "value_statement": "Poor database performance can slow applications to a crawl. This skill provides 27 optimized PostgreSQL patterns covering indexes, query optimization, connection management, security, and schema design to achieve 10-100x performance improvements.",
    "seo_keywords": [
      "PostgreSQL best practices",
      "Postgres optimization",
      "database performance",
      "SQL query optimization",
      "index optimization",
      "Postgres security",
      "schema design",
      "connection pooling",
      "Claude",
      "Codex",
      "Claude Code"
    ],
    "actual_capabilities": [
      "Optimize SQL queries with proper index usage and query patterns",
      "Design efficient database schemas with correct data types and constraints",
      "Configure connection pooling and manage database connections",
      "Implement Row-Level Security (RLS) policies correctly",
      "Optimize concurrency with proper locking and transaction patterns",
      "Monitor and diagnose database performance issues using EXPLAIN and pg_stat_statements"
    ],
    "limitations": [
      "Provides guidance only; does not execute or modify actual databases",
      "Skill assumes basic SQL knowledge; beginner users may need additional learning resources",
      "Focuses on PostgreSQL specifically; not applicable to other database systems",
      "Does not cover application-level caching or ORM optimization patterns"
    ],
    "use_cases": [
      {
        "title": "Database Developer Optimizing Slow Queries",
        "description": "A developer notices their application queries are timing out on large tables. They use this skill to identify missing indexes, optimize JOIN patterns, and apply covering indexes for 10-100x query speedup.",
        "target_user": "Backend developers, database engineers"
      },
      {
        "title": "DevOps Engineer Configuring Production Database",
        "description": "An engineer setting up a new PostgreSQL instance uses this skill to configure connection pooling, set appropriate timeouts, and implement security best practices from day one.",
        "target_user": "DevOps engineers, SREs, database administrators"
      },
      {
        "title": "AI Agent Writing Database Code",
        "description": "An AI coding agent generating SQL for a new feature references this skill to produce optimized queries, proper schema designs, and security-aware RLS policies without manual review.",
        "target_user": "AI coding agents, automated CI/CD pipelines"
      }
    ],
    "prompt_templates": [
      {
        "title": "Basic Query Review",
        "prompt": "Review this PostgreSQL query for performance issues and suggest optimizations based on postgres-best-practices:\n\n```sql\n{user_query}\n```",
        "scenario": "Quick query optimization request"
      },
      {
        "title": "Schema Design Consultation",
        "prompt": "Design a PostgreSQL schema for a {entity} with the following requirements:\n- {requirement_1}\n- {requirement_2}\n\nFollow postgres-best-practices for data types, indexes, and constraints.",
        "scenario": "New table or schema design"
      },
      {
        "title": "Connection Configuration",
        "prompt": "Configure PostgreSQL connection settings for a {use_case} scenario with approximately {concurrent_users} concurrent users. Consider pooling strategy, prepared statements, and timeout values based on postgres-best-practices.",
        "scenario": "Connection and pooling optimization"
      },
      {
        "title": "Security Audit",
        "prompt": "Audit this PostgreSQL schema and queries for security issues:\n- Check RLS policies\n- Verify privilege assignments\n- Look for SQL injection risks\n\nApply postgres-best-practices for security patterns:\n```{user_code}\n```",
        "scenario": "Database security review"
      }
    ],
    "output_examples": [
      {
        "input": "SELECT * FROM orders WHERE customer_id = 123 AND status = 'pending' ORDER BY created_at DESC LIMIT 20;",
        "output": [
          "Issue: Missing index on customer_id and status columns causes full table scan.",
          "Fix: CREATE INDEX CONCURRENTLY orders_customer_status_idx ON orders (customer_id, status, created_at DESC);",
          "Impact: 100-1000x faster query on large tables with selective WHERE clause."
        ]
      },
      {
        "input": "CREATE TABLE users (id SERIAL PRIMARY KEY, email TEXT, settings JSONB);",
        "output": [
          "Issue: TEXT for email lacks length constraint, causing storage overhead.",
          "Fix: Use VARCHAR(255) for email, or cite VARCHAR(254) for RFC compliance.",
          "Issue: JSONB column lacks GIN index for query patterns.",
          "Fix: Add index if querying specific JSON fields: CREATE INDEX idx_users_settings ON users USING gin (settings);"
        ]
      },
      {
        "input": "BEGIN; UPDATE accounts SET balance = balance - 100 WHERE id = 1; UPDATE accounts SET balance = balance + 100 WHERE id = 2; COMMIT;",
        "output": [
          "Issue: Long-running transaction holds locks, blocking concurrent access.",
          "Fix: Keep transactions short. Consider using SKIP LOCKED for queue-like patterns.",
          "Consider: SELECT FOR UPDATE with NOWAIT if row-level locking is needed.",
          "Best practice: Use advisory locks for application-level coordination."
        ]
      }
    ],
    "best_practices": [
      "Always index foreign keys and columns used in WHERE, JOIN, and ORDER BY clauses to prevent sequential scans on large tables.",
      "Use connection pooling (PgBouncer or built-in pooling) and configure prepared statement limits to avoid connection exhaustion.",
      "Implement Row-Level Security (RLS) at the database level rather than relying solely on application logic for multi-tenant applications.",
      "Keep transactions short and use SKIP LOCKED or advisory locks for concurrent access patterns to prevent deadlocks."
    ],
    "anti_patterns": [
      "Using SELECT * in production queries - specify needed columns to enable covering indexes and reduce I/O.",
      "Creating indexes while holding locks on large tables - use CONCURRENTLY option to avoid downtime.",
      "Storing unstructured data in TEXT columns - use appropriate data types (JSONB, ARRAY, ENUM) for queryability.",
      "Running long transactions that hold locks - break into smaller units and release locks promptly."
    ],
    "faq": [
      {
        "question": "What is the most impactful optimization in this skill?",
        "answer": "Adding missing indexes on WHERE and JOIN columns is the highest-impact optimization, typically providing 100-1000x speedup on large tables by replacing sequential scans with index scans."
      },
      {
        "question": "Does this skill cover PostgreSQL-specific features?",
        "answer": "Yes, it covers advanced features like JSONB indexing, full-text search, partial indexes, table partitioning, and PostgreSQL-specific locking options like SKIP LOCKED."
      },
      {
        "question": "How do I handle connection exhaustion issues?",
        "answer": "Use connection pooling (PgBouncer), configure appropriate pool sizes, set statement timeouts, and prefer prepared statements for repeated queries. See conn-pooling.md and conn-limits.md rules."
      },
      {
        "question": "What security practices are included?",
        "answer": "The skill covers Row-Level Security (RLS) basics and performance, proper privilege management, least-privilege principles, and avoiding common SQL injection patterns in application code."
      },
      {
        "question": "Can I use this skill for schema migrations?",
        "answer": "Yes, use the schema design rules for new tables and the locking rules to ensure migrations don't block production traffic. Always use CONCURRENTLY for index creation on live tables."
      },
      {
        "question": "How does this skill help with monitoring?",
        "answer": "It provides guidance on using EXPLAIN ANALYZE for query plans, pg_stat_statements for identifying slow queries, and VACUUM/ANALYZE maintenance for keeping statistics accurate."
      }
    ]
  },
  "file_structure": [
    {
      "name": "rules",
      "type": "dir",
      "path": "rules",
      "children": [
        {
          "name": "_contributing.md",
          "type": "file",
          "path": "rules/_contributing.md",
          "lines": 172
        },
        {
          "name": "_sections.md",
          "type": "file",
          "path": "rules/_sections.md",
          "lines": 40
        },
        {
          "name": "_template.md",
          "type": "file",
          "path": "rules/_template.md",
          "lines": 35
        },
        {
          "name": "advanced-full-text-search.md",
          "type": "file",
          "path": "rules/advanced-full-text-search.md",
          "lines": 56
        },
        {
          "name": "advanced-jsonb-indexing.md",
          "type": "file",
          "path": "rules/advanced-jsonb-indexing.md",
          "lines": 50
        },
        {
          "name": "conn-idle-timeout.md",
          "type": "file",
          "path": "rules/conn-idle-timeout.md",
          "lines": 47
        },
        {
          "name": "conn-limits.md",
          "type": "file",
          "path": "rules/conn-limits.md",
          "lines": 45
        },
        {
          "name": "conn-pooling.md",
          "type": "file",
          "path": "rules/conn-pooling.md",
          "lines": 42
        },
        {
          "name": "conn-prepared-statements.md",
          "type": "file",
          "path": "rules/conn-prepared-statements.md",
          "lines": 47
        },
        {
          "name": "data-batch-inserts.md",
          "type": "file",
          "path": "rules/data-batch-inserts.md",
          "lines": 55
        },
        {
          "name": "data-n-plus-one.md",
          "type": "file",
          "path": "rules/data-n-plus-one.md",
          "lines": 54
        },
        {
          "name": "data-pagination.md",
          "type": "file",
          "path": "rules/data-pagination.md",
          "lines": 51
        },
        {
          "name": "data-upsert.md",
          "type": "file",
          "path": "rules/data-upsert.md",
          "lines": 51
        },
        {
          "name": "lock-advisory.md",
          "type": "file",
          "path": "rules/lock-advisory.md",
          "lines": 57
        },
        {
          "name": "lock-deadlock-prevention.md",
          "type": "file",
          "path": "rules/lock-deadlock-prevention.md",
          "lines": 69
        },
        {
          "name": "lock-short-transactions.md",
          "type": "file",
          "path": "rules/lock-short-transactions.md",
          "lines": 51
        },
        {
          "name": "lock-skip-locked.md",
          "type": "file",
          "path": "rules/lock-skip-locked.md",
          "lines": 55
        },
        {
          "name": "monitor-explain-analyze.md",
          "type": "file",
          "path": "rules/monitor-explain-analyze.md",
          "lines": 46
        },
        {
          "name": "monitor-pg-stat-statements.md",
          "type": "file",
          "path": "rules/monitor-pg-stat-statements.md",
          "lines": 56
        },
        {
          "name": "monitor-vacuum-analyze.md",
          "type": "file",
          "path": "rules/monitor-vacuum-analyze.md",
          "lines": 56
        },
        {
          "name": "query-composite-indexes.md",
          "type": "file",
          "path": "rules/query-composite-indexes.md",
          "lines": 45
        },
        {
          "name": "query-covering-indexes.md",
          "type": "file",
          "path": "rules/query-covering-indexes.md",
          "lines": 41
        },
        {
          "name": "query-index-types.md",
          "type": "file",
          "path": "rules/query-index-types.md",
          "lines": 46
        },
        {
          "name": "query-missing-indexes.md",
          "type": "file",
          "path": "rules/query-missing-indexes.md",
          "lines": 44
        },
        {
          "name": "query-partial-indexes.md",
          "type": "file",
          "path": "rules/query-partial-indexes.md",
          "lines": 46
        },
        {
          "name": "schema-data-types.md",
          "type": "file",
          "path": "rules/schema-data-types.md",
          "lines": 47
        },
        {
          "name": "schema-foreign-key-indexes.md",
          "type": "file",
          "path": "rules/schema-foreign-key-indexes.md",
          "lines": 60
        },
        {
          "name": "schema-lowercase-identifiers.md",
          "type": "file",
          "path": "rules/schema-lowercase-identifiers.md",
          "lines": 56
        },
        {
          "name": "schema-partitioning.md",
          "type": "file",
          "path": "rules/schema-partitioning.md",
          "lines": 56
        },
        {
          "name": "schema-primary-keys.md",
          "type": "file",
          "path": "rules/schema-primary-keys.md",
          "lines": 62
        },
        {
          "name": "security-privileges.md",
          "type": "file",
          "path": "rules/security-privileges.md",
          "lines": 55
        },
        {
          "name": "security-rls-basics.md",
          "type": "file",
          "path": "rules/security-rls-basics.md",
          "lines": 51
        },
        {
          "name": "security-rls-performance.md",
          "type": "file",
          "path": "rules/security-rls-performance.md",
          "lines": 58
        }
      ]
    },
    {
      "name": "AGENTS.md",
      "type": "file",
      "path": "AGENTS.md",
      "lines": 1491
    },
    {
      "name": "metadata.json",
      "type": "file",
      "path": "metadata.json",
      "lines": 14
    },
    {
      "name": "README.md",
      "type": "file",
      "path": "README.md",
      "lines": 120
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "SKILL.md",
      "lines": 58
    }
  ]
}
